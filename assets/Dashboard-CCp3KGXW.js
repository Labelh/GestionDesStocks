import{u as S,a as w,j as t}from"./index-DNyQ5bXx.js";import{r as h,L as C}from"./react-vendor-DRM3MNr6.js";import"./supabase-g_Un6fVd.js";const M=()=>{const{products:d,stockMovements:o,getStockAlerts:v}=S(),{addNotification:p}=w(),u=v(),j=h.useMemo(()=>{const e=new Date,a=new Date(e.setMonth(e.getMonth()-1)),s=o.filter(n=>n.movementType==="exit"&&n.timestamp>=a),c=s.reduce((n,m)=>n+m.quantity,0),l=(c/30).toFixed(1),r={};s.forEach(n=>{r[n.productId]||(r[n.productId]={name:n.productDesignation,quantity:0}),r[n.productId].quantity+=n.quantity});const i=Object.values(r).sort((n,m)=>m.quantity-n.quantity).slice(0,3);return{totalExits:c,avgDailyConsumption:l,topProducts:i}},[o]),x=h.useMemo(()=>{const e=new Date,a=new Date(e.getTime()-30*24*60*60*1e3);return d.map(s=>{const l=o.filter(n=>n.productId===s.id&&n.movementType==="exit"&&n.timestamp>=a).reduce((n,m)=>n+m.quantity,0),r=l/30;let i=0;return r>0?i=Math.floor(s.currentStock/r):i=999,{product:s,daysRemaining:i,dailyConsumption:r.toFixed(2),monthlyConsumption:l.toFixed(0)}}).filter(s=>s.daysRemaining<30&&s.daysRemaining>0).sort((s,c)=>s.daysRemaining-c.daysRemaining).slice(0,5)},[d,o]);h.useEffect(()=>{const e=u.filter(s=>s.alertType==="critical"),a=u.filter(s=>s.alertType==="low");e.length>0?p({type:"error",title:"Stock critique!",message:`${e.length} produit(s) en stock critique nécessitent une attention immédiate.`,duration:8e3}):a.length>0&&p({type:"warning",title:"Stock faible",message:`${a.length} produit(s) ont un stock faible.`,duration:6e3})},[]);const y=d.length,N=u.filter(e=>e.alertType==="low").length,f=u.filter(e=>e.alertType==="critical").length,k=h.useMemo(()=>d.reduce((e,a)=>{const s=a.unitPrice||0;return e+a.currentStock*s},0),[d]),g=h.useMemo(()=>{const e=new Date,a=new Date(e.getTime()-7*24*60*60*1e3),s=o.filter(i=>i.timestamp>=a),c=s.filter(i=>i.movementType==="entry").length,l=s.filter(i=>i.movementType==="exit").length,r=s.filter(i=>i.movementType==="adjustment").length;return{entries:c,exits:l,adjustments:r,total:s.length}},[o]);return t.jsxs("div",{className:"dashboard",children:[t.jsx("h1",{children:"Dashboard"}),t.jsxs("div",{className:"stats-grid",children:[t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Total Produits"}),t.jsx("p",{className:"stat-value",children:y})]})}),t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Stock Faible"}),t.jsx("p",{className:"stat-value",children:N})]})}),t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Stock Critique"}),t.jsx("p",{className:"stat-value",children:f})]})}),t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Valeur du Stock"}),t.jsxs("p",{className:"stat-value",children:[k.toLocaleString("fr-FR",{maximumFractionDigits:0})," €"]})]})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem",marginBottom:"2rem"},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{marginBottom:"1rem"},children:"Activité de la semaine (7 derniers jours)"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Entrées"}),t.jsx("p",{className:"stat-value",children:g.entries})]})}),t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Sorties"}),t.jsx("p",{className:"stat-value",children:g.exits})]})})]})]}),t.jsxs("div",{children:[t.jsx("h2",{style:{marginBottom:"1rem"},children:"Consommation ce mois"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Sorties totales"}),t.jsx("p",{className:"stat-value",children:j.totalExits})]})}),t.jsx("div",{className:"stat-card",children:t.jsxs("div",{className:"stat-content",children:[t.jsx("h3",{children:"Moyenne journalière"}),t.jsx("p",{className:"stat-value",children:j.avgDailyConsumption})]})})]})]})]}),x.length>0&&t.jsxs("div",{className:"alerts-section",children:[t.jsx("h2",{children:"Prévisions de Rupture de Stock"}),t.jsx("div",{className:"predictions-grid",children:x.map(e=>t.jsxs("div",{className:`prediction-card ${e.daysRemaining<=7?"critical":e.daysRemaining<=14?"warning":"normal"}`,children:[t.jsxs("div",{className:"prediction-header",children:[t.jsx("h3",{children:e.product.designation}),t.jsx("span",{style:{fontSize:"0.875rem",color:"var(--accent-color)",fontWeight:"600"},children:e.product.reference})]}),t.jsxs("div",{className:"prediction-body",children:[t.jsxs("div",{className:"prediction-days",children:[t.jsx("span",{className:"days-number",children:e.daysRemaining}),t.jsx("span",{className:"days-label",children:"jours"})]}),t.jsxs("div",{className:"prediction-details",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Stock:"})," ",e.product.currentStock," ",e.product.unit]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Conso. moy.:"})," ",e.dailyConsumption," / jour"]})]})]})]},e.product.id))}),x.length>=5&&t.jsx("p",{style:{textAlign:"center",marginTop:"1rem"},children:t.jsx(C,{to:"/products",className:"btn btn-secondary",children:"Voir tous les produits"})})]})]})};export{M as default};
