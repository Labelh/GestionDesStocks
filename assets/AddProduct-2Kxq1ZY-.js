import{u as S,j as e}from"./index-DlynR0Vu.js";import{u as L,r as c}from"./react-vendor-D8CQoBvY.js";import"./supabase-BffQhpPo.js";const R=()=>{const{addProduct:g,categories:j,units:f,storageZones:v,getAllProductReferences:u}=S(),p=L(),[m,N]=c.useState("");c.useEffect(()=>{(async()=>{const o=await u();if(o.length===0)return"RF00001";const a=o.filter(l=>l.startsWith("RF")).map(l=>parseInt(l.substring(2))).filter(l=>!isNaN(l)),d=(a.length>0?Math.max(...a):0)+1;return`RF${String(d).padStart(5,"0")}`})().then(o=>N(o))},[u]);const[r,h]=c.useState({designation:"",customerReference:"",category:"",packagingType:"unit",storageZone:"",shelf:"",position:"",location:"",currentStock:"",minStock:"",unit:"",unitPrice:"",photo:"",supplier1:"",orderLink1:"",supplier2:"",orderLink2:"",supplier3:"",orderLink3:""}),[n,x]=c.useState({}),i=s=>{const{name:o,value:a}=s.target;h(t=>({...t,[o]:a})),n[o]&&x(t=>({...t,[o]:""}))},k=s=>{var a;const o=(a=s.target.files)==null?void 0:a[0];if(o){const t=new FileReader;t.onloadend=()=>{h(d=>({...d,photo:t.result}))},t.readAsDataURL(o)}},b=()=>{const s={};r.designation.trim()||(s.designation="La d√©signation est requise"),r.category||(s.category="La cat√©gorie est requise"),r.storageZone||(s.storageZone="La zone de stockage est requise"),(!r.shelf||isNaN(parseInt(r.shelf))||parseInt(r.shelf)<1)&&(s.shelf="L'√©tag√®re doit √™tre un nombre sup√©rieur √† 0"),(!r.position||isNaN(parseInt(r.position))||parseInt(r.position)<1)&&(s.position="La position doit √™tre un nombre sup√©rieur √† 0"),r.unit||(s.unit="L'unit√© est requise");const o=parseFloat(r.currentStock);return(isNaN(o)||o<0)&&(s.currentStock="Le stock actuel doit √™tre un nombre positif"),r.unitPrice&&(isNaN(parseFloat(r.unitPrice))||parseFloat(r.unitPrice)<0)&&(s.unitPrice="Le prix unitaire doit √™tre un nombre positif"),x(s),Object.keys(s).length===0},y=s=>{if(s.preventDefault(),!b())return;const o=`${r.storageZone}.${r.shelf}.${r.position}`;g({reference:m,customerReference:r.customerReference||void 0,designation:r.designation,category:r.category,packagingType:r.packagingType,storageZone:r.storageZone,shelf:parseInt(r.shelf),position:parseInt(r.position),location:o,currentStock:parseFloat(r.currentStock),minStock:r.minStock?parseFloat(r.minStock):0,unit:r.unit,unitPrice:r.unitPrice?parseFloat(r.unitPrice):void 0,photo:r.photo||void 0,supplier1:r.supplier1||void 0,orderLink1:r.orderLink1||void 0,supplier2:r.supplier2||void 0,orderLink2:r.orderLink2||void 0,supplier3:r.supplier3||void 0,orderLink3:r.orderLink3||void 0}),p("/products")};return e.jsxs("div",{className:"add-product-page",children:[e.jsx("h1",{children:"Ajouter un Produit"}),e.jsxs("form",{onSubmit:y,className:"product-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Informations g√©n√©rales"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"R√©f√©rence (auto-g√©n√©r√©e)"}),e.jsx("input",{type:"text",value:m,disabled:!0,style:{background:"var(--hover-bg)",color:"var(--text-secondary)",cursor:"not-allowed"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"designation",children:"D√©signation *"}),e.jsx("input",{type:"text",id:"designation",name:"designation",value:r.designation,onChange:i,className:n.designation?"error":""}),n.designation&&e.jsx("span",{className:"error-text",children:n.designation})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"customerReference",children:"R√©f√©rence Client"}),e.jsx("input",{type:"text",id:"customerReference",name:"customerReference",value:r.customerReference,onChange:i,placeholder:"R√©f√©rence du client (optionnel)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Cat√©gorie *"}),e.jsxs("select",{id:"category",name:"category",value:r.category,onChange:i,className:n.category?"error":"",children:[e.jsx("option",{value:"",children:"S√©lectionner une cat√©gorie"}),j.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),n.category&&e.jsx("span",{className:"error-text",children:n.category})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"packagingType",children:"Type de conditionnement *"}),e.jsxs("select",{id:"packagingType",name:"packagingType",value:r.packagingType,onChange:i,children:[e.jsx("option",{value:"unit",children:"üîß Unit√© - D√©clarer √† chaque sortie"}),e.jsx("option",{value:"lot",children:"üì¶ Lot/Bo√Æte - D√©clarer √† l'ouverture"})]}),e.jsxs("small",{style:{display:"block",marginTop:"0.5rem",color:"var(--text-secondary)",fontSize:"0.85rem"},children:[r.packagingType==="unit"&&"Produits individuels (outils, pi√®ces uniques)",r.packagingType==="lot"&&"Produits conditionn√©s (bo√Ætes de gants, lots de vis)"]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unit",children:"Unit√© *"}),e.jsxs("select",{id:"unit",name:"unit",value:r.unit,onChange:i,className:n.unit?"error":"",children:[e.jsx("option",{value:"",children:"S√©lectionner une unit√©"}),f.map(s=>e.jsxs("option",{value:s.abbreviation,children:[s.name," (",s.abbreviation,")"]},s.id))]}),n.unit&&e.jsx("span",{className:"error-text",children:n.unit})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unitPrice",children:"Prix Unitaire (‚Ç¨)"}),e.jsx("input",{type:"number",id:"unitPrice",name:"unitPrice",value:r.unitPrice,onChange:i,step:"0.01",min:"0",placeholder:"0.00",className:n.unitPrice?"error":""}),n.unitPrice&&e.jsx("span",{className:"error-text",children:n.unitPrice})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"photo",children:"Photo du Produit"}),e.jsx("input",{type:"file",id:"photo",accept:"image/*",onChange:k})]})]}),r.photo&&e.jsx("div",{className:"photo-preview",children:e.jsx("img",{src:r.photo,alt:"Aper√ßu"})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Localisation"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"storageZone",children:"Zone de stockage *"}),e.jsxs("select",{id:"storageZone",name:"storageZone",value:r.storageZone,onChange:i,className:n.storageZone?"error":"",children:[e.jsx("option",{value:"",children:"S√©lectionner une zone"}),v.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),n.storageZone&&e.jsx("span",{className:"error-text",children:n.storageZone})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"shelf",children:"√âtag√®re *"}),e.jsx("input",{type:"number",id:"shelf",name:"shelf",value:r.shelf,onChange:i,min:"1",placeholder:"Num√©ro de l'√©tag√®re",className:n.shelf?"error":""}),n.shelf&&e.jsx("span",{className:"error-text",children:n.shelf})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"position",children:"Position *"}),e.jsx("input",{type:"number",id:"position",name:"position",value:r.position,onChange:i,min:"1",placeholder:"Position sur l'√©tag√®re",className:n.position?"error":""}),n.position&&e.jsx("span",{className:"error-text",children:n.position})]}),e.jsx("div",{className:"form-group"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Gestion du stock"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentStock",children:"Stock Actuel *"}),e.jsx("input",{type:"number",id:"currentStock",name:"currentStock",value:r.currentStock,onChange:i,step:"1",min:"0",className:n.currentStock?"error":""}),n.currentStock&&e.jsx("span",{className:"error-text",children:n.currentStock})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"minStock",children:"Stock Minimum"}),e.jsx("input",{type:"number",id:"minStock",name:"minStock",value:r.minStock,onChange:i,step:"1",min:"0",placeholder:"Seuil d'alerte (optionnel)"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Fournisseurs et commandes"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"supplier1",children:"Fournisseur 1"}),e.jsx("input",{type:"text",id:"supplier1",name:"supplier1",value:r.supplier1,onChange:i,placeholder:"Nom du fournisseur"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orderLink1",children:"Lien de Commande 1"}),e.jsx("input",{type:"url",id:"orderLink1",name:"orderLink1",value:r.orderLink1,onChange:i,placeholder:"https://exemple.com/produit"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"supplier2",children:"Fournisseur 2"}),e.jsx("input",{type:"text",id:"supplier2",name:"supplier2",value:r.supplier2,onChange:i,placeholder:"Nom du fournisseur"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orderLink2",children:"Lien de Commande 2"}),e.jsx("input",{type:"url",id:"orderLink2",name:"orderLink2",value:r.orderLink2,onChange:i,placeholder:"https://exemple.com/produit"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"supplier3",children:"Fournisseur 3"}),e.jsx("input",{type:"text",id:"supplier3",name:"supplier3",value:r.supplier3,onChange:i,placeholder:"Nom du fournisseur"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orderLink3",children:"Lien de Commande 3"}),e.jsx("input",{type:"url",id:"orderLink3",name:"orderLink3",value:r.orderLink3,onChange:i,placeholder:"https://exemple.com/produit"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:()=>p("/products"),className:"btn btn-secondary",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Ajouter le Produit"})]})]})]})};export{R as default};
