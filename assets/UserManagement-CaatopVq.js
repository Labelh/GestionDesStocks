import{u as X,j as e}from"./index-DNyQ5bXx.js";import{r as o}from"./react-vendor-DRM3MNr6.js";import"./supabase-g_Un6fVd.js";const ee=()=>{const{users:c,updateUserRole:R,createUser:A,updateUserBadge:$,deleteUser:H,currentUser:i}=X(),[t,m]=o.useState(null),[z,j]=o.useState(!1),[T,B]=o.useState(!1),[p,G]=o.useState(""),[a,v]=o.useState("all"),[g,k]=o.useState(""),[N,y]=o.useState(""),[d,b]=o.useState(""),[f,w]=o.useState(""),[l,h]=o.useState("user"),[M,n]=o.useState(""),[P,C]=o.useState(null),[S,u]=o.useState(""),U=c.filter(s=>{const r=s.name.toLowerCase().includes(p.toLowerCase())||s.username.toLowerCase().includes(p.toLowerCase()),L=a==="all"||s.role===a;return r&&L}),W=async(s,r)=>{try{await R(s,r),j(!1),m(null)}catch(L){console.error("Erreur lors de la modification du rôle:",L),alert("Erreur lors de la modification du rôle")}},V=s=>{m(s),j(!0)},E=()=>{m(null),j(!1)},q=()=>{B(!0),n(""),k(""),y(""),b(""),w(""),h("user")},x=()=>{B(!1),n(""),k(""),y(""),b(""),w(""),h("user")},O=async s=>{if(s.preventDefault(),n(""),!g||!N||!d){n("Tous les champs sont requis");return}if(d.length<6){n("Le mot de passe doit contenir au moins 6 caractères");return}try{const r=f.trim()!==""?f.trim():void 0;await A(g,N,d,l,r),x(),alert("Utilisateur créé avec succès !")}catch(r){n(r.message||"Erreur lors de la création de l'utilisateur")}},D=async s=>{try{await $(s,S.trim()||null),C(null),u(""),alert("Badge mis à jour avec succès !")}catch(r){alert(r.message||"Erreur lors de la mise à jour du badge")}},I=s=>{C(s.id),u(s.badgeNumber||"")},F=()=>{C(null),u("")},J=async s=>{if(s.id===(i==null?void 0:i.id)){alert("Vous ne pouvez pas supprimer votre propre compte");return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer l'utilisateur "${s.name}" ?`))try{await H(s.id),alert("Utilisateur supprimé avec succès")}catch(r){alert(r.message||"Erreur lors de la suppression de l'utilisateur")}},K=s=>s==="manager"?"role-badge-manager":"role-badge-user",Q=s=>s==="manager"?"Gestionnaire":"Utilisateur";return e.jsxs("div",{className:"user-management-container",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestion des Utilisateurs"}),e.jsx("p",{className:"subtitle",children:"Gérer les rôles et permissions des utilisateurs"})]}),e.jsxs("button",{className:"btn-create-user",onClick:q,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),e.jsx("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),e.jsx("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]}),"Nouvel Utilisateur"]})]}),e.jsxs("div",{className:"user-management-filters",children:[e.jsxs("div",{className:"search-box",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("input",{type:"text",placeholder:"Rechercher un utilisateur...",value:p,onChange:s=>G(s.target.value)})]}),e.jsxs("div",{className:"filter-tabs",children:[e.jsxs("button",{className:`filter-tab ${a==="all"?"active":""}`,onClick:()=>v("all"),children:["Tous (",c.length,")"]}),e.jsxs("button",{className:`filter-tab ${a==="manager"?"active":""}`,onClick:()=>v("manager"),children:["Gestionnaires (",c.filter(s=>s.role==="manager").length,")"]}),e.jsxs("button",{className:`filter-tab ${a==="user"?"active":""}`,onClick:()=>v("user"),children:["Utilisateurs (",c.filter(s=>s.role==="user").length,")"]})]})]}),e.jsx("div",{className:"users-grid",children:U.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("line",{x1:"19",y1:"8",x2:"19",y2:"14"}),e.jsx("line",{x1:"22",y1:"11",x2:"16",y2:"11"})]}),e.jsx("p",{children:"Aucun utilisateur trouvé"})]}):U.map(s=>e.jsxs("div",{className:"user-card",children:[e.jsxs("div",{className:"user-card-header",children:[e.jsx("div",{className:"user-avatar-large",children:s.name.charAt(0).toUpperCase()}),e.jsx("span",{className:`role-badge ${K(s.role)}`,children:Q(s.role)})]}),e.jsxs("div",{className:"user-card-body",children:[e.jsx("h3",{className:"user-card-name",children:s.name}),e.jsxs("p",{className:"user-card-username",children:["@",s.username]}),e.jsxs("div",{className:"user-card-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),e.jsx("span",{children:s.role==="manager"?"Accès complet":"Accès limité"})]}),P===s.id?e.jsxs("div",{className:"info-item badge-edit",style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("input",{type:"text",value:S,onChange:r=>u(r.target.value),placeholder:"Numéro de badge",style:{flex:1,padding:"0.375rem 0.5rem",fontSize:"0.85rem",border:"1px solid var(--border-color)",borderRadius:"4px",background:"var(--input-bg)",color:"var(--text-color)"}}),e.jsx("button",{onClick:()=>D(s.id),style:{padding:"0.375rem 0.75rem",fontSize:"0.85rem",background:"var(--accent-color)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"✓"}),e.jsx("button",{onClick:F,style:{padding:"0.375rem 0.75rem",fontSize:"0.85rem",background:"var(--bg-secondary)",color:"var(--text-color)",border:"1px solid var(--border-color)",borderRadius:"4px",cursor:"pointer"},children:"✕"})]}):e.jsxs("div",{className:"info-item",style:{marginTop:"0.5rem"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),e.jsx("span",{style:{flex:1},children:s.badgeNumber?`Badge: ${s.badgeNumber}`:"Aucun badge"}),e.jsx("button",{onClick:()=>I(s),style:{background:"transparent",border:"none",color:"var(--accent-color)",cursor:"pointer",fontSize:"0.85rem",padding:"0.25rem"},title:"Modifier le badge",children:"✏️"})]})]})]}),e.jsxs("div",{className:"user-card-actions",children:[e.jsxs("button",{className:"btn-modify-role",onClick:()=>V(s),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})]}),"Modifier le rôle"]}),s.id!==(i==null?void 0:i.id)&&e.jsx("button",{className:"btn-delete-user",onClick:()=>J(s),title:"Supprimer l'utilisateur",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},s.id))}),z&&t&&e.jsx("div",{className:"modal-overlay",onClick:E,children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Modifier le rôle"}),e.jsx("button",{className:"modal-close",onClick:E,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"user-info-modal",children:[e.jsx("div",{className:"user-avatar-large",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{children:t.name}),e.jsxs("p",{className:"text-muted",children:["@",t.username]})]})]}),e.jsxs("div",{className:"role-selection",children:[e.jsx("p",{className:"role-selection-label",children:"Sélectionnez le nouveau rôle :"}),e.jsxs("div",{className:"role-options",children:[e.jsxs("div",{className:`role-option ${t.role==="user"?"selected":""}`,onClick:()=>W(t.id,"user"),children:[e.jsx("div",{className:"role-option-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Utilisateur"}),e.jsx("p",{children:"Accès limité au catalogue et à ses demandes"})]}),t.role==="user"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]}),e.jsxs("div",{className:`role-option ${t.role==="manager"?"selected":""}`,onClick:()=>W(t.id,"manager"),children:[e.jsx("div",{className:"role-option-icon role-option-icon-manager",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Gestionnaire"}),e.jsx("p",{children:"Accès complet à toutes les fonctionnalités"})]}),t.role==="manager"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]})]})]})]})]})}),T&&e.jsx("div",{className:"modal-overlay",onClick:x,children:e.jsxs("div",{className:"modal-content create-user-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Créer un nouvel utilisateur"}),e.jsx("button",{className:"modal-close",onClick:x,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("form",{onSubmit:O,className:"modal-body",children:[M&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),M]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Nom d'utilisateur *"}),e.jsx("input",{type:"text",value:g,onChange:s=>k(s.target.value),placeholder:"Ex: jdupont",required:!0})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Nom complet *"}),e.jsx("input",{type:"text",value:N,onChange:s=>y(s.target.value),placeholder:"Ex: Jean Dupont",required:!0})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Mot de passe *"}),e.jsx("input",{type:"password",value:d,onChange:s=>b(s.target.value),placeholder:"Minimum 6 caractères",minLength:6,required:!0})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Numéro de badge (optionnel)"}),e.jsx("input",{type:"text",value:f,onChange:s=>w(s.target.value),placeholder:"Ex: 12345678"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.5rem"},children:"Permet la connexion par scan de badge"})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Rôle"}),e.jsxs("div",{className:"role-options-create",children:[e.jsxs("div",{className:`role-option-create ${l==="user"?"selected":""}`,onClick:()=>h("user"),children:[e.jsx("div",{className:"role-option-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Utilisateur"}),e.jsx("p",{children:"Accès limité au catalogue"})]}),l==="user"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]}),e.jsxs("div",{className:`role-option-create ${l==="manager"?"selected":""}`,onClick:()=>h("manager"),children:[e.jsx("div",{className:"role-option-icon role-option-icon-manager",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Gestionnaire"}),e.jsx("p",{children:"Accès complet à l'application"})]}),l==="manager"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]})]})]}),e.jsxs("div",{className:"modal-actions-create",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:x,children:"Annuler"}),e.jsxs("button",{type:"submit",className:"btn-submit",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),e.jsx("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),e.jsx("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]}),"Créer l'utilisateur"]})]})]})]})})]})};export{ee as default};
