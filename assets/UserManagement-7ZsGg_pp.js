import{u as K,j as e}from"./index-DlynR0Vu.js";import{r as c}from"./react-vendor-D8CQoBvY.js";import{J as Q}from"./JsBarcode-DPx7lVFH.js";import{E as Z}from"./heavy-libs-Bko_YaNF.js";import{s as _}from"./pdfTextUtils-D1ThJazT.js";import"./supabase-BffQhpPo.js";const ee=y=>{const S=y.filter(t=>t.badgeNumber&&t.badgeNumber.trim()!=="");if(S.length===0){alert("Aucun utilisateur n'a de numéro de badge défini.");return}const o=new Z({orientation:"portrait",unit:"mm",format:"a4"}),m=210,h=297,u=50,n=15,p=10,L=10,v=3,R=(m-2*p-v*u)/(v-1),E=5,f=()=>{o.setDrawColor(200,200,200);const t=2,d=2,j=v,w=(m-2*p)/j;for(let r=1;r<j;r++){const k=p+r*w;let g=0;for(;g<h;){const B=Math.min(g+t,h);o.line(k,g,k,B),g=B+d}}let i=0;for(;i<h;){const r=Math.min(i+t,h);o.line(0,i,0,r),i=r+d}for(i=0;i<h;){const r=Math.min(i+t,h);o.line(m,i,m,r),i=r+d}let a=0;for(;a<m;){const r=Math.min(a+t,m);o.line(a,0,r,0),a=r+d}for(a=0;a<m;){const r=Math.min(a+t,m);o.line(a,h,r,h),a=r+d}};f();let b=p,x=L,N=0;S.forEach(t=>{const d=document.createElement("canvas");try{Q(d,t.badgeNumber,{format:"CODE128",width:2,height:60,displayValue:!1,margin:5});const j=d.toDataURL("image/png");N>0&&N%v===0&&(b=p,x+=n+E+10),x+n+10>h-L&&(o.addPage(),f(),b=p,x=L),o.setFontSize(10),o.text(_(t.name),b+u/2,x,{align:"center"}),o.addImage(j,"PNG",b,x+5,u,n),b+=u+R,N++}catch(j){console.error(`Erreur lors de la génération du code-barre pour ${t.name}:`,j)}});const M=new Date().toISOString().split("T")[0];o.save(`badges-utilisateurs-${M}.pdf`)},ae=()=>{const{users:y,updateUserRole:S,createUser:o,updateUserBadge:m,deleteUser:h,currentUser:u}=K(),[n,p]=c.useState(null),[L,v]=c.useState(!1),[R,E]=c.useState(!1),[f,b]=c.useState(""),[x,N]=c.useState("all"),[M,t]=c.useState(""),[d,j]=c.useState(""),[w,i]=c.useState(""),[a,r]=c.useState(""),[k,g]=c.useState("user"),[B,C]=c.useState(""),[T,A]=c.useState(null),[$,W]=c.useState(""),H=y.filter(s=>{const l=s.name.toLowerCase().includes(f.toLowerCase())||s.username.toLowerCase().includes(f.toLowerCase()),P=x==="all"||s.role===x;return l&&P}),z=async(s,l)=>{try{await S(s,l),v(!1),p(null)}catch(P){console.error("Erreur lors de la modification du rôle:",P),alert("Erreur lors de la modification du rôle")}},G=s=>{p(s),v(!0)},D=()=>{p(null),v(!1)},O=()=>{E(!0),C(""),t(""),j(""),i(""),r(""),g("user")},U=()=>{E(!1),C(""),t(""),j(""),i(""),r(""),g("user")},V=async s=>{if(s.preventDefault(),C(""),!M||!d||!w){C("Tous les champs sont requis");return}if(w.length<6){C("Le mot de passe doit contenir au moins 6 caractères");return}try{const l=a.trim()!==""?a.trim():void 0;await o(M,d,w,k,l),U(),alert("Utilisateur créé avec succès !")}catch(l){C(l.message||"Erreur lors de la création de l'utilisateur")}},F=async s=>{try{await m(s,$.trim()||null),A(null),W(""),alert("Badge mis à jour avec succès !")}catch(l){alert(l.message||"Erreur lors de la mise à jour du badge")}},I=s=>{A(s.id),W(s.badgeNumber||"")},Y=()=>{A(null),W("")},q=async s=>{if(s.id===(u==null?void 0:u.id)){alert("Vous ne pouvez pas supprimer votre propre compte");return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer l'utilisateur "${s.name}" ?`))try{await h(s.id),alert("Utilisateur supprimé avec succès")}catch(l){alert(l.message||"Erreur lors de la suppression de l'utilisateur")}},X=s=>s==="manager"?"role-badge-manager":"role-badge-user",J=s=>s==="manager"?"Gestionnaire":"Utilisateur";return e.jsxs("div",{className:"user-management-container",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestion des Utilisateurs"}),e.jsx("p",{className:"subtitle",children:"Gérer les rôles et permissions des utilisateurs"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsxs("button",{className:"btn-create-user",onClick:()=>ee(y),style:{background:"var(--success-color)"},title:"Générer un PDF avec tous les codes-barres des badges",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"}),e.jsx("line",{x1:"7",y1:"16",x2:"17",y2:"16"})]}),"PDF Badges"]}),e.jsxs("button",{className:"btn-create-user",onClick:O,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),e.jsx("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),e.jsx("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]}),"Nouvel Utilisateur"]})]})]}),e.jsxs("div",{className:"user-management-filters",children:[e.jsxs("div",{className:"search-box",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("input",{type:"text",placeholder:"Rechercher un utilisateur...",value:f,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"filter-tabs",children:[e.jsxs("button",{className:`filter-tab ${x==="all"?"active":""}`,onClick:()=>N("all"),children:["Tous (",y.length,")"]}),e.jsxs("button",{className:`filter-tab ${x==="manager"?"active":""}`,onClick:()=>N("manager"),children:["Gestionnaires (",y.filter(s=>s.role==="manager").length,")"]}),e.jsxs("button",{className:`filter-tab ${x==="user"?"active":""}`,onClick:()=>N("user"),children:["Utilisateurs (",y.filter(s=>s.role==="user").length,")"]})]})]}),e.jsx("div",{className:"users-grid",children:H.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("line",{x1:"19",y1:"8",x2:"19",y2:"14"}),e.jsx("line",{x1:"22",y1:"11",x2:"16",y2:"11"})]}),e.jsx("p",{children:"Aucun utilisateur trouvé"})]}):H.map(s=>e.jsxs("div",{className:"user-card",children:[e.jsxs("div",{className:"user-card-header",children:[e.jsx("div",{className:"user-avatar-large",children:s.name.charAt(0).toUpperCase()}),e.jsx("span",{className:`role-badge ${X(s.role)}`,children:J(s.role)})]}),e.jsxs("div",{className:"user-card-body",children:[e.jsx("h3",{className:"user-card-name",children:s.name}),e.jsxs("p",{className:"user-card-username",children:["@",s.username]}),e.jsxs("div",{className:"user-card-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),e.jsx("span",{children:s.role==="manager"?"Accès complet":"Accès limité"})]}),T===s.id?e.jsxs("div",{className:"info-item badge-edit",style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("input",{type:"text",value:$,onChange:l=>W(l.target.value),placeholder:"Numéro de badge",style:{flex:1,padding:"0.375rem 0.5rem",fontSize:"0.85rem",border:"1px solid var(--border-color)",borderRadius:"4px",background:"var(--input-bg)",color:"var(--text-color)"}}),e.jsx("button",{onClick:()=>F(s.id),style:{padding:"0.375rem 0.75rem",fontSize:"0.85rem",background:"var(--accent-color)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"✓"}),e.jsx("button",{onClick:Y,style:{padding:"0.375rem 0.75rem",fontSize:"0.85rem",background:"var(--bg-secondary)",color:"var(--text-color)",border:"1px solid var(--border-color)",borderRadius:"4px",cursor:"pointer"},children:"✕"})]}):e.jsxs("div",{className:"info-item",style:{marginTop:"0.5rem"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),e.jsx("span",{style:{flex:1},children:s.badgeNumber?`Badge: ${s.badgeNumber}`:"Aucun badge"}),e.jsx("button",{onClick:()=>I(s),style:{background:"transparent",border:"none",color:"var(--accent-color)",cursor:"pointer",fontSize:"0.85rem",padding:"0.25rem"},title:"Modifier le badge",children:"✏️"})]})]})]}),e.jsxs("div",{className:"user-card-actions",children:[e.jsxs("button",{className:"btn-modify-role",onClick:()=>G(s),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})]}),"Modifier le rôle"]}),s.id!==(u==null?void 0:u.id)&&e.jsx("button",{className:"btn-delete-user",onClick:()=>q(s),title:"Supprimer l'utilisateur",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},s.id))}),L&&n&&e.jsx("div",{className:"modal-overlay",onClick:D,children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Modifier le rôle"}),e.jsx("button",{className:"modal-close",onClick:D,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"user-info-modal",children:[e.jsx("div",{className:"user-avatar-large",children:n.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{children:n.name}),e.jsxs("p",{className:"text-muted",children:["@",n.username]})]})]}),e.jsxs("div",{className:"role-selection",children:[e.jsx("p",{className:"role-selection-label",children:"Sélectionnez le nouveau rôle :"}),e.jsxs("div",{className:"role-options",children:[e.jsxs("div",{className:`role-option ${n.role==="user"?"selected":""}`,onClick:()=>z(n.id,"user"),children:[e.jsx("div",{className:"role-option-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Utilisateur"}),e.jsx("p",{children:"Accès limité au catalogue et à ses demandes"})]}),n.role==="user"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]}),e.jsxs("div",{className:`role-option ${n.role==="manager"?"selected":""}`,onClick:()=>z(n.id,"manager"),children:[e.jsx("div",{className:"role-option-icon role-option-icon-manager",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Gestionnaire"}),e.jsx("p",{children:"Accès complet à toutes les fonctionnalités"})]}),n.role==="manager"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]})]})]})]})]})}),R&&e.jsx("div",{className:"modal-overlay",onClick:U,children:e.jsxs("div",{className:"modal-content create-user-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Créer un nouvel utilisateur"}),e.jsx("button",{className:"modal-close",onClick:U,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("form",{onSubmit:V,className:"modal-body",children:[B&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),B]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Nom d'utilisateur *"}),e.jsx("input",{type:"text",value:M,onChange:s=>t(s.target.value),placeholder:"Ex: jdupont",required:!0})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Nom complet *"}),e.jsx("input",{type:"text",value:d,onChange:s=>j(s.target.value),placeholder:"Ex: Jean Dupont",required:!0})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Mot de passe *"}),e.jsx("input",{type:"password",value:w,onChange:s=>i(s.target.value),placeholder:"Minimum 6 caractères",minLength:6,required:!0})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Numéro de badge (optionnel)"}),e.jsx("input",{type:"text",value:a,onChange:s=>r(s.target.value),placeholder:"Ex: 12345678"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.5rem"},children:"Permet la connexion par scan de badge"})]}),e.jsxs("div",{className:"form-group-create",children:[e.jsx("label",{children:"Rôle"}),e.jsxs("div",{className:"role-options-create",children:[e.jsxs("div",{className:`role-option-create ${k==="user"?"selected":""}`,onClick:()=>g("user"),children:[e.jsx("div",{className:"role-option-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Utilisateur"}),e.jsx("p",{children:"Accès limité au catalogue"})]}),k==="user"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]}),e.jsxs("div",{className:`role-option-create ${k==="manager"?"selected":""}`,onClick:()=>g("manager"),children:[e.jsx("div",{className:"role-option-icon role-option-icon-manager",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"role-option-content",children:[e.jsx("h4",{children:"Gestionnaire"}),e.jsx("p",{children:"Accès complet à l'application"})]}),k==="manager"&&e.jsx("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]})]})]}),e.jsxs("div",{className:"modal-actions-create",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:U,children:"Annuler"}),e.jsxs("button",{type:"submit",className:"btn-submit",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),e.jsx("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),e.jsx("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]}),"Créer l'utilisateur"]})]})]})]})})]})};export{ae as default};
