import{u as k,j as s}from"./index-D0yL_qLc.js";import{r as h,L as S}from"./react-vendor-D8CQoBvY.js";import"./supabase-BffQhpPo.js";const D=()=>{const{products:d,stockMovements:o,getStockAlerts:v}=k(),x=v(),j=h.useMemo(()=>{const t=new Date,r=new Date(t.setMonth(t.getMonth()-1)),e=o.filter(n=>n.movementType==="exit"&&n.timestamp>=r),c=e.reduce((n,m)=>n+m.quantity,0),l=(c/30).toFixed(1),i={};e.forEach(n=>{i[n.productId]||(i[n.productId]={name:n.productDesignation,quantity:0}),i[n.productId].quantity+=n.quantity});const a=Object.values(i).sort((n,m)=>m.quantity-n.quantity).slice(0,3);return{totalExits:c,avgDailyConsumption:l,topProducts:a}},[o]),u=h.useMemo(()=>{const t=new Date,r=new Date(t.getTime()-30*24*60*60*1e3);return d.map(e=>{const l=o.filter(n=>n.productId===e.id&&n.movementType==="exit"&&n.timestamp>=r).reduce((n,m)=>n+m.quantity,0),i=l/30;let a=0;return i>0?a=Math.floor(e.currentStock/i):a=999,{product:e,daysRemaining:a,dailyConsumption:i.toFixed(2),monthlyConsumption:l.toFixed(0)}}).filter(e=>e.daysRemaining<30&&e.daysRemaining>0).sort((e,c)=>e.daysRemaining-c.daysRemaining).slice(0,5)},[d,o]),g=d.length,y=x.filter(t=>t.alertType==="low").length,N=x.filter(t=>t.alertType==="critical").length,f=h.useMemo(()=>d.reduce((t,r)=>{const e=r.unitPrice||0;return t+r.currentStock*e},0),[d]),p=h.useMemo(()=>{const t=new Date,r=new Date(t.getTime()-7*24*60*60*1e3),e=o.filter(a=>a.timestamp>=r),c=e.filter(a=>a.movementType==="entry").length,l=e.filter(a=>a.movementType==="exit").length,i=e.filter(a=>a.movementType==="adjustment").length;return{entries:c,exits:l,adjustments:i,total:e.length}},[o]);return s.jsxs("div",{className:"dashboard",children:[s.jsx("h1",{children:"Dashboard"}),s.jsxs("div",{className:"stats-grid",children:[s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Total Produits"}),s.jsx("p",{className:"stat-value",children:g})]})}),s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Stock Faible"}),s.jsx("p",{className:"stat-value",children:y})]})}),s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Stock Critique"}),s.jsx("p",{className:"stat-value",children:N})]})}),s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Valeur du Stock"}),s.jsxs("p",{className:"stat-value",children:[f.toLocaleString("fr-FR",{maximumFractionDigits:0})," €"]})]})})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem",marginBottom:"2rem"},children:[s.jsxs("div",{children:[s.jsx("h2",{style:{marginBottom:"1rem"},children:"Activité de la semaine (7 derniers jours)"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Entrées"}),s.jsx("p",{className:"stat-value",children:p.entries})]})}),s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Sorties"}),s.jsx("p",{className:"stat-value",children:p.exits})]})})]})]}),s.jsxs("div",{children:[s.jsx("h2",{style:{marginBottom:"1rem"},children:"Consommation ce mois"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Sorties totales"}),s.jsx("p",{className:"stat-value",children:j.totalExits})]})}),s.jsx("div",{className:"stat-card",children:s.jsxs("div",{className:"stat-content",children:[s.jsx("h3",{children:"Moyenne journalière"}),s.jsx("p",{className:"stat-value",children:j.avgDailyConsumption})]})})]})]})]}),u.length>0&&s.jsxs("div",{className:"alerts-section",children:[s.jsx("h2",{children:"Prévisions de Rupture de Stock"}),s.jsx("div",{className:"predictions-grid",children:u.map(t=>s.jsxs("div",{className:`prediction-card ${t.daysRemaining<=7?"critical":t.daysRemaining<=14?"warning":"normal"}`,children:[s.jsxs("div",{className:"prediction-header",children:[s.jsx("h3",{children:t.product.designation}),s.jsx("span",{style:{fontSize:"0.875rem",color:"var(--accent-color)",fontWeight:"600"},children:t.product.reference})]}),s.jsxs("div",{className:"prediction-body",children:[s.jsxs("div",{className:"prediction-days",children:[s.jsx("span",{className:"days-number",children:t.daysRemaining}),s.jsx("span",{className:"days-label",children:"jours"})]}),s.jsxs("div",{className:"prediction-details",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Stock:"})," ",t.product.currentStock," ",t.product.unit]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Conso. moy.:"})," ",t.dailyConsumption," / jour"]})]})]})]},t.product.id))}),u.length>=5&&s.jsx("p",{style:{textAlign:"center",marginTop:"1rem"},children:s.jsx(S,{to:"/products",className:"btn btn-secondary",children:"Voir tous les produits"})})]})]})};export{D as default};
