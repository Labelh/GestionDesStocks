const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-DhXfXYMv.js","assets/react-vendor-DRM3MNr6.js","assets/supabase-g_Un6fVd.js","assets/AddProduct-CW1ioxBt.js","assets/Products-BEfGMemY.js","assets/heavy-libs-Dn1T2gkY.js","assets/jspdf.plugin.autotable-CtA5BUKo.js","assets/JsBarcode-CmyaEkaf.js","assets/Settings-CNQEgCdU.js","assets/Requests-V7yn_phz.js","assets/Orders-CHwPTcGS.js","assets/Statistics-CICcXQeK.js","assets/UserCatalog-DTA_a05m.js","assets/UserCatalog-9hwq_QUF.css","assets/UserStatistics-cvJY7Zv_.js","assets/History-D2azTKTS.js","assets/Inventory-DhxsUEM7.js","assets/Inventory-CqlswDvP.css","assets/UserManagement-DzBOBLIy.js","assets/UserManagement-BTHCkYSO.css","assets/LabelGenerator-p02Qq0_X.js","assets/LabelGenerator-BCXE6jyD.css"])))=>i.map(i=>d[i]);
import{r as a,a as lt,u as oe,b as ct,R as de,L as dt,O as ut,B as pt,d as mt,e as M,N as G}from"./react-vendor-DRM3MNr6.js";import{c as gt,_ as z}from"./supabase-g_Un6fVd.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))m(p);new MutationObserver(p=>{for(const h of p)if(h.type==="childList")for(const _ of h.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&m(_)}).observe(document,{childList:!0,subtree:!0});function d(p){const h={};return p.integrity&&(h.integrity=p.integrity),p.referrerPolicy&&(h.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?h.credentials="include":p.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function m(p){if(p.ep)return;p.ep=!0;const h=d(p);fetch(p.href,h)}})();var Fe={exports:{}},ne={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ht=a,ft=Symbol.for("react.element"),xt=Symbol.for("react.fragment"),bt=Object.prototype.hasOwnProperty,yt=ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_t={key:!0,ref:!0,__self:!0,__source:!0};function Ge(c,s,d){var m,p={},h=null,_=null;d!==void 0&&(h=""+d),s.key!==void 0&&(h=""+s.key),s.ref!==void 0&&(_=s.ref);for(m in s)bt.call(s,m)&&!_t.hasOwnProperty(m)&&(p[m]=s[m]);if(c&&c.defaultProps)for(m in s=c.defaultProps,s)p[m]===void 0&&(p[m]=s[m]);return{$$typeof:ft,type:c,key:h,ref:_,props:p,_owner:yt.current}}ne.Fragment=xt;ne.jsx=Ge;ne.jsxs=Ge;Fe.exports=ne;var t=Fe.exports,ue={},He=lt;ue.createRoot=He.createRoot,ue.hydrateRoot=He.hydrateRoot;const vt="https://jxymbulpvnzzysfcsxvw.supabase.co",kt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4eW1idWxwdm56enlzZmNzeHZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNjc0OTAsImV4cCI6MjA3NTk0MzQ5MH0.J2EFM3FgswrWw1KGRmA-3t9fon0a_nff_0bcqEaeJCc",u=gt(vt,kt,{auth:{persistSession:!0,autoRefreshToken:!0}}),Je=a.createContext(void 0),$=()=>{const c=a.useContext(Je);if(!c)throw new Error("useApp must be used within an AppProvider");return c},jt=({children:c})=>{const[s,d]=a.useState(null),[m,p]=a.useState(!0),[h,_]=a.useState([]),[y,g]=a.useState([]),[w,C]=a.useState([]),[E,j]=a.useState([]),[b,T]=a.useState([]),[L,v]=a.useState([]),[f,P]=a.useState([]),[N,q]=a.useState([]),[U,R]=a.useState([]),[H,W]=a.useState([]),F=a.useMemo(()=>{const r=new Map;return y.forEach(e=>r.set(e.id,e)),r},[y]),K=a.useMemo(()=>{const r=new Map;return w.forEach(e=>r.set(e.name,e)),r},[w]),X=a.useMemo(()=>{const r=new Map;return E.forEach(e=>r.set(e.abbreviation,e)),r},[E]),Q=a.useMemo(()=>{const r=new Map;return b.forEach(e=>r.set(e.name,e)),r},[b]);a.useEffect(()=>{(async()=>{await Ke(),await Z()})()},[]);const Ke=a.useCallback(async()=>{try{const{data:{session:r}}=await u.auth.getSession();if(r!=null&&r.user){const{data:e}=await u.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",r.user.id).single();e&&d({id:e.id,username:e.username,password:"",role:e.role,name:e.name,badgeNumber:e.badge_number||void 0,alertEmail:e.alert_email||void 0,enableStockAlerts:e.enable_stock_alerts??!0,enableConsumptionAlerts:e.enable_consumption_alerts??!0})}}catch(r){console.error("Erreur lors de la vérification de l'utilisateur:",r)}finally{p(!1)}},[]),Z=a.useCallback(async()=>{try{await Promise.all([V(),Xe(),Qe(),et()]),await Promise.all([se(),tt(),rt(),ot(),nt(),ie()])}catch(r){console.error("Erreur lors du chargement des données:",r)}},[]),V=a.useCallback(async()=>{const{data:r,error:e}=await u.from("user_profiles").select("id, username, name, role, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").order("name");!e&&r&&_(r.map(o=>({id:o.id,username:o.username,password:"",role:o.role,name:o.name,badgeNumber:o.badge_number||void 0,alertEmail:o.alert_email||void 0,enableStockAlerts:o.enable_stock_alerts??!0,enableConsumptionAlerts:o.enable_consumption_alerts??!0})))},[]),pe=a.useCallback(async(r,e)=>{const{error:o}=await u.from("user_profiles").update({role:e}).eq("id",r);if(o)throw o;_(n=>n.map(i=>i.id===r?{...i,role:e}:i)),(s==null?void 0:s.id)===r&&d(n=>n?{...n,role:e}:null)},[s]),me=a.useCallback(async(r,e,o,n,i)=>{try{const{data:l}=await u.from("user_profiles").select("username").eq("username",r).maybeSingle();if(l)throw new Error("Cet identifiant existe déjà");if(i){const{data:O}=await u.from("user_profiles").select("badge_number").eq("badge_number",i).maybeSingle();if(O)throw new Error("Ce numéro de badge est déjà utilisé")}const x=`${r}@gestionstocks.app`,{data:S,error:A}=await u.auth.signUp({email:x,password:o,options:{emailRedirectTo:void 0,data:{username:r,name:e}}});if(A||!S.user)throw console.error("Erreur Auth Supabase:",A),new Error((A==null?void 0:A.message)||"Erreur lors de la création du compte");await new Promise(O=>setTimeout(O,500));const k={id:S.user.id,username:r,name:e,role:n,badge_number:i||null};console.log("Création du profil utilisateur:",k);const{data:Y,error:I}=await u.from("user_profiles").insert([k]).select();if(I)throw console.error("Erreur lors de la création du profil:",I),new Error("Erreur lors de la création du profil: "+I.message);console.log("Profil créé avec succès:",Y),await V()}catch(l){throw console.error("Erreur lors de la création de l'utilisateur:",l),l}},[V]),ge=a.useCallback(async(r,e)=>{if(e){const{data:n}=await u.from("user_profiles").select("id").eq("badge_number",e).neq("id",r).maybeSingle();if(n)throw new Error("Ce numéro de badge est déjà utilisé")}console.log("Mise à jour du badge:",{userId:r,badgeNumber:e});const{error:o}=await u.from("user_profiles").update({badge_number:e}).eq("id",r);if(o)throw console.error("Erreur lors de la mise à jour du badge:",o),o;if(console.log("Badge mis à jour avec succès"),await new Promise(n=>setTimeout(n,100)),await V(),(s==null?void 0:s.id)===r){const n=await u.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",r).single();n.data&&d({id:n.data.id,username:n.data.username,password:"",role:n.data.role,name:n.data.name,badgeNumber:n.data.badge_number||void 0,alertEmail:n.data.alert_email||void 0,enableStockAlerts:n.data.enable_stock_alerts??!0,enableConsumptionAlerts:n.data.enable_consumption_alerts??!0})}},[s,V]),he=a.useCallback(async r=>{if(!s)throw new Error("Aucun utilisateur connecté");console.log("Mise à jour du profil utilisateur:",{userId:s.id,updates:r});const e={};r.alertEmail!==void 0&&(e.alert_email=r.alertEmail),r.enableStockAlerts!==void 0&&(e.enable_stock_alerts=r.enableStockAlerts),r.enableConsumptionAlerts!==void 0&&(e.enable_consumption_alerts=r.enableConsumptionAlerts);const{error:o}=await u.from("user_profiles").update(e).eq("id",s.id);if(o)throw console.error("Erreur lors de la mise à jour du profil:",o),o;console.log("Profil mis à jour avec succès"),await V();const n=await u.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",s.id).single();n.data&&d({id:n.data.id,username:n.data.username,password:"",role:n.data.role,name:n.data.name,badgeNumber:n.data.badge_number||void 0,alertEmail:n.data.alert_email||void 0,enableStockAlerts:n.data.enable_stock_alerts??!0,enableConsumptionAlerts:n.data.enable_consumption_alerts??!0})},[s,V]),fe=a.useCallback(async r=>{try{if((s==null?void 0:s.id)===r)throw new Error("Vous ne pouvez pas supprimer votre propre compte");const{error:e}=await u.from("user_profiles").delete().eq("id",r);if(e)throw e;_(o=>o.filter(n=>n.id!==r))}catch(e){throw console.error("Erreur lors de la suppression de l'utilisateur:",e),e}},[s]),Xe=a.useCallback(async()=>{const{data:r,error:e}=await u.from("categories").select("id, name, description").order("name");!e&&r&&C(r.map(o=>({id:o.id,name:o.name,description:o.description||void 0})))},[]),xe=a.useCallback(async r=>{const{data:e,error:o}=await u.from("categories").insert([r]).select("id, name, description").single();if(!o&&e){const n={id:e.id,name:e.name,description:e.description||void 0};C(i=>[...i,n])}else throw o},[]),be=a.useCallback(async(r,e)=>{const{error:o}=await u.from("categories").update(e).eq("id",r);if(o)throw o;{C(i=>i.map(l=>l.id===r?{...l,...e}:l));const n=w.find(i=>i.id===r);n&&n.name!==e.name&&(await u.from("products").update({category:e.name}).eq("category",n.name),g(i=>i.map(l=>l.category===n.name?{...l,category:e.name}:l)))}},[w,y]),ye=a.useCallback(async r=>{const{error:e}=await u.from("categories").delete().eq("id",r);if(!e)C(o=>o.filter(n=>n.id!==r));else throw e},[]),Qe=a.useCallback(async()=>{const{data:r,error:e}=await u.from("units").select("id, name, abbreviation, is_default").order("name");!e&&r&&j(r.map(o=>({id:o.id,name:o.name,abbreviation:o.abbreviation,isDefault:o.is_default})))},[]),_e=a.useCallback(async r=>{const{data:e,error:o}=await u.from("units").insert([{...r,is_default:r.isDefault}]).select("id, name, abbreviation, is_default").single();if(!o&&e){const n={id:e.id,name:e.name,abbreviation:e.abbreviation,isDefault:e.is_default};j(i=>[...i,n])}else throw o},[]),ve=a.useCallback(async r=>{const{error:e}=await u.from("units").delete().eq("id",r);if(!e)j(o=>o.filter(n=>n.id!==r));else throw e},[]),et=a.useCallback(async()=>{const{data:r,error:e}=await u.from("storage_zones").select("id, name, description").order("name");!e&&r&&T(r.map(o=>({id:o.id,name:o.name,description:o.description||void 0})))},[]),ke=a.useCallback(async r=>{const{data:e,error:o}=await u.from("storage_zones").insert([r]).select("id, name, description").single();if(!o&&e){const n={id:e.id,name:e.name,description:e.description||void 0};T(i=>[...i,n])}else throw o},[]),je=a.useCallback(async(r,e)=>{const{data:o}=await u.from("storage_zones").select("*").eq("id",r).single(),{error:n}=await u.from("storage_zones").update(e).eq("id",r);if(n)throw n;if(T(i=>i.map(l=>l.id===r?{...l,...e}:l)),o&&o.name!==e.name){const{data:i}=await u.from("products").select("id, shelf, position").eq("storage_zone",o.name);if(i&&i.length>0)for(const l of i){const x=`${e.name}.${l.shelf||""}.${l.position||""}`;await u.from("products").update({storage_zone:e.name,location:x}).eq("id",l.id)}g(l=>l.map(x=>{if(x.storageZone===o.name){const S=`${e.name}.${x.shelf||""}.${x.position||""}`;return{...x,storageZone:e.name,location:S}}return x}))}},[]),we=a.useCallback(async r=>{const{error:e}=await u.from("storage_zones").delete().eq("id",r);if(!e)T(o=>o.filter(n=>n.id!==r));else throw e},[]),se=a.useCallback(async()=>{const{data:r,error:e}=await u.from("products").select(`
        id, reference, designation, category_id, storage_zone_id, shelf, position, location,
        current_stock, min_stock, max_stock, unit_id, unit_price, photo,
        order_link, order_link_1, supplier_1, order_link_2, supplier_2, order_link_3, supplier_3,
        deleted_at, created_at, updated_at,
        category:categories(name),
        storage_zone:storage_zones(name),
        unit:units(abbreviation)
      `).is("deleted_at",null).order("reference");!e&&r&&g(r.map(o=>{var n,i,l,x,S,A;return{id:o.id,reference:o.reference,designation:o.designation,category:Array.isArray(o.category)?((n=o.category[0])==null?void 0:n.name)||"":((i=o.category)==null?void 0:i.name)||"",storageZone:Array.isArray(o.storage_zone)?((l=o.storage_zone[0])==null?void 0:l.name)||void 0:((x=o.storage_zone)==null?void 0:x.name)||void 0,shelf:o.shelf||void 0,position:o.position||void 0,location:o.location,currentStock:o.current_stock,minStock:o.min_stock,maxStock:o.max_stock,unit:Array.isArray(o.unit)?((S=o.unit[0])==null?void 0:S.abbreviation)||"":((A=o.unit)==null?void 0:A.abbreviation)||"",unitPrice:o.unit_price||void 0,photo:o.photo||void 0,orderLink:o.order_link||void 0,orderLink1:o.order_link_1||void 0,supplier1:o.supplier_1||void 0,orderLink2:o.order_link_2||void 0,supplier2:o.supplier_2||void 0,orderLink3:o.order_link_3||void 0,supplier3:o.supplier_3||void 0,deletedAt:o.deleted_at?new Date(o.deleted_at):void 0,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)}}))},[]),Se=a.useCallback(async r=>{var x,S,A,k,Y,I,O,ce,re;const e=(x=K.get(r.category))==null?void 0:x.id,o=(S=X.get(r.unit))==null?void 0:S.id,n=r.storageZone?(A=Q.get(r.storageZone))==null?void 0:A.id:null;if(!e||!o)throw new Error("Catégorie ou unité invalide");const{data:i,error:l}=await u.from("products").insert([{reference:r.reference,designation:r.designation,category_id:e,storage_zone_id:n,shelf:r.shelf,position:r.position,location:r.location,current_stock:r.currentStock,min_stock:r.minStock,max_stock:r.maxStock,unit_id:o,unit_price:r.unitPrice,photo:r.photo,order_link:r.orderLink,order_link_1:r.orderLink1,supplier_1:r.supplier1,order_link_2:r.orderLink2,supplier_2:r.supplier2,order_link_3:r.orderLink3,supplier_3:r.supplier3}]).select(`
        id, reference, designation, current_stock, created_at, updated_at,
        category:categories(name),
        storage_zone:storage_zones(name),
        unit:units(abbreviation)
      `).single();if(!l&&i&&s){const B=i,at={...r,id:B.id,category:Array.isArray(B.category)?((k=B.category[0])==null?void 0:k.name)||r.category:((Y=B.category)==null?void 0:Y.name)||r.category,storageZone:Array.isArray(B.storage_zone)?((I=B.storage_zone[0])==null?void 0:I.name)||r.storageZone:((O=B.storage_zone)==null?void 0:O.name)||r.storageZone,unit:Array.isArray(B.unit)?((ce=B.unit[0])==null?void 0:ce.abbreviation)||r.unit:((re=B.unit)==null?void 0:re.abbreviation)||r.unit,createdAt:new Date(B.created_at),updatedAt:new Date(B.updated_at)};g(it=>[...it,at]),J({productId:i.id,productReference:i.reference,productDesignation:i.designation,movementType:"initial",quantity:i.current_stock,previousStock:0,newStock:i.current_stock,userId:s.id,userName:s.name,reason:"Création du produit"})}else throw l},[K,X,Q,s]),ee=a.useCallback(async(r,e,o=!1)=>{var x,S,A;const n=F.get(r);if(!n){console.error("❌ updateProduct: Produit introuvable:",r);return}const i={};if(e.designation!==void 0&&(i.designation=e.designation),e.category!==void 0){const k=(x=K.get(e.category))==null?void 0:x.id;k&&(i.category_id=k)}if(e.storageZone!==void 0){const k=(S=Q.get(e.storageZone))==null?void 0:S.id;k&&(i.storage_zone_id=k)}if(e.shelf!==void 0&&(i.shelf=e.shelf),e.position!==void 0&&(i.position=e.position),e.location!==void 0&&(i.location=e.location),e.currentStock!==void 0&&(i.current_stock=e.currentStock),e.minStock!==void 0&&(i.min_stock=e.minStock),e.maxStock!==void 0&&(i.max_stock=e.maxStock),e.unit!==void 0){const k=(A=X.get(e.unit))==null?void 0:A.id;k&&(i.unit_id=k)}e.photo!==void 0&&(i.photo=e.photo),e.orderLink!==void 0&&(i.order_link=e.orderLink),e.unitPrice!==void 0&&(i.unit_price=e.unitPrice),e.supplier1!==void 0&&(i.supplier_1=e.supplier1),e.orderLink1!==void 0&&(i.order_link_1=e.orderLink1),e.supplier2!==void 0&&(i.supplier_2=e.supplier2),e.orderLink2!==void 0&&(i.order_link_2=e.orderLink2),e.supplier3!==void 0&&(i.supplier_3=e.supplier3),e.orderLink3!==void 0&&(i.order_link_3=e.orderLink3);const{error:l}=await u.from("products").update(i).eq("id",r);if(l)throw console.error("Erreur mise à jour produit:",l),l;if(g(k=>k.map(I=>{if(I.id===r){const O=Object.fromEntries(Object.entries(e).filter(([ce,re])=>re!==void 0));return{...I,...O,updatedAt:new Date}}return I})),!o&&e.currentStock!==void 0&&e.currentStock!==n.currentStock&&s){const k=e.currentStock-n.currentStock;J({productId:n.id,productReference:n.reference,productDesignation:n.designation,movementType:k>0?"entry":k<0?"exit":"adjustment",quantity:Math.abs(k),previousStock:n.currentStock,newStock:e.currentStock,userId:s.id,userName:s.name,reason:"Ajustement manuel du stock"})}},[F,K,X,Q,s]),Ce=a.useCallback(async r=>{const{error:e}=await u.from("products").update({deleted_at:new Date().toISOString()}).eq("id",r);if(!e)g(o=>o.filter(n=>n.id!==r));else throw e},[]),Ee=a.useCallback(r=>F.get(r),[F]),Ae=a.useCallback(async()=>{const{data:r,error:e}=await u.from("products").select("reference");return e||!r?(console.error("Erreur lors de la récupération des références:",e),[]):r.map(o=>o.reference)},[]),tt=a.useCallback(async()=>{const{data:r,error:e}=await u.from("exit_requests").select("*").order("requested_at",{ascending:!1}).limit(500);if(e){console.error("Erreur lors du chargement des demandes:",e);return}if(r){const o=[...new Set([...r.map(l=>l.requested_by).filter(Boolean),...r.map(l=>l.approved_by).filter(Boolean)])],{data:n}=await u.from("user_profiles").select("id, username").in("id",o),i=new Map((n==null?void 0:n.map(l=>[l.id,l.username]))||[]);v(r.map(l=>({id:l.id,productId:l.product_id,productReference:l.product_reference,productDesignation:l.product_designation,productPhoto:l.product_photo,quantity:l.quantity,requestedBy:i.get(l.requested_by)||l.requested_by,requestedAt:new Date(l.requested_at),status:l.status,approvedBy:l.approved_by?i.get(l.approved_by)||l.approved_by:void 0,approvedAt:l.approved_at?new Date(l.approved_at):void 0,receivedAt:l.received_at?new Date(l.received_at):void 0,reason:l.reason||void 0,notes:l.notes||void 0})))}},[]),qe=a.useCallback(async r=>{if(!s)throw new Error("Utilisateur non connecté");const{data:e,error:o}=await u.from("exit_requests").insert([{product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,product_photo:r.productPhoto,quantity:r.quantity,requested_by:s.id,reason:r.reason,status:"pending"}]).select().single();if(o)throw console.error("Erreur lors de l'ajout de la demande:",o),o;const n={id:e.id,productId:e.product_id,productReference:e.product_reference,productDesignation:e.product_designation,productPhoto:e.product_photo,quantity:e.quantity,requestedBy:s.username,requestedAt:new Date(e.requested_at),status:e.status,reason:e.reason};v(i=>[n,...i])},[s]),Me=a.useCallback(async(r,e)=>{var l;const o=L.find(x=>x.id===r);if(!o)throw new Error("Demande introuvable");const n={};e.status&&(n.status=e.status),e.approvedBy&&(n.approved_by=e.approvedBy),e.notes&&(n.notes=e.notes),e.receivedAt&&(n.received_at=e.receivedAt.toISOString()),(e.status==="awaiting_reception"||e.status==="rejected")&&(n.approved_at=new Date().toISOString());const{error:i}=await u.from("exit_requests").update(n).eq("id",r);if(i)throw i;if(v(x=>x.map(S=>S.id===r?{...S,...e}:S)),e.status==="approved"&&s){const x=F.get(o.productId);if(x){const S=(l=o.reason)==null?void 0:l.startsWith("Écart de stock signalé"),A=S?o.quantity:x.currentStock-o.quantity,k=Math.abs(A-x.currentStock);await ee(x.id,{currentStock:A},!0),await J({productId:x.id,productReference:x.reference,productDesignation:x.designation,movementType:S?"adjustment":"exit",quantity:k,previousStock:x.currentStock,newStock:A,userId:s.id,userName:s.name,reason:S?o.reason||"Ajustement suite à écart de stock":`Sortie de stock - ${o.reason||"Demande approuvée"}`,notes:o.notes}),ae({productReference:x.reference,productDesignation:x.designation,storageZone:x.storageZone,shelf:x.shelf,position:x.position,quantity:o.quantity,requestedBy:o.requestedBy})}}},[L,F,s,ee]),Le=a.useCallback(async r=>{const{error:e}=await u.from("exit_requests").delete().eq("id",r);if(!e)v(o=>o.filter(n=>n.id!==r));else throw e},[]),rt=a.useCallback(async()=>{const{data:r,error:e}=await u.from("stock_movements").select("*").order("timestamp",{ascending:!1}).limit(500);!e&&r&&P(r.map(o=>({id:o.id,productId:o.product_id,productReference:o.product_reference,productDesignation:o.product_designation,movementType:o.movement_type,quantity:o.quantity,previousStock:o.previous_stock,newStock:o.new_stock,userId:o.user_id,userName:o.user_name,reason:o.reason,notes:o.notes||void 0,timestamp:new Date(o.timestamp)})))},[]),J=a.useCallback(async r=>{const{data:e,error:o}=await u.from("stock_movements").insert([{product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,movement_type:r.movementType,quantity:r.quantity,previous_stock:r.previousStock,new_stock:r.newStock,user_id:r.userId,user_name:r.userName,reason:r.reason,notes:r.notes}]).select().single();if(!o&&e){const n={id:e.id,productId:e.product_id,productReference:e.product_reference,productDesignation:e.product_designation,movementType:e.movement_type,quantity:e.quantity,previousStock:e.previous_stock,newStock:e.new_stock,userId:e.user_id,userName:e.user_name,reason:e.reason,notes:e.notes,timestamp:new Date(e.timestamp)};P(i=>[n,...i.slice(0,499)])}},[]),ot=a.useCallback(async()=>{const{data:r,error:e}=await u.from("orders").select("*").order("ordered_at",{ascending:!1}).limit(200);!e&&r&&q(r.map(o=>({id:o.id,product_id:o.product_id,product_reference:o.product_reference,product_designation:o.product_designation,quantity:o.quantity,ordered_by:o.ordered_by,ordered_by_name:o.ordered_by_name,ordered_at:new Date(o.ordered_at),received_at:o.received_at?new Date(o.received_at):void 0,status:o.status,notes:o.notes||void 0,created_at:new Date(o.created_at),updated_at:new Date(o.updated_at)})))},[]),Re=a.useCallback(async r=>{if(!s)throw new Error("Utilisateur non connecté");const{data:e,error:o}=await u.from("orders").insert([{product_id:r.product_id,product_reference:r.product_reference,product_designation:r.product_designation,quantity:r.quantity,ordered_by:s.id,ordered_by_name:s.name,status:"pending",notes:r.notes}]).select().single();if(o)throw o;if(e){const n={id:e.id,product_id:e.product_id,product_reference:e.product_reference,product_designation:e.product_designation,quantity:e.quantity,ordered_by:e.ordered_by,ordered_by_name:e.ordered_by_name,ordered_at:new Date(e.ordered_at),status:e.status,notes:e.notes,created_at:new Date(e.created_at),updated_at:new Date(e.updated_at)};q(i=>[n,...i])}},[s]),De=a.useCallback(async(r,e)=>{const o={};e.status!==void 0&&(o.status=e.status),e.received_at!==void 0&&(o.received_at=e.received_at),e.notes!==void 0&&(o.notes=e.notes);const{error:n}=await u.from("orders").update(o).eq("id",r);if(n)throw n;q(i=>i.map(l=>l.id===r?{...l,...e,updated_at:new Date}:l))},[]),Te=a.useCallback(()=>N.filter(r=>r.status==="pending"),[N]),ze=a.useCallback(()=>{const r=N.filter(o=>o.status==="received"&&o.received_at);if(r.length===0)return 0;const e=r.reduce((o,n)=>{const i=new Date(n.ordered_at).getTime(),x=(new Date(n.received_at).getTime()-i)/(1e3*60*60*24);return o+x},0);return Math.round(e/r.length*10)/10},[N]),Be=a.useCallback(()=>{const r=[];return y.forEach(e=>{if(e.currentStock<=e.minStock){const o=e.maxStock>0?e.currentStock/e.maxStock*100:0;r.push({product:e,alertType:e.currentStock===0?"critical":"low",percentage:Math.round(o)})}}),r.sort((e,o)=>e.percentage-o.percentage)},[y]),nt=a.useCallback(async()=>{if(s)try{const{data:r,error:e}=await u.from("pending_exits").select("*").eq("user_id",s.id).order("added_at",{ascending:!0});if(e)throw e;const o=(r||[]).map(n=>({id:n.id,productReference:n.product_reference,productDesignation:n.product_designation,storageZone:n.storage_zone,shelf:n.shelf,position:n.position,quantity:n.quantity,requestedBy:n.requested_by,addedAt:new Date(n.added_at)}));R(o)}catch(r){console.error("Erreur lors du chargement des sorties en attente:",r),R([])}},[s]),Pe=a.useCallback(()=>U,[U]),ae=a.useCallback(async r=>{if(!s){console.error("Utilisateur non connecté");return}try{const{data:e,error:o}=await u.from("pending_exits").insert({user_id:s.id,product_reference:r.productReference,product_designation:r.productDesignation,storage_zone:r.storageZone,shelf:r.shelf,position:r.position,quantity:r.quantity,requested_by:r.requestedBy}).select().single();if(o)throw o;const n={id:e.id,productReference:e.product_reference,productDesignation:e.product_designation,storageZone:e.storage_zone,shelf:e.shelf,position:e.position,quantity:e.quantity,requestedBy:e.requested_by,addedAt:new Date(e.added_at)};R(i=>[...i,n])}catch(e){throw console.error("Erreur lors de l'ajout de la sortie en attente:",e),e}},[s]),Ie=a.useCallback(async r=>{try{const{error:e}=await u.from("pending_exits").delete().eq("id",r);if(e)throw e;R(o=>o.filter(n=>n.id!==r))}catch(e){throw console.error("Erreur lors de la suppression de la sortie en attente:",e),e}},[]),Ne=a.useCallback(async()=>{if(s)try{const{error:r}=await u.from("pending_exits").delete().eq("user_id",s.id);if(r)throw r;R([])}catch(r){throw console.error("Erreur lors de la suppression des sorties en attente:",r),r}},[s]),ie=a.useCallback(async()=>{if(!s){W([]);return}try{const{data:r,error:e}=await u.from("user_cart").select("*").eq("user_id",s.id).order("added_at",{ascending:!0});if(e)throw e;const o=(r||[]).map(n=>({productId:n.product_id,productReference:n.product_reference,productDesignation:n.product_designation,quantity:n.quantity,maxStock:n.max_stock,photo:n.photo,storageZone:n.storage_zone,shelf:n.shelf,position:n.position,unit:n.unit}));W(o),console.log("Panier restauré depuis Supabase:",o)}catch(r){console.error("Erreur lors du chargement du panier:",r),W([])}},[s]),We=a.useCallback(async r=>{if(!s){console.error("Utilisateur non connecté");return}try{const e=H.find(o=>o.productId===r.productId);if(e)await le(r.productId,e.quantity+r.quantity);else{const{data:o,error:n}=await u.from("user_cart").insert({user_id:s.id,product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,quantity:r.quantity,max_stock:r.maxStock,photo:r.photo,storage_zone:r.storageZone,shelf:r.shelf,position:r.position,unit:r.unit}).select().single();if(n)throw n;const i={productId:o.product_id,productReference:o.product_reference,productDesignation:o.product_designation,quantity:o.quantity,maxStock:o.max_stock,photo:o.photo,storageZone:o.storage_zone,shelf:o.shelf,position:o.position,unit:o.unit};W(l=>[...l,i]),console.log("Article ajouté au panier Supabase:",i)}}catch(e){throw console.error("Erreur lors de l'ajout au panier:",e),e}},[s,H]),le=a.useCallback(async(r,e)=>{if(s)try{const{error:o}=await u.from("user_cart").update({quantity:e}).eq("user_id",s.id).eq("product_id",r);if(o)throw o;W(n=>n.map(i=>i.productId===r?{...i,quantity:e}:i)),console.log("Quantité mise à jour dans le panier Supabase:",r,e)}catch(o){throw console.error("Erreur lors de la mise à jour du panier:",o),o}},[s]),Oe=a.useCallback(async r=>{if(s)try{const{error:e}=await u.from("user_cart").delete().eq("user_id",s.id).eq("product_id",r);if(e)throw e;W(o=>o.filter(n=>n.productId!==r)),console.log("Article supprimé du panier Supabase:",r)}catch(e){throw console.error("Erreur lors de la suppression du panier:",e),e}},[s]),Ue=a.useCallback(async()=>{if(s)try{const{error:r}=await u.from("user_cart").delete().eq("user_id",s.id);if(r)throw r;W([]),console.log("Panier vidé dans Supabase")}catch(r){throw console.error("Erreur lors du vidage du panier:",r),r}},[s]),te=a.useCallback(async(r,e)=>{try{const{data:o}=await u.from("user_profiles").select("*").eq("username",r).single();if(!o)return!1;const n=`${r}@gestionstocks.app`,{data:i,error:l}=await u.auth.signInWithPassword({email:n,password:e});if(l||!i.user)return!1;d({id:o.id,username:o.username,password:"",role:o.role,name:o.name,badgeNumber:o.badge_number||void 0,alertEmail:o.alert_email||void 0,enableStockAlerts:o.enable_stock_alerts??!0,enableConsumptionAlerts:o.enable_consumption_alerts??!0}),await Z();try{const{data:x,error:S}=await u.from("pending_exits").select("*").eq("user_id",o.id).order("added_at",{ascending:!0});if(S)throw S;const A=(x||[]).map(k=>({id:k.id,productReference:k.product_reference,productDesignation:k.product_designation,storageZone:k.storage_zone,shelf:k.shelf,position:k.position,quantity:k.quantity,requestedBy:k.requested_by,addedAt:new Date(k.added_at)}));R(A)}catch(x){console.error("Erreur lors du chargement des sorties en attente:",x),R([])}return!0}catch(o){return console.error("Erreur de connexion:",o),!1}},[Z]),Ze=a.useCallback(async r=>{try{const{data:e}=await u.from("user_profiles").select("*").eq("badge_number",r).single();if(!e)return!1;d({id:e.id,username:e.username,password:"",role:e.role,name:e.name,badgeNumber:e.badge_number||void 0,alertEmail:e.alert_email||void 0,enableStockAlerts:e.enable_stock_alerts??!0,enableConsumptionAlerts:e.enable_consumption_alerts??!0}),await Z();try{const{data:o,error:n}=await u.from("pending_exits").select("*").eq("user_id",e.id).order("added_at",{ascending:!0});if(n)throw n;const i=(o||[]).map(l=>({id:l.id,productReference:l.product_reference,productDesignation:l.product_designation,storageZone:l.storage_zone,shelf:l.shelf,position:l.position,quantity:l.quantity,requestedBy:l.requested_by,addedAt:new Date(l.added_at)}));R(i)}catch(o){console.error("Erreur lors du chargement des sorties en attente:",o),R([])}return!0}catch(e){return console.error("Erreur de connexion par badge:",e),!1}},[Z]),Ve=a.useCallback(async(r,e,o)=>{try{const{data:n}=await u.from("user_profiles").select("username").eq("username",r).maybeSingle();if(n)return console.error("Cet identifiant existe déjà"),!1;const i=`${r}@gestionstocks.app`,{data:l,error:x}=await u.auth.signUp({email:i,password:o,options:{emailRedirectTo:void 0,data:{username:r,name:e}}});if(x||!l.user)return console.error("Erreur lors de la création du compte:",x),!1;await new Promise(A=>setTimeout(A,500));const{error:S}=await u.from("user_profiles").insert([{id:l.user.id,username:r,name:e,role:"user"}]);return S?(console.error("Erreur lors de la création du profil:",S),!1):(l.session?(d({id:l.user.id,username:r,password:"",role:"user",name:e,alertEmail:void 0,enableStockAlerts:!0,enableConsumptionAlerts:!0}),await Z()):await te(r,o),!0)}catch(n){return console.error("Erreur lors de l'inscription:",n),!1}},[Z,te]),$e=a.useCallback(async()=>{await u.auth.signOut(),d(null),g([]),v([]),P([]),q([]),R([]),W([])},[]),st=a.useMemo(()=>({currentUser:s,loading:m,login:te,loginWithBadge:Ze,register:Ve,logout:$e,users:h,updateUserRole:pe,createUser:me,updateUserBadge:ge,updateUserProfile:he,deleteUser:fe,products:y,addProduct:Se,updateProduct:ee,deleteProduct:Ce,getProductById:Ee,getAllProductReferences:Ae,reloadProducts:se,categories:w,addCategory:xe,updateCategory:be,deleteCategory:ye,units:E,addUnit:_e,deleteUnit:ve,storageZones:b,addStorageZone:ke,updateStorageZone:je,deleteStorageZone:we,exitRequests:L,addExitRequest:qe,updateExitRequest:Me,deleteExitRequest:Le,getStockAlerts:Be,stockMovements:f,addStockMovement:J,orders:N,addOrder:Re,updateOrder:De,getPendingOrders:Te,getAverageDeliveryTime:ze,pendingExits:U,getPendingExits:Pe,addPendingExit:ae,removePendingExit:Ie,clearPendingExits:Ne,userCart:H,loadUserCart:ie,addToUserCart:We,updateCartItem:le,removeFromUserCart:Oe,clearUserCart:Ue}),[s,m,te,Ze,Ve,$e,h,pe,me,ge,he,fe,y,Se,ee,Ce,Ee,Ae,se,w,xe,be,ye,E,_e,ve,b,ke,je,we,L,qe,Me,Le,Be,f,J,N,Re,De,Te,ze,U,Pe,ae,Ie,Ne,H,ie,We,le,Oe,Ue]);return m?t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"var(--bg-color)",color:"var(--text-color)"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"⏳"}),t.jsx("div",{children:"Chargement..."})]})}):t.jsx(Je.Provider,{value:st,children:c})},Ye=a.createContext(void 0),tr=()=>{const c=a.useContext(Ye);if(!c)throw new Error("useNotifications must be used within NotificationProvider");return c},wt=({children:c})=>{const[s,d]=a.useState([]),m=_=>{const y=Date.now().toString()+Math.random().toString(),g={..._,id:y,duration:_.duration||5e3};d(w=>[...w,g]),g.duration&&g.duration>0&&setTimeout(()=>{p(y)},g.duration)},p=_=>{d(y=>y.filter(g=>g.id!==_))},h={notifications:s,addNotification:m,removeNotification:p};return t.jsxs(Ye.Provider,{value:h,children:[c,t.jsx(St,{notifications:s,removeNotification:p})]})},St=({notifications:c,removeNotification:s})=>{if(c.length===0)return null;const d=m=>{switch(m){case"success":return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),t.jsx("path",{d:"M22 4L12 14.01l-3-3"})]});case"error":return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]});case"warning":return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),t.jsx("path",{d:"M12 9v4M12 17h.01"})]});case"info":default:return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M12 16v-4M12 8h.01"})]})}};return t.jsx("div",{className:"notification-container",children:c.map(m=>t.jsxs("div",{className:`notification ${m.type}`,children:[t.jsx("div",{className:`notification-icon ${m.type}`,children:d(m.type)}),t.jsxs("div",{className:"notification-content",children:[t.jsx("div",{className:"notification-title",children:m.title}),t.jsx("p",{className:"notification-message",children:m.message})]}),t.jsx("button",{className:"notification-close",onClick:()=>s(m.id),children:t.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},m.id))})};function Ct(c){const s=[];return c.forEach(d=>{if(!d.deletedAt&&d.currentStock<=d.minStock){const m=d.minStock>0?d.currentStock/d.minStock*100:0;s.push({type:"low_stock",productId:d.id,productReference:d.reference,productDesignation:d.designation,currentStock:d.currentStock,minStock:d.minStock,percentage:m,severity:m<=50?"critical":"warning"})}}),s}function Et(c,s){const d=[],m=new Date,p=new Date(m.getTime()-3*24*60*60*1e3),h=new Date(m.getTime()-30*24*60*60*1e3);return c.forEach(_=>{if(_.deletedAt)return;const y=s.filter(v=>v.productId===_.id&&v.movementType==="exit");if(y.length<5)return;const g=y.filter(v=>new Date(v.timestamp)>=p),w=y.filter(v=>new Date(v.timestamp)>=h&&new Date(v.timestamp)<p);if(w.length===0)return;const C=Math.max(1,(p.getTime()-h.getTime())/(24*60*60*1e3)),j=w.reduce((v,f)=>v+f.quantity,0)/C,b=Math.max(1,(m.getTime()-p.getTime())/(24*60*60*1e3)),L=g.reduce((v,f)=>v+f.quantity,0)/b;if(j>0){const v=(L-j)/j*100;v>50&&L>0&&d.push({type:"unusual_consumption",productId:_.id,productReference:_.reference,productDesignation:_.designation,averageDaily:j,recentDaily:L,percentageIncrease:v})}}),d}async function At(){const{data:c,error:s}=await u.from("user_profiles").select("id, username, name, role, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").not("alert_email","is",null).neq("alert_email","");return s||!c?(console.error("Erreur lors de la récupération des utilisateurs avec alertes:",s),[]):c.map(d=>({id:d.id,username:d.username,password:"",role:d.role,name:d.name,badgeNumber:d.badge_number||void 0,alertEmail:d.alert_email||void 0,enableStockAlerts:d.enable_stock_alerts??!0,enableConsumptionAlerts:d.enable_consumption_alerts??!0}))}async function qt(c,s,d){if(!c.alertEmail)return;const m=c.enableStockAlerts&&s.length>0,p=c.enableConsumptionAlerts&&d.length>0;if(!(!m&&!p))try{const{error:h}=await u.functions.invoke("send-alert-email",{body:{to:c.alertEmail,userName:c.name,stockAlerts:c.enableStockAlerts?s:[],consumptionAlerts:c.enableConsumptionAlerts?d:[]}});h?console.error("Erreur lors de l'envoi de l'email d'alerte:",h):console.log(`Email d'alerte envoyé à ${c.alertEmail}`)}catch(h){console.error("Erreur lors de l'invocation de la fonction d'envoi d'email:",h)}}async function Mt(c,s){console.log("Vérification des alertes...");const d=Ct(c),m=Et(c,s);if(console.log(`Détecté: ${d.length} alertes de stock, ${m.length} alertes de consommation`),d.length===0&&m.length===0){console.log("Aucune alerte à envoyer");return}const p=await At();if(p.length===0){console.log("Aucun utilisateur avec alertes activées");return}for(const h of p)await qt(h,d,m);console.log(`Alertes envoyées à ${p.length} utilisateur(s)`)}function Lt(c={}){const{currentUser:s,products:d,stockMovements:m}=$(),{enabled:p=(s==null?void 0:s.role)==="manager",intervalMinutes:h=60}=c,_=a.useRef(null),y=a.useRef(null),g=a.useCallback(async()=>{if(!p||!s||s.role!=="manager")return;const C=new Date;console.log(`[AlertMonitor] Vérification des alertes à ${C.toLocaleTimeString()}`);try{await Mt(d,m),_.current=C}catch(E){console.error("[AlertMonitor] Erreur lors de la vérification des alertes:",E)}},[p,s,d,m]);a.useEffect(()=>{if(!p){y.current&&(clearInterval(y.current),y.current=null);return}const C=setTimeout(()=>{g()},3e4);return y.current=setInterval(()=>{g()},h*60*1e3),()=>{clearTimeout(C),y.current&&(clearInterval(y.current),y.current=null)}},[p,h,g]);const w=a.useCallback(()=>{g()},[g]);return{lastCheck:_.current,forceCheck:w}}const Rt=()=>(Lt({enabled:!0,intervalMinutes:60}),null),Dt=()=>{const[c,s]=a.useState(""),[d,m]=a.useState(""),[p,h]=a.useState(!1),[_,y]=a.useState(""),[g,w]=a.useState(!1),{login:C}=$(),E=oe(),j=async b=>{if(b.preventDefault(),y(""),w(!0),!c||!d){y("Veuillez remplir tous les champs"),w(!1);return}await C(c,d)||y("Identifiants incorrects"),w(!1)};return t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:t.jsxs("div",{style:{background:"var(--card-bg)",padding:"2.5rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"420px",border:"1px solid var(--border-color)"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1.5rem"},children:t.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),t.jsx("h2",{style:{textAlign:"center",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Connexion"}),t.jsx("p",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"0.95rem"},children:"Gestion des Stocks"}),t.jsxs("form",{onSubmit:j,children:[t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Nom d'utilisateur"}),t.jsx("input",{type:"text",value:c,onChange:b=>s(b.target.value),placeholder:"Entrez votre nom d'utilisateur",disabled:g,style:{width:"100%",padding:"0.875rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:b=>b.target.style.borderColor="var(--border-color)",onBlur:b=>b.target.style.borderColor="var(--border-color)"})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Mot de passe"}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx("input",{type:p?"text":"password",value:d,onChange:b=>m(b.target.value),placeholder:"Entrez votre mot de passe",disabled:g,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:b=>b.target.style.borderColor="var(--border-color)",onBlur:b=>b.target.style.borderColor="var(--border-color)"}),t.jsx("button",{type:"button",onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1),onTouchStart:()=>h(!0),onTouchEnd:()=>h(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":p?"Masquer le mot de passe":"Afficher le mot de passe",children:p?t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),t.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),_&&t.jsx("div",{style:{padding:"0.875rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.9rem"},children:_}),t.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[t.jsx("button",{type:"submit",disabled:g,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.7:1},onMouseEnter:b=>{g||(b.currentTarget.style.background="rgba(128, 128, 128, 0.2)",b.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:b=>{b.currentTarget.style.background="transparent",b.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:g?"Connexion...":"Se connecter"}),t.jsx("button",{type:"button",onClick:()=>E("/register"),disabled:g,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.7:1},onMouseEnter:b=>{g||(b.currentTarget.style.background="rgba(128, 128, 128, 0.2)",b.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:b=>{b.currentTarget.style.background="transparent",b.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:"S'inscrire"})]})]}),t.jsx("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"1.5rem",marginTop:"1.5rem",textAlign:"center"},children:t.jsxs("button",{type:"button",onClick:()=>E("/badge-login"),disabled:g,style:{padding:"0.875rem 1.5rem",background:"transparent",color:"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",fontSize:"0.9rem",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.5:1,display:"inline-flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:b=>{g||(b.currentTarget.style.background="rgba(128, 128, 128, 0.1)")},onMouseLeave:b=>{b.currentTarget.style.background="transparent"},children:[t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),t.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),t.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),"Connexion par badge"]})})]})})},Tt=()=>{const[c,s]=a.useState(""),[d,m]=a.useState(""),[p,h]=a.useState(!1),[_,y]=a.useState(!1),{loginWithBadge:g}=$(),w=oe(),C=a.useRef(null),E=4,j=20,b=300;a.useEffect(()=>{var v;(v=C.current)==null||v.focus()},[]),a.useEffect(()=>{if(c.length>=E&&c.length<=j){const v=setTimeout(()=>{T()},b);return()=>clearTimeout(v)}},[c]);const T=async()=>{var v,f;if(!(!c.trim()||p)){m(""),h(!0),y(!0);try{await g(c.trim())||(m("Badge non reconnu"),s(""),(v=C.current)==null||v.focus())}catch{m("Erreur lors de la connexion"),s(""),(f=C.current)==null||f.focus()}finally{h(!1),setTimeout(()=>y(!1),500)}}},L=v=>{const f=v.target.value;/^[a-zA-Z0-9]*$/.test(f)&&(s(f),m(""))};return t.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:[t.jsxs("div",{style:{background:"var(--card-bg)",padding:"3rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"500px",border:"1px solid var(--border-color)",textAlign:"center"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"2rem",animation:_?"pulse 1s infinite":"none"},children:t.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:_?"#10b981":"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),t.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),t.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"}),t.jsx("line",{x1:"7",y1:"16",x2:"13",y2:"16"})]})}),t.jsx("h2",{style:{marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Scanner votre badge"}),t.jsx("p",{style:{marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"1rem"},children:"Utilisez le lecteur code-barre ou saisissez manuellement"}),t.jsx("div",{style:{marginBottom:"2rem"},children:t.jsx("input",{ref:C,type:"text",value:c,onChange:L,placeholder:"Numéro de badge",disabled:p,autoComplete:"off",style:{width:"100%",padding:"1.25rem",background:"var(--input-bg)",border:`2px solid ${d?"#ef4444":_?"#10b981":"var(--border-color)"}`,borderRadius:"8px",color:"var(--text-color)",fontSize:"1.5rem",textAlign:"center",fontFamily:"monospace",fontWeight:"600",letterSpacing:"0.2rem",transition:"all 0.3s",outline:"none"}})}),_&&t.jsx("div",{style:{padding:"1rem",background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"8px",color:"#10b981",marginBottom:"1.5rem",fontSize:"0.95rem",fontWeight:"500"},children:"✓ Badge détecté, connexion en cours..."}),d&&t.jsxs("div",{style:{padding:"1rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.95rem",fontWeight:"500"},children:["✕ ",d]}),t.jsx("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"1.5rem",marginTop:"1.5rem"},children:t.jsx("button",{type:"button",onClick:()=>w("/login"),disabled:p,style:{padding:"0.875rem 1.5rem",background:"transparent",color:"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",fontSize:"0.9rem",cursor:p?"not-allowed":"pointer",transition:"all 0.2s",opacity:p?.5:1},onMouseEnter:v=>{p||(v.currentTarget.style.background="rgba(128, 128, 128, 0.1)")},onMouseLeave:v=>{v.currentTarget.style.background="transparent"},children:"Connexion classique"})})]}),t.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
            opacity: 1;
          }
          50% {
            transform: scale(1.05);
            opacity: 0.8;
          }
        }
      `})]})},zt=()=>{const[c,s]=a.useState(""),[d,m]=a.useState(""),[p,h]=a.useState(""),[_,y]=a.useState(!1),[g,w]=a.useState(!1),[C,E]=a.useState(""),[j,b]=a.useState(!1),{register:T}=$(),L=oe(),v=async f=>{if(f.preventDefault(),E(""),!c||!d||!p){E("Tous les champs sont obligatoires");return}if(c.length<3){E("L'identifiant doit contenir au moins 3 caractères");return}if(d.length<6){E("Le mot de passe doit contenir au moins 6 caractères");return}if(d!==p){E("Les mots de passe ne correspondent pas");return}b(!0);try{console.log("Tentative d'inscription avec:",{username:c});const P=await T(c,c,d);console.log("Résultat inscription:",P),P?L("/catalog"):E("Échec de l'inscription. Vérifiez la console pour plus de détails.")}catch(P){console.error("Erreur d'inscription:",P),E("Une erreur est survenue lors de l'inscription. Vérifiez la console pour plus de détails.")}finally{b(!1)}};return t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:t.jsxs("div",{style:{background:"var(--card-bg)",padding:"2.5rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"420px",border:"1px solid var(--border-color)"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1.5rem"},children:t.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),t.jsx("h2",{style:{textAlign:"center",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Créer un compte"}),t.jsx("p",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"0.95rem"},children:"Gestion des Stocks"}),t.jsxs("form",{onSubmit:v,children:[t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Identifiant"}),t.jsx("input",{type:"text",value:c,onChange:f=>s(f.target.value),placeholder:"Entrez votre identifiant",disabled:j,style:{width:"100%",padding:"0.875rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Mot de passe"}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx("input",{type:_?"text":"password",value:d,onChange:f=>m(f.target.value),placeholder:"Entrez votre mot de passe",disabled:j,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"}),t.jsx("button",{type:"button",onMouseDown:()=>y(!0),onMouseUp:()=>y(!1),onMouseLeave:()=>y(!1),onTouchStart:()=>y(!0),onTouchEnd:()=>y(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":_?"Masquer le mot de passe":"Afficher le mot de passe",children:_?t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),t.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Confirmer le mot de passe"}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx("input",{type:g?"text":"password",value:p,onChange:f=>h(f.target.value),placeholder:"Confirmez votre mot de passe",disabled:j,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"}),t.jsx("button",{type:"button",onMouseDown:()=>w(!0),onMouseUp:()=>w(!1),onMouseLeave:()=>w(!1),onTouchStart:()=>w(!0),onTouchEnd:()=>w(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":g?"Masquer le mot de passe":"Afficher le mot de passe",children:g?t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),t.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),C&&t.jsx("div",{style:{padding:"0.875rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.9rem"},children:C}),t.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[t.jsx("button",{type:"button",onClick:()=>L("/"),disabled:j,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:j?"not-allowed":"pointer",transition:"all 0.2s",opacity:j?.7:1},onMouseEnter:f=>{j||(f.currentTarget.style.background="rgba(128, 128, 128, 0.2)",f.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:f=>{f.currentTarget.style.background="transparent",f.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:"Se connecter"}),t.jsx("button",{type:"submit",disabled:j,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:j?"not-allowed":"pointer",transition:"all 0.2s",opacity:j?.7:1},onMouseEnter:f=>{j||(f.currentTarget.style.background="rgba(128, 128, 128, 0.2)",f.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:f=>{f.currentTarget.style.background="transparent",f.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:j?"Création...":"S'inscrire"})]})]})]})})},Bt=()=>{const{currentUser:c,logout:s,exitRequests:d,getPendingExits:m,getPendingOrders:p}=$(),h=oe(),_=ct(),[y,g]=de.useState(!1),w=()=>{s(),h("/")},C=()=>{g(!y)},E=()=>{g(!1)},j=(c==null?void 0:c.role)==="manager",b=de.useMemo(()=>{const q=d.filter(R=>R.status==="pending"),U=new Set;return q.forEach(R=>{const H=`${R.requestedBy}-${new Date(R.requestedAt).toISOString().slice(0,16)}`;U.add(H)}),U.size},[d]),T=m().length,L=p().length,v=q=>_.pathname===q,N=j?[{path:"/dashboard",label:"Tableau de bord",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),t.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),t.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),t.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})},{path:"/products",label:"Produits",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})},{path:"/add-product",label:"Ajouter Produit",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})},{path:"/orders",label:"Réception",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),t.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),t.jsx("path",{d:"M9 12h6"}),t.jsx("path",{d:"M9 16h6"})]})},{path:"/requests",label:"Vérifications",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14 2 14 8 20 8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),t.jsx("polyline",{points:"10 9 9 9 8 9"})]})},{path:"/inventory",label:"Inventaire",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14 2 14 8 20 8"}),t.jsx("path",{d:"M9 15h6"}),t.jsx("path",{d:"M12 12v6"})]})},{path:"/statistics",label:"Statistiques",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),t.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),t.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})},{path:"/history",label:"Historique",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("polyline",{points:"12 6 12 12 16 14"})]})},{path:"/user-management",label:"Gestion Utilisateurs",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"9",cy:"7",r:"4"}),t.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),t.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},{path:"/label-generator",label:"Étiquettes",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),t.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]})},{path:"/settings",label:"Paramètres",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"12",cy:"12",r:"3"}),t.jsx("path",{d:"M12 1v6m0 6v6m5.196-13.804l-4.242 4.242m-5.908 5.908l-4.242 4.242M23 12h-6m-6 0H1m18.196 5.196l-4.242-4.242m-5.908-5.908L4.804 2.804"})]})}]:[{path:"/catalog",label:"Catalogue",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),t.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]})},{path:"/my-statistics",label:"Mes Statistiques",icon:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),t.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),t.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})}];return t.jsxs("div",{className:"layout-container",children:[t.jsx("button",{className:"mobile-menu-button",onClick:C,children:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),t.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),t.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),y&&t.jsx("div",{className:"mobile-menu-overlay",onClick:E}),t.jsxs("aside",{className:`sidebar ${y?"open":""}`,children:[t.jsxs("div",{className:"sidebar-header",children:[t.jsx("div",{className:"sidebar-logo",children:t.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"})})}),t.jsxs("div",{className:"sidebar-title-container",children:[t.jsx("h1",{className:"sidebar-title",children:"StockPro"}),t.jsx("p",{className:"sidebar-subtitle",children:"Ajust'82"})]})]}),t.jsx("nav",{className:"sidebar-nav",children:N.map(q=>t.jsxs(dt,{to:q.path,className:`sidebar-link ${v(q.path)?"active":""}`,title:q.label,onClick:E,children:[t.jsx("span",{className:"sidebar-link-icon",children:q.icon}),t.jsx("span",{className:"sidebar-link-label",children:q.label}),q.path==="/requests"&&b>0&&t.jsx("span",{className:"sidebar-badge",children:b}),q.path==="/orders"&&L>0&&t.jsx("span",{className:"sidebar-badge",children:L}),q.path==="/exit-sheet"&&T>0&&t.jsx("span",{className:"sidebar-badge",children:T})]},q.path))}),t.jsxs("div",{className:"sidebar-footer",children:[t.jsxs("div",{className:"sidebar-user",children:[t.jsx("div",{className:"user-avatar",children:c==null?void 0:c.name.charAt(0).toUpperCase()}),t.jsxs("div",{className:"user-info",children:[t.jsx("div",{className:"user-name",children:c==null?void 0:c.name}),t.jsx("div",{className:"user-role",children:j?"Gestionnaire":"Utilisateur"})]})]}),t.jsx("div",{className:"footer-actions",children:t.jsx("button",{onClick:w,className:"btn-logout",title:"Déconnexion",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t.jsx("polyline",{points:"16 17 21 12 16 7"}),t.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})})]})]}),t.jsx("main",{className:"main-content",children:t.jsx(ut,{})})]})},Pt=a.lazy(()=>z(()=>import("./Dashboard-DhXfXYMv.js"),__vite__mapDeps([0,1,2]))),It=a.lazy(()=>z(()=>import("./AddProduct-CW1ioxBt.js"),__vite__mapDeps([3,1,2]))),Nt=a.lazy(()=>z(()=>import("./Products-BEfGMemY.js"),__vite__mapDeps([4,1,5,2,6,7]))),Wt=a.lazy(()=>z(()=>import("./Settings-CNQEgCdU.js"),__vite__mapDeps([8,1,2]))),Ot=a.lazy(()=>z(()=>import("./Requests-V7yn_phz.js"),__vite__mapDeps([9,1,2]))),Ut=a.lazy(()=>z(()=>import("./Orders-CHwPTcGS.js"),__vite__mapDeps([10,1,2]))),Zt=a.lazy(()=>z(()=>import("./Statistics-CICcXQeK.js"),__vite__mapDeps([11,1,2]))),Vt=a.lazy(()=>z(()=>import("./UserCatalog-DTA_a05m.js"),__vite__mapDeps([12,1,2,13]))),$t=a.lazy(()=>z(()=>import("./UserStatistics-cvJY7Zv_.js"),__vite__mapDeps([14,1,2]))),Ht=a.lazy(()=>z(()=>import("./History-D2azTKTS.js"),__vite__mapDeps([15,1,5,2,6]))),Ft=a.lazy(()=>z(()=>import("./Inventory-DhxsUEM7.js"),__vite__mapDeps([16,1,2,17]))),Gt=a.lazy(()=>z(()=>import("./UserManagement-DzBOBLIy.js"),__vite__mapDeps([18,1,2,19]))),Jt=a.lazy(()=>z(()=>import("./LabelGenerator-p02Qq0_X.js"),__vite__mapDeps([20,1,7,5,2,21]))),Yt=()=>t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh",flexDirection:"column",gap:"1.5rem"},children:[t.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),t.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]}),t.jsx("p",{style:{fontSize:"1.1rem",color:"var(--text-secondary)",fontWeight:"500"},children:"Chargement..."})]}),D=({children:c,allowedRole:s})=>{const{currentUser:d}=$();return d?s&&d.role!==s?t.jsx(G,{to:d.role==="manager"?"/dashboard":"/catalog",replace:!0}):t.jsx(t.Fragment,{children:c}):t.jsx(G,{to:"/",replace:!0})},Kt=()=>{const{currentUser:c}=$();return t.jsxs(t.Fragment,{children:[c&&t.jsx(Rt,{}),t.jsxs(mt,{children:[t.jsx(M,{path:"/",element:c?t.jsx(G,{to:c.role==="manager"?"/dashboard":"/catalog",replace:!0}):t.jsx(Dt,{})}),t.jsx(M,{path:"/register",element:c?t.jsx(G,{to:c.role==="manager"?"/dashboard":"/catalog",replace:!0}):t.jsx(zt,{})}),t.jsx(M,{path:"/badge-login",element:c?t.jsx(G,{to:c.role==="manager"?"/dashboard":"/catalog",replace:!0}):t.jsx(Tt,{})}),t.jsxs(M,{element:t.jsx(D,{children:t.jsx(a.Suspense,{fallback:t.jsx(Yt,{}),children:t.jsx(Bt,{})})}),children:[t.jsx(M,{path:"/dashboard",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Pt,{})})}),t.jsx(M,{path:"/products",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Nt,{})})}),t.jsx(M,{path:"/add-product",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(It,{})})}),t.jsx(M,{path:"/settings",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Wt,{})})}),t.jsx(M,{path:"/requests",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Ot,{})})}),t.jsx(M,{path:"/orders",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Ut,{})})}),t.jsx(M,{path:"/history",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Ht,{})})}),t.jsx(M,{path:"/statistics",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Zt,{})})}),t.jsx(M,{path:"/inventory",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Ft,{})})}),t.jsx(M,{path:"/user-management",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Gt,{})})}),t.jsx(M,{path:"/label-generator",element:t.jsx(D,{allowedRole:"manager",children:t.jsx(Jt,{})})}),t.jsx(M,{path:"/catalog",element:t.jsx(D,{allowedRole:"user",children:t.jsx(Vt,{})})}),t.jsx(M,{path:"/my-statistics",element:t.jsx(D,{allowedRole:"user",children:t.jsx($t,{})})})]}),t.jsx(M,{path:"*",element:t.jsx(G,{to:"/",replace:!0})})]})]})},Xt=()=>t.jsx(pt,{basename:"/GestionDesStocks",children:t.jsx(jt,{children:t.jsx(wt,{children:t.jsx(Kt,{})})})});ue.createRoot(document.getElementById("root")).render(t.jsx(de.StrictMode,{children:t.jsx(Xt,{})}));export{tr as a,Mt as c,t as j,$ as u};
