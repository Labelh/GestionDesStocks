import{u as ot,a as nt,j as t}from"./index-BHdnVhBT.js";import{r as m}from"./react-vendor-DRM3MNr6.js";import{E as we,u as ce,w as st}from"./heavy-libs-Dn1T2gkY.js";import{a as it}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{J as at}from"./JsBarcode-CmyaEkaf.js";import"./supabase-g_Un6fVd.js";const xt=()=>{const{products:S,updateProduct:G,deleteProduct:Ne,categories:q,units:Le,storageZones:Pe,stockMovements:de,addOrder:Te,getPendingOrders:he,updateOrder:Ee,getAverageDeliveryTime:ze}=ot(),{addNotification:me}=nt(),[z,De]=m.useState(""),[W,Re]=m.useState(""),[O,Ie]=m.useState(""),[a,X]=m.useState(null),[r,l]=m.useState({}),[C,ue]=m.useState(null),[J,K]=m.useState(0),[u,xe]=m.useState(null),[F,ee]=m.useState(null),[A,B]=m.useState(0),[D,te]=m.useState(1),re=25,oe=m.useRef(null),Me=e=>he().filter(s=>s.product_id===e).reduce((s,n)=>s+n.quantity,0),[We,$]=m.useState(!1),[c,T]=m.useState({includePhotos:!0,includeBarcodes:!0,includeStock:!0,includeLocation:!0,selectedCategories:[]}),ge=e=>{if(e.minStock===0)return"normal";const o=e.currentStock/e.minStock;return o<.5?"critical":o<1?"low":"normal"},pe=e=>e?e.replace(/√âtag√®re\s*/gi,"").replace(/Position\s*/gi,"").replace(/\s*-\s*/g,"-").replace(/\.+/g,"-").replace(/-+/g,"-"):"",ve=m.useMemo(()=>{const e=new Date,o=new Date(e.getTime()-30*24*60*60*1e3),s={};return S.forEach(n=>{const I=de.filter(v=>v.productId===n.id&&v.movementType==="exit"&&v.timestamp>=o).reduce((v,U)=>v+U.quantity,0)/30;s[n.id]=I}),s},[S,de]),Z=S.filter(e=>{const o=e.reference.toLowerCase().includes(z.toLowerCase())||e.designation.toLowerCase().includes(z.toLowerCase())||e.customerReference&&e.customerReference.toLowerCase().includes(z.toLowerCase()),s=!W||e.category===W;let n=!0;return O&&(n=ge(e)===O),o&&s&&n}),_=Math.ceil(Z.length/re),fe=(D-1)*re,Oe=fe+re,Ae=Z.slice(fe,Oe);m.useEffect(()=>{oe.current&&oe.current.scrollIntoView({behavior:"smooth",block:"start"})},[D]),m.useEffect(()=>{te(1)},[z,W,O]);const Be=e=>{X(e),l({designation:e.designation,customerReference:e.customerReference||"",category:e.category,storageZone:e.storageZone,shelf:e.shelf,position:e.position,currentStock:e.currentStock,minStock:e.minStock,maxStock:e.maxStock,unit:e.unit,unitPrice:e.unitPrice,supplier1:e.supplier1||"",orderLink1:e.orderLink1||e.orderLink||"",supplier2:e.supplier2||"",orderLink2:e.orderLink2||"",supplier3:e.supplier3||"",orderLink3:e.orderLink3||"",photo:e.photo||""})},$e=e=>{var s;const o=(s=e.target.files)==null?void 0:s[0];if(o){const n=new FileReader;n.onloadend=()=>{l({...r,photo:n.result})},n.readAsDataURL(o)}},Ze=async()=>{if(a)try{const e={};if(console.log("D√©but sauvegarde:",{editFormData:r,editingProduct:a}),r.designation!==void 0&&r.designation!==a.designation&&(e.designation=r.designation),r.category!==void 0&&r.category!==a.category&&(e.category=r.category),r.storageZone!==void 0&&r.storageZone!==a.storageZone&&(console.log("Zone chang√©e:",r.storageZone,"!=",a.storageZone),e.storageZone=r.storageZone),r.shelf!==void 0&&r.shelf!==a.shelf&&(console.log("Shelf chang√©e:",r.shelf,"!=",a.shelf),e.shelf=r.shelf),r.position!==void 0&&r.position!==a.position&&(console.log("Position chang√©e:",r.position,"!=",a.position),e.position=r.position),r.currentStock!==void 0&&r.currentStock!==a.currentStock&&(e.currentStock=r.currentStock),r.minStock!==void 0&&r.minStock!==a.minStock&&(e.minStock=r.minStock),r.maxStock!==void 0&&r.maxStock!==a.maxStock&&(e.maxStock=r.maxStock),r.unit!==void 0&&r.unit!==a.unit&&(e.unit=r.unit),r.unitPrice!==void 0&&r.unitPrice!==a.unitPrice&&(e.unitPrice=r.unitPrice),r.supplier1!==void 0&&r.supplier1!==a.supplier1&&(e.supplier1=r.supplier1),r.orderLink1!==void 0&&r.orderLink1!==a.orderLink1&&(e.orderLink1=r.orderLink1),r.supplier2!==void 0&&r.supplier2!==a.supplier2&&(e.supplier2=r.supplier2),r.orderLink2!==void 0&&r.orderLink2!==a.orderLink2&&(e.orderLink2=r.orderLink2),r.supplier3!==void 0&&r.supplier3!==a.supplier3&&(e.supplier3=r.supplier3),r.orderLink3!==void 0&&r.orderLink3!==a.orderLink3&&(e.orderLink3=r.orderLink3),r.photo!==void 0&&r.photo!==a.photo&&(e.photo=r.photo),e.storageZone!==void 0||e.shelf!==void 0||e.position!==void 0){const o=e.storageZone!==void 0?e.storageZone:a.storageZone,s=e.shelf!==void 0?e.shelf:a.shelf,n=e.position!==void 0?e.position:a.position;if(o){const R=s??"",i=n??"";e.location=`${o}.${R}.${i}`}else e.location="";console.log("Location calcul√©:",{zone:o,shelf:s,position:n,location:e.location})}Object.keys(e).length>0&&(console.log("Updates envoy√©s:",e),await G(a.id,e)),X(null),l({})}catch(e){console.error("Erreur lors de la sauvegarde:",e),alert("Erreur lors de la sauvegarde du produit")}},je=()=>{X(null),l({})},_e=async e=>{if(window.confirm("√ätes-vous s√ªr de vouloir supprimer ce produit ?"))try{await Ne(e)}catch(o){console.error("Erreur lors de la suppression:",o),alert("Erreur lors de la suppression du produit")}},Ue=async()=>{if(!C||J<=0){alert("Veuillez saisir une quantit√© valide");return}try{const e=C.currentStock+J;await G(C.id,{currentStock:e}),ue(null),K(0)}catch(e){console.error("Erreur lors de la r√©ception:",e),alert("Erreur lors de la r√©ception du produit")}},ne=()=>{ue(null),K(0)},Ye=e=>{xe(e)},ye=()=>{xe(null)},He=e=>{ee(e),B(0)},Qe=async()=>{if(!F||A<=0){alert("Veuillez saisir une quantit√© valide");return}try{await Te({product_id:F.id,product_reference:F.reference,product_designation:F.designation,quantity:A}),me({type:"success",title:"Commande enregistr√©e",message:`${A} ${F.unit} de ${F.designation} command√©(s)`,duration:5e3}),ee(null),B(0)}catch(e){console.error("Erreur lors de la commande:",e),me({type:"error",title:"Erreur",message:"Erreur lors de l'enregistrement de la commande",duration:5e3})}},be=()=>{ee(null),B(0)},Ve=()=>{const e=new we;e.setFontSize(20),e.text("Liste des Produits",14,22),e.setFontSize(10),e.text(`G√©n√©r√© le ${new Date().toLocaleDateString("fr-FR")} √† ${new Date().toLocaleTimeString("fr-FR")}`,14,30);const o=S.map(s=>[s.reference,s.designation,s.category,s.location,s.currentStock.toString(),`${s.minStock} / ${s.maxStock}`,s.unit]);it(e,{startY:36,head:[["R√©f√©rence","D√©signation","Cat√©gorie","Emplacement","Stock actuel","Min/Max","Unit√©"]],body:o,styles:{fontSize:9},headStyles:{fillColor:[197,90,58]}}),e.save(`liste_produits_${new Date().toISOString().split("T")[0]}.pdf`)},Ge=()=>{const e=S.map(n=>({R√©f√©rence:n.reference,D√©signation:n.designation,Cat√©gorie:n.category,"Zone de stockage":n.storageZone||"",√âtag√®re:n.shelf||"",Position:n.position||"",Emplacement:n.location,"Stock actuel":n.currentStock,"Stock minimum":n.minStock,"Stock maximum":n.maxStock,Unit√©:n.unit,"Cr√©√© le":new Date(n.createdAt).toLocaleString("fr-FR"),"Modifi√© le":new Date(n.updatedAt).toLocaleString("fr-FR")})),o=ce.json_to_sheet(e),s=ce.book_new();ce.book_append_sheet(s,o,"Produits"),o["!cols"]=[{wch:12},{wch:30},{wch:15},{wch:15},{wch:10},{wch:10},{wch:35},{wch:12},{wch:12},{wch:12},{wch:8},{wch:18},{wch:18}],st(s,`liste_produits_${new Date().toISOString().split("T")[0]}.xlsx`)},qe=()=>{const e=new we({orientation:"portrait",unit:"mm",format:"a4"}),o=210,s=297,n=15,R=o-2*n,i=[255,87,34];let I=S;c.selectedCategories.length>0&&(I=S.filter(d=>c.selectedCategories.includes(d.category)));const v={};I.forEach(d=>{v[d.category]||(v[d.category]=[]),v[d.category].push(d)});const U=Object.keys(v).sort();let f=0;const se={};e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",o/2,8,{align:"center"}),e.setTextColor(0,0,0),e.setFontSize(10),e.setFont("helvetica","normal");let x=25,b=n;const Y=(o-2*n-10)/2;U.forEach((d,g)=>{se[d]=f+1+g,x>s-40&&b===n&&(b=n+Y+10,x=25),x>s-40&&b!==n&&(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",o/2,8,{align:"center"}),b=n,x=25),e.setFillColor(240,240,240),e.roundedRect(b-2,x-5,Y+4,7,1,1,"F"),e.setTextColor(i[0],i[1],i[2]),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(d,b,x),x+=8,v[d].forEach(p=>{x>s-40&&(b===n?(b=n+Y+10,x=25):(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",o/2,8,{align:"center"}),b=n,x=25)),e.setTextColor(0,0,0),e.setFontSize(9),e.setFont("helvetica","normal");const H=p.designation.length>35?p.designation.substring(0,32)+"...":p.designation;e.text(H,b+2,x),e.text(`${se[d]}`,b+Y-5,x,{align:"right"}),x+=5}),x+=3}),U.forEach(d=>{e.addPage(),f++,se[d]=f,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",o/2,8,{align:"center"}),e.setTextColor(i[0],i[1],i[2]),e.setFontSize(28),e.setFont("helvetica","bold"),e.text(d,n,35),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,o-n,s-10,{align:"right"});const g=v[d],p=(R-10)/2,H=102;let L=n,Q=50,M=0;g.forEach(j=>{M%6===0&&M>0&&(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text(d.toUpperCase(),o/2,8,{align:"center"}),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,o-n,s-10,{align:"right"}),Q=20,L=n);const Je=M%2,Ke=Math.floor(M%6/2);L=n+Je*(p+10),Q=50+Ke*(H+10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.roundedRect(L,Q,p,H,3,3);const P=5;let ae=Q+P;if(c.includePhotos){const h=p-2*P,y=L+P,k=ae;if(j.photo)try{e.addImage(j.photo,"JPEG",y,k,h,h),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.rect(y,k,h,h)}catch{e.setFillColor(245,245,245),e.rect(y,k,h,h,"F"),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.rect(y,k,h,h),e.setTextColor(200,200,200),e.setFontSize(32),e.text("üì¶",y+h/2,k+h/2+6,{align:"center"})}else e.setFillColor(245,245,245),e.rect(y,k,h,h,"F"),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.rect(y,k,h,h),e.setTextColor(200,200,200),e.setFontSize(32),e.text("üì¶",y+h/2,k+h/2+6,{align:"center"});ae+=h+5}const V=L+P;let w=ae;e.setTextColor(i[0],i[1],i[2]),e.setFontSize(9),e.setFont("helvetica","bold"),e.text(j.reference,V,w);const ke=j.category;e.setFontSize(7),e.setFont("helvetica","bold");const Ce=e.getTextWidth(ke)+4,Se=L+p-Ce-P,le=w-3;e.setFillColor(240,240,240),e.roundedRect(Se,le,Ce,5,1,1,"F"),e.setTextColor(100,100,100),e.text(ke,Se+2,le+3.5);let et=le+7;if(c.includeBarcodes){const h=document.createElement("canvas");try{at(h,j.reference,{format:"CODE128",width:1,height:20,displayValue:!1,margin:0});const y=h.toDataURL("image/png"),k=35;e.addImage(y,"PNG",L+p-k-P,et,k,7)}catch(y){console.error("Error generating barcode:",y)}}w+=3.5,e.setTextColor(0,0,0),e.setFontSize(8),e.setFont("helvetica","normal");const tt=p-2*P,Fe=e.splitTextToSize(j.designation,tt);e.text(Fe.slice(0,2),V,w),w+=3*Math.min(Fe.length,2)+1,c.includeLocation&&j.location&&(e.setFontSize(7),e.setTextColor(80,80,80),e.text(`Emplacement: ${pe(j.location)}`,V,w),w+=3),c.includeStock&&(e.setFontSize(7),e.setTextColor(80,80,80),e.text(`Stock: ${j.currentStock} ${j.unit} | Min: ${j.minStock} / Max: ${j.maxStock}`,V,w)),M++})}),e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("INDEX ALPHAB√âTIQUE",o/2,8,{align:"center"});const Xe=[...I].sort((d,g)=>d.designation.localeCompare(g.designation,"fr",{sensitivity:"base"}));e.setTextColor(0,0,0),e.setFontSize(8),e.setFont("helvetica","normal");let N=25,E=n;const ie=(o-2*n-10)/2;Xe.forEach(d=>{N>s-30&&E===n&&(E=n+ie+10,N=25),N>s-30&&E!==n&&(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,o,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("INDEX ALPHAB√âTIQUE",o/2,8,{align:"center"}),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,o-n,s-10,{align:"right"}),E=n,N=25),e.setTextColor(0,0,0),e.setFontSize(8),e.setFont("helvetica","normal");let g=d.designation;const p=ie-20;if(e.getTextWidth(g)>p){for(;e.getTextWidth(g+"...")>p&&g.length>0;)g=g.substring(0,g.length-1);g+="..."}e.text(g,E,N),e.setTextColor(i[0],i[1],i[2]),e.setFont("helvetica","bold"),e.text(d.reference,E+ie-5,N,{align:"right"}),N+=5}),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,o-n,s-10,{align:"right"}),e.save(`catalogue_produits_${new Date().toISOString().split("T")[0]}.pdf`),$(!1)};return t.jsxs("div",{className:"products-page",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h1",{style:{margin:0},children:"Gestion des Produits"}),(()=>{const e=ze();return e>0&&t.jsxs("div",{style:{padding:"0.5rem 1rem",background:"var(--card-bg)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[t.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:"Temps moyen de livraison: "}),t.jsxs("span",{style:{fontSize:"1rem",fontWeight:"600",color:"var(--accent-color)"},children:[e," jours"]})]})})()]}),t.jsxs("div",{className:"filters",children:[t.jsx("input",{type:"text",placeholder:"Rechercher par r√©f√©rence ou d√©signation...",value:z,onChange:e=>De(e.target.value),className:"search-input"}),t.jsxs("select",{value:W,onChange:e=>Re(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Toutes les cat√©gories"}),q.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]}),t.jsxs("select",{value:O,onChange:e=>Ie(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Tous les statuts"}),t.jsx("option",{value:"critical",children:"Critique"}),t.jsx("option",{value:"low",children:"Faible"}),t.jsx("option",{value:"medium",children:"Moyen"}),t.jsx("option",{value:"normal",children:"Normal"})]}),t.jsx("button",{onClick:Ve,className:"btn btn-secondary",children:"Export PDF"}),t.jsx("button",{onClick:Ge,className:"btn btn-secondary",children:"Export Excel"}),t.jsx("button",{onClick:()=>$(!0),className:"btn btn-primary",children:"G√©n√©rer Catalogue PDF"})]}),Z.length===0?t.jsx("p",{className:"no-data",children:"Aucun produit trouv√©"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:oe,className:"products-table-container",children:t.jsxs("table",{className:"products-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Photo"}),t.jsx("th",{children:"R√©f√©rence"}),t.jsx("th",{children:"D√©signation"}),t.jsx("th",{children:"Cat√©gorie"}),t.jsx("th",{children:"Emplacement"}),t.jsx("th",{children:"Stock Actuel"}),t.jsx("th",{children:"Conso. Moy/j"}),t.jsx("th",{children:"Jours avant rupture"}),t.jsx("th",{children:"Prix Unitaire"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:Ae.map(e=>{var o;return t.jsxs("tr",{children:[t.jsx("td",{children:e.photo?t.jsx("img",{src:e.photo,alt:e.designation,className:"product-thumb"}):t.jsx("div",{className:"product-thumb-placeholder",children:"?"})}),t.jsx("td",{children:e.reference}),t.jsx("td",{children:(()=>{const s=Me(e.id);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",alignItems:"flex-start"},children:[t.jsx("div",{children:e.designation}),s>0&&t.jsxs("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",fontSize:"0.7rem",fontWeight:"600",color:"#fff",background:"#10b981",borderRadius:"4px",width:"fit-content"},children:["En commande x",s]})]})})()}),t.jsx("td",{children:e.category}),t.jsxs("td",{title:`Raw: ${e.location} | Zone: ${e.storageZone} | Shelf: ${e.shelf} | Position: ${e.position}`,children:["[",pe(e.location),"]"]}),t.jsx("td",{children:t.jsx("span",{className:`stock-value stock-${ge(e)}`,children:e.currentStock})}),t.jsx("td",{children:((o=ve[e.id])==null?void 0:o.toFixed(1))||"0.0"}),t.jsx("td",{children:(()=>{const s=ve[e.id]||0;if(s===0)return"‚àû";const n=Math.floor(e.currentStock/s);return n>999?"‚àû":n})()}),t.jsx("td",{children:e.unitPrice?`${e.unitPrice.toFixed(2)} ‚Ç¨`:"-"}),t.jsx("td",{children:t.jsxs("div",{className:"actions",children:[t.jsx("button",{onClick:()=>Be(e),className:"btn-icon btn-edit",title:"Modifier",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(e.orderLink1||e.orderLink2||e.orderLink3||e.orderLink)&&t.jsx("button",{onClick:()=>Ye(e),className:"btn-icon btn-gray",title:"Fournisseur",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),t.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}),t.jsx("button",{onClick:()=>He(e),className:"btn-icon btn-order",title:"Commander",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"9",cy:"21",r:"1"}),t.jsx("circle",{cx:"20",cy:"21",r:"1"}),t.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]})}),t.jsx("button",{onClick:()=>_e(e.id),className:"btn-icon btn-delete-red",title:"Supprimer",children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})})})]})})]},e.id)})})]})}),_>1&&t.jsxs("div",{className:"pagination",children:[t.jsx("button",{onClick:()=>te(e=>Math.max(1,e-1)),disabled:D===1,className:"btn btn-secondary",children:"‚Üê Pr√©c√©dent"}),t.jsxs("span",{className:"pagination-info",children:["Page ",D," sur ",_," (",Z.length," produits)"]}),t.jsx("button",{onClick:()=>te(e=>Math.min(_,e+1)),disabled:D===_,className:"btn btn-secondary",children:"Suivant ‚Üí"})]})]}),a&&t.jsx("div",{className:"modal-overlay",onClick:je,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:"Modifier le Produit"}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Informations g√©n√©rales"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"D√©signation"}),t.jsx("input",{type:"text",value:r.designation||"",onChange:e=>l({...r,designation:e.target.value})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"R√©f√©rence Client"}),t.jsx("input",{type:"text",value:r.customerReference||"",onChange:e=>l({...r,customerReference:e.target.value}),placeholder:"R√©f√©rence du client (optionnel)"})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Cat√©gorie"}),t.jsx("select",{value:r.category||"",onChange:e=>l({...r,category:e.target.value}),children:q.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))})]}),t.jsx("div",{className:"form-group"})]})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Localisation"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Zone de stockage"}),t.jsx("select",{value:r.storageZone||"",onChange:e=>l({...r,storageZone:e.target.value}),children:Pe.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"N¬∞ √âtag√®re"}),t.jsx("input",{type:"number",value:r.shelf!==void 0?r.shelf:"",min:"1",onChange:e=>l({...r,shelf:parseInt(e.target.value)||1})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"N¬∞ Position"}),t.jsx("input",{type:"number",value:r.position!==void 0?r.position:"",min:"1",onChange:e=>l({...r,position:parseInt(e.target.value)||1})})]})]})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Gestion du stock"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Stock Actuel"}),t.jsx("input",{type:"number",value:r.currentStock!==void 0?r.currentStock:"",step:"1",min:"0",onChange:e=>l({...r,currentStock:parseInt(e.target.value)||0})})]}),t.jsx("div",{className:"form-group"})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Stock Minimum"}),t.jsx("input",{type:"number",value:r.minStock!==void 0?r.minStock:"",step:"1",min:"0",onChange:e=>l({...r,minStock:parseInt(e.target.value)||0})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Stock Maximum"}),t.jsx("input",{type:"number",value:r.maxStock!==void 0?r.maxStock:"",step:"1",min:"0",onChange:e=>l({...r,maxStock:parseInt(e.target.value)||0})})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Unit√©"}),t.jsx("select",{value:r.unit||"",onChange:e=>l({...r,unit:e.target.value}),children:Le.map(e=>t.jsxs("option",{value:e.abbreviation,children:[e.name," (",e.abbreviation,")"]},e.id))})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Prix Unitaire (‚Ç¨)"}),t.jsx("input",{type:"number",value:r.unitPrice!==void 0?r.unitPrice:"",step:"0.01",min:"0",placeholder:"0.00",onChange:e=>l({...r,unitPrice:parseFloat(e.target.value)||void 0})})]})]})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Fournisseurs et commandes"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"supplier1",children:"Fournisseur 1"}),t.jsx("input",{type:"text",id:"supplier1",value:r.supplier1||"",onChange:e=>l({...r,supplier1:e.target.value}),placeholder:"Nom du fournisseur"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderLink1",children:"Lien de Commande 1"}),t.jsx("input",{type:"url",id:"orderLink1",value:r.orderLink1||"",onChange:e=>l({...r,orderLink1:e.target.value}),placeholder:"https://exemple.com/produit"})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"supplier2",children:"Fournisseur 2"}),t.jsx("input",{type:"text",id:"supplier2",value:r.supplier2||"",onChange:e=>l({...r,supplier2:e.target.value}),placeholder:"Nom du fournisseur"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderLink2",children:"Lien de Commande 2"}),t.jsx("input",{type:"url",id:"orderLink2",value:r.orderLink2||"",onChange:e=>l({...r,orderLink2:e.target.value}),placeholder:"https://exemple.com/produit"})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"supplier3",children:"Fournisseur 3"}),t.jsx("input",{type:"text",id:"supplier3",value:r.supplier3||"",onChange:e=>l({...r,supplier3:e.target.value}),placeholder:"Nom du fournisseur"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderLink3",children:"Lien de Commande 3"}),t.jsx("input",{type:"url",id:"orderLink3",value:r.orderLink3||"",onChange:e=>l({...r,orderLink3:e.target.value}),placeholder:"https://exemple.com/produit"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"photo",children:"Photo du Produit"}),t.jsx("input",{type:"file",id:"photo",accept:"image/*",onChange:$e}),r.photo&&t.jsx("div",{className:"photo-preview",children:t.jsx("img",{src:r.photo,alt:"Aper√ßu"})})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:je,className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Ze,className:"btn btn-primary",children:"Enregistrer"})]})]})}),C&&t.jsx("div",{className:"modal-overlay",onClick:ne,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),style:{maxWidth:"700px"},children:[t.jsx("h2",{children:"R√©ception de Stock"}),t.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:[C.reference," - ",C.designation]}),(()=>{const e=he().filter(o=>o.product_id===C.id);return e.length>0&&t.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1.25rem",background:"var(--card-bg)",borderRadius:"8px",border:"2px solid var(--accent-color)"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1.1rem",fontWeight:"600",color:"var(--accent-color)"},children:"üì¶ Commandes en attente"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:e.map(o=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",background:"var(--bg-color)",borderRadius:"6px",border:"1px solid var(--border-color)"},children:[t.jsxs("div",{children:[t.jsxs("span",{style:{fontWeight:"700",fontSize:"1.1rem",color:"var(--text-primary)"},children:[o.quantity," ",C.unit]}),t.jsxs("span",{style:{color:"var(--text-secondary)",marginLeft:"0.75rem",fontSize:"0.9rem"},children:["Command√© le ",new Date(o.ordered_at).toLocaleDateString("fr-FR")]})]}),t.jsx("button",{onClick:async()=>{try{const s=C.currentStock+o.quantity;await G(C.id,{currentStock:s}),await Ee(o.id,{status:"received",received_at:new Date}),ne()}catch(s){console.error("Erreur lors de la r√©ception:",s),alert("Erreur lors de la r√©ception")}},className:"btn btn-success",style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},children:"‚úì R√©ceptionner"})]},o.id))})]})})(),t.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1.25rem",background:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1.1rem",fontWeight:"600"},children:"‚úèÔ∏è R√©ception manuelle"}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Quantit√© Re√ßue *"}),t.jsx("input",{type:"number",value:J||"",step:"1",min:"1",onChange:e=>K(parseInt(e.target.value)||0),placeholder:"Quantit√© re√ßue",autoFocus:!0})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:ne,className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Ue,className:"btn btn-primary",children:"Valider la R√©ception"})]})]})}),u&&t.jsx("div",{className:"modal-overlay",onClick:ye,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:"Liens de Commande"}),t.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:[u.reference," - ",u.designation]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[(u.orderLink1||u.orderLink)&&t.jsxs("a",{href:u.orderLink1||u.orderLink,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",padding:"1.5rem",borderRadius:"8px",background:"var(--card-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:"0.75rem",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",children:[t.jsx("path",{d:"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:u.supplier1||"Fournisseur 1"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary-color)",fontSize:"0.9rem",fontWeight:"500"},children:[t.jsx("span",{children:"Ouvrir le lien"}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15 3 21 3 21 9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]}),u.orderLink2&&t.jsxs("a",{href:u.orderLink2,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",padding:"1.5rem",borderRadius:"8px",background:"var(--card-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:"0.75rem",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",children:[t.jsx("path",{d:"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:u.supplier2||"Fournisseur 2"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary-color)",fontSize:"0.9rem",fontWeight:"500"},children:[t.jsx("span",{children:"Ouvrir le lien"}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15 3 21 3 21 9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]}),u.orderLink3&&t.jsxs("a",{href:u.orderLink3,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",padding:"1.5rem",borderRadius:"8px",background:"var(--card-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:"0.75rem",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",children:[t.jsx("path",{d:"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:u.supplier3||"Fournisseur 3"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary-color)",fontSize:"0.9rem",fontWeight:"500"},children:[t.jsx("span",{children:"Ouvrir le lien"}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15 3 21 3 21 9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]})]}),t.jsx("div",{className:"modal-actions",style:{marginTop:"1.5rem"},children:t.jsx("button",{onClick:ye,className:"btn btn-secondary",children:"Fermer"})})]})}),F&&t.jsx("div",{className:"modal-overlay",onClick:be,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:"Commander un Produit"}),t.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:[F.reference," - ",F.designation]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderQuantity",children:"Quantit√© command√©e *"}),t.jsx("input",{type:"number",id:"orderQuantity",value:A,onChange:e=>B(parseInt(e.target.value)||0),min:"1",placeholder:"0",autoFocus:!0})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:be,className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Qe,className:"btn btn-primary",children:"Enregistrer la Commande"})]})]})}),We&&t.jsx("div",{className:"modal-overlay",onClick:()=>$(!1),children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),style:{maxWidth:"600px"},children:[t.jsx("h2",{children:"Configuration du Catalogue PDF"}),t.jsx("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:"Personnalisez les informations √† inclure dans votre catalogue"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[t.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Options d'affichage"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includePhotos,onChange:e=>T({...c,includePhotos:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les photos des produits"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includeBarcodes,onChange:e=>T({...c,includeBarcodes:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les codes-barres"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includeStock,onChange:e=>T({...c,includeStock:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les niveaux de stock"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includeLocation,onChange:e=>T({...c,includeLocation:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les emplacements"})]})]}),t.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Filtrer par cat√©gories"}),t.jsx("p",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:"Laissez vide pour inclure toutes les cat√©gories"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",maxHeight:"200px",overflowY:"auto"},children:q.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.selectedCategories.includes(e.name),onChange:o=>{o.target.checked?T({...c,selectedCategories:[...c.selectedCategories,e.name]}):T({...c,selectedCategories:c.selectedCategories.filter(s=>s!==e.name)})},style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:e.name}),t.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.875rem",color:"var(--text-secondary)"},children:["(",S.filter(o=>o.category===e.name).length," produits)"]})]},e.id))})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:()=>$(!1),className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:qe,className:"btn btn-primary",disabled:c.selectedCategories.length>0&&S.filter(e=>c.selectedCategories.includes(e.category)).length===0,children:"G√©n√©rer le Catalogue PDF"})]})]})})]})};export{xt as default};
