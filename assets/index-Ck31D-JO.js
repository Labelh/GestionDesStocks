const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-BPFeYR1v.js","assets/react-vendor-DRM3MNr6.js","assets/supabase-g_Un6fVd.js","assets/AddProduct-C3CPAFtw.js","assets/Products-DJhQbLNY.js","assets/heavy-libs-Dn1T2gkY.js","assets/jspdf.plugin.autotable-CtA5BUKo.js","assets/JsBarcode-CmyaEkaf.js","assets/Settings-w_GWU1dV.js","assets/Requests-Bvy06BJw.js","assets/Orders-Bt0LD4g-.js","assets/Statistics-BybVYTRP.js","assets/UserCatalog-esBmd5jl.js","assets/UserCatalog-9hwq_QUF.css","assets/UserStatistics-zVf_sB-k.js","assets/History-CnSTtKnw.js","assets/Inventory-DL1ptwOy.js","assets/Inventory-CqlswDvP.css","assets/UserManagement-C7e8NlQL.js","assets/UserManagement-BTHCkYSO.css","assets/LabelGenerator-BZat6I7V.js","assets/LabelGenerator-BCXE6jyD.css"])))=>i.map(i=>d[i]);
import{r as n,a as Qe,u as te,b as et,R as ie,L as tt,O as rt,B as ot,d as nt,e as L,N as H}from"./react-vendor-DRM3MNr6.js";import{c as st,_ as q}from"./supabase-g_Un6fVd.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))m(u);new MutationObserver(u=>{for(const h of u)if(h.type==="childList")for(const v of h.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function d(u){const h={};return u.integrity&&(h.integrity=u.integrity),u.referrerPolicy&&(h.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?h.credentials="include":u.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function m(u){if(u.ep)return;u.ep=!0;const h=d(u);fetch(u.href,h)}})();var Ne={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var at=n,it=Symbol.for("react.element"),lt=Symbol.for("react.fragment"),ct=Object.prototype.hasOwnProperty,dt=at.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ut={key:!0,ref:!0,__self:!0,__source:!0};function We(i,a,d){var m,u={},h=null,v=null;d!==void 0&&(h=""+d),a.key!==void 0&&(h=""+a.key),a.ref!==void 0&&(v=a.ref);for(m in a)ct.call(a,m)&&!ut.hasOwnProperty(m)&&(u[m]=a[m]);if(i&&i.defaultProps)for(m in a=i.defaultProps,a)u[m]===void 0&&(u[m]=a[m]);return{$$typeof:it,type:i,key:h,ref:v,props:u,_owner:dt.current}}re.Fragment=lt;re.jsx=We;re.jsxs=We;Ne.exports=re;var e=Ne.exports,le={},Pe=Qe;le.createRoot=Pe.createRoot,le.hydrateRoot=Pe.hydrateRoot;const F={},mt=(F==null?void 0:F.VITE_SUPABASE_URL)||"https://jxymbulpvnzzysfcsxvw.supabase.co",pt=(F==null?void 0:F.VITE_SUPABASE_ANON_KEY)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4eW1idWxwdm56enlzZmNzeHZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNjc0OTAsImV4cCI6MjA3NTk0MzQ5MH0.J2EFM3FgswrWw1KGRmA-3t9fon0a_nff_0bcqEaeJCc",p=st(mt,pt,{auth:{persistSession:!0,autoRefreshToken:!0}}),Oe=n.createContext(void 0),$=()=>{const i=n.useContext(Oe);if(!i)throw new Error("useApp must be used within an AppProvider");return i},gt=({children:i})=>{const[a,d]=n.useState(null),[m,u]=n.useState(!0),[h,v]=n.useState([]),[b,g]=n.useState([]),[j,S]=n.useState([]),[C,k]=n.useState([]),[x,D]=n.useState([]),[R,_]=n.useState([]),[f,z]=n.useState([]),[W,M]=n.useState([]),P=n.useMemo(()=>{const r=new Map;return b.forEach(t=>r.set(t.id,t)),r},[b]),N=n.useMemo(()=>{const r=new Map;return j.forEach(t=>r.set(t.name,t)),r},[j]),Z=n.useMemo(()=>{const r=new Map;return C.forEach(t=>r.set(t.abbreviation,t)),r},[C]),Y=n.useMemo(()=>{const r=new Map;return x.forEach(t=>r.set(t.name,t)),r},[x]);n.useEffect(()=>{(async()=>{await Ve(),await U()})()},[]);const Ve=n.useCallback(async()=>{try{const{data:{session:r}}=await p.auth.getSession();if(r!=null&&r.user){const{data:t}=await p.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",r.user.id).single();t&&d({id:t.id,username:t.username,password:"",role:t.role,name:t.name,badgeNumber:t.badge_number||void 0,alertEmail:t.alert_email||void 0,enableStockAlerts:t.enable_stock_alerts??!0,enableConsumptionAlerts:t.enable_consumption_alerts??!0})}}catch(r){console.error("Erreur lors de la vérification de l'utilisateur:",r)}finally{u(!1)}},[]),U=n.useCallback(async()=>{try{await Promise.all([V(),$e(),Ze(),He()]),await Promise.all([oe(),Fe(),Ge(),Je()])}catch(r){console.error("Erreur lors du chargement des données:",r)}},[]),V=n.useCallback(async()=>{const{data:r,error:t}=await p.from("user_profiles").select("id, username, name, role, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").order("name");!t&&r&&v(r.map(o=>({id:o.id,username:o.username,password:"",role:o.role,name:o.name,badgeNumber:o.badge_number||void 0,alertEmail:o.alert_email||void 0,enableStockAlerts:o.enable_stock_alerts??!0,enableConsumptionAlerts:o.enable_consumption_alerts??!0})))},[]),ce=n.useCallback(async(r,t)=>{const{error:o}=await p.from("user_profiles").update({role:t}).eq("id",r);if(o)throw o;v(s=>s.map(l=>l.id===r?{...l,role:t}:l)),(a==null?void 0:a.id)===r&&d(s=>s?{...s,role:t}:null)},[a]),de=n.useCallback(async(r,t,o,s,l)=>{try{const{data:c}=await p.from("user_profiles").select("username").eq("username",r).maybeSingle();if(c)throw new Error("Cet identifiant existe déjà");if(l){const{data:O}=await p.from("user_profiles").select("badge_number").eq("badge_number",l).maybeSingle();if(O)throw new Error("Ce numéro de badge est déjà utilisé")}const y=`${r}@gestionstocks.app`,{data:w,error:A}=await p.auth.signUp({email:y,password:o,options:{emailRedirectTo:void 0,data:{username:r,name:t}}});if(A||!w.user)throw console.error("Erreur Auth Supabase:",A),new Error((A==null?void 0:A.message)||"Erreur lors de la création du compte");await new Promise(O=>setTimeout(O,500));const E={id:w.user.id,username:r,name:t,role:s,badge_number:l||null};console.log("Création du profil utilisateur:",E);const{data:J,error:I}=await p.from("user_profiles").insert([E]).select();if(I)throw console.error("Erreur lors de la création du profil:",I),new Error("Erreur lors de la création du profil: "+I.message);console.log("Profil créé avec succès:",J),await V()}catch(c){throw console.error("Erreur lors de la création de l'utilisateur:",c),c}},[V]),ue=n.useCallback(async(r,t)=>{if(t){const{data:s}=await p.from("user_profiles").select("id").eq("badge_number",t).neq("id",r).maybeSingle();if(s)throw new Error("Ce numéro de badge est déjà utilisé")}console.log("Mise à jour du badge:",{userId:r,badgeNumber:t});const{error:o}=await p.from("user_profiles").update({badge_number:t}).eq("id",r);if(o)throw console.error("Erreur lors de la mise à jour du badge:",o),o;if(console.log("Badge mis à jour avec succès"),await new Promise(s=>setTimeout(s,100)),await V(),(a==null?void 0:a.id)===r){const s=await p.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",r).single();s.data&&d({id:s.data.id,username:s.data.username,password:"",role:s.data.role,name:s.data.name,badgeNumber:s.data.badge_number||void 0,alertEmail:s.data.alert_email||void 0,enableStockAlerts:s.data.enable_stock_alerts??!0,enableConsumptionAlerts:s.data.enable_consumption_alerts??!0})}},[a,V]),me=n.useCallback(async r=>{if(!a)throw new Error("Aucun utilisateur connecté");console.log("Mise à jour du profil utilisateur:",{userId:a.id,updates:r});const t={};r.alertEmail!==void 0&&(t.alert_email=r.alertEmail),r.enableStockAlerts!==void 0&&(t.enable_stock_alerts=r.enableStockAlerts),r.enableConsumptionAlerts!==void 0&&(t.enable_consumption_alerts=r.enableConsumptionAlerts);const{error:o}=await p.from("user_profiles").update(t).eq("id",a.id);if(o)throw console.error("Erreur lors de la mise à jour du profil:",o),o;console.log("Profil mis à jour avec succès"),await V();const s=await p.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",a.id).single();s.data&&d({id:s.data.id,username:s.data.username,password:"",role:s.data.role,name:s.data.name,badgeNumber:s.data.badge_number||void 0,alertEmail:s.data.alert_email||void 0,enableStockAlerts:s.data.enable_stock_alerts??!0,enableConsumptionAlerts:s.data.enable_consumption_alerts??!0})},[a,V]),pe=n.useCallback(async r=>{try{if((a==null?void 0:a.id)===r)throw new Error("Vous ne pouvez pas supprimer votre propre compte");const{error:t}=await p.from("user_profiles").delete().eq("id",r);if(t)throw t;v(o=>o.filter(s=>s.id!==r))}catch(t){throw console.error("Erreur lors de la suppression de l'utilisateur:",t),t}},[a]),$e=n.useCallback(async()=>{const{data:r,error:t}=await p.from("categories").select("id, name, description").order("name");!t&&r&&S(r.map(o=>({id:o.id,name:o.name,description:o.description||void 0})))},[]),ge=n.useCallback(async r=>{const{data:t,error:o}=await p.from("categories").insert([r]).select("id, name, description").single();if(!o&&t){const s={id:t.id,name:t.name,description:t.description||void 0};S(l=>[...l,s])}else throw o},[]),he=n.useCallback(async(r,t)=>{const{error:o}=await p.from("categories").update(t).eq("id",r);if(o)throw o;{S(l=>l.map(c=>c.id===r?{...c,...t}:c));const s=j.find(l=>l.id===r);s&&s.name!==t.name&&(await p.from("products").update({category:t.name}).eq("category",s.name),g(l=>l.map(c=>c.category===s.name?{...c,category:t.name}:c)))}},[j,b]),fe=n.useCallback(async r=>{const{error:t}=await p.from("categories").delete().eq("id",r);if(!t)S(o=>o.filter(s=>s.id!==r));else throw t},[]),Ze=n.useCallback(async()=>{const{data:r,error:t}=await p.from("units").select("id, name, abbreviation, is_default").order("name");!t&&r&&k(r.map(o=>({id:o.id,name:o.name,abbreviation:o.abbreviation,isDefault:o.is_default})))},[]),xe=n.useCallback(async r=>{const{data:t,error:o}=await p.from("units").insert([{...r,is_default:r.isDefault}]).select("id, name, abbreviation, is_default").single();if(!o&&t){const s={id:t.id,name:t.name,abbreviation:t.abbreviation,isDefault:t.is_default};k(l=>[...l,s])}else throw o},[]),be=n.useCallback(async r=>{const{error:t}=await p.from("units").delete().eq("id",r);if(!t)k(o=>o.filter(s=>s.id!==r));else throw t},[]),He=n.useCallback(async()=>{const{data:r,error:t}=await p.from("storage_zones").select("id, name, description").order("name");!t&&r&&D(r.map(o=>({id:o.id,name:o.name,description:o.description||void 0})))},[]),ye=n.useCallback(async r=>{const{data:t,error:o}=await p.from("storage_zones").insert([r]).select("id, name, description").single();if(!o&&t){const s={id:t.id,name:t.name,description:t.description||void 0};D(l=>[...l,s])}else throw o},[]),ve=n.useCallback(async(r,t)=>{const{data:o}=await p.from("storage_zones").select("*").eq("id",r).single(),{error:s}=await p.from("storage_zones").update(t).eq("id",r);if(s)throw s;if(D(l=>l.map(c=>c.id===r?{...c,...t}:c)),o&&o.name!==t.name){const{data:l}=await p.from("products").select("id, shelf, position").eq("storage_zone",o.name);if(l&&l.length>0)for(const c of l){const y=`${t.name}.${c.shelf||""}.${c.position||""}`;await p.from("products").update({storage_zone:t.name,location:y}).eq("id",c.id)}g(c=>c.map(y=>{if(y.storageZone===o.name){const w=`${t.name}.${y.shelf||""}.${y.position||""}`;return{...y,storageZone:t.name,location:w}}return y}))}},[]),_e=n.useCallback(async r=>{const{error:t}=await p.from("storage_zones").delete().eq("id",r);if(!t)D(o=>o.filter(s=>s.id!==r));else throw t},[]),oe=n.useCallback(async()=>{const{data:r,error:t}=await p.from("products").select(`
        id, reference, designation, category_id, storage_zone_id, shelf, position, location,
        current_stock, min_stock, max_stock, unit_id, unit_price, photo,
        order_link, order_link_1, supplier_1, order_link_2, supplier_2, order_link_3, supplier_3,
        deleted_at, created_at, updated_at,
        category:categories(name),
        storage_zone:storage_zones(name),
        unit:units(abbreviation)
      `).is("deleted_at",null).order("reference");!t&&r&&g(r.map(o=>{var s,l,c,y,w,A;return{id:o.id,reference:o.reference,designation:o.designation,category:Array.isArray(o.category)?((s=o.category[0])==null?void 0:s.name)||"":((l=o.category)==null?void 0:l.name)||"",storageZone:Array.isArray(o.storage_zone)?((c=o.storage_zone[0])==null?void 0:c.name)||void 0:((y=o.storage_zone)==null?void 0:y.name)||void 0,shelf:o.shelf||void 0,position:o.position||void 0,location:o.location,currentStock:o.current_stock,minStock:o.min_stock,maxStock:o.max_stock,unit:Array.isArray(o.unit)?((w=o.unit[0])==null?void 0:w.abbreviation)||"":((A=o.unit)==null?void 0:A.abbreviation)||"",unitPrice:o.unit_price||void 0,photo:o.photo||void 0,orderLink:o.order_link||void 0,orderLink1:o.order_link_1||void 0,supplier1:o.supplier_1||void 0,orderLink2:o.order_link_2||void 0,supplier2:o.supplier_2||void 0,orderLink3:o.order_link_3||void 0,supplier3:o.supplier_3||void 0,deletedAt:o.deleted_at?new Date(o.deleted_at):void 0,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)}}))},[]),ke=n.useCallback(async r=>{var y,w,A,E,J,I,O,ae,ee;const t=(y=N.get(r.category))==null?void 0:y.id,o=(w=Z.get(r.unit))==null?void 0:w.id,s=r.storageZone?(A=Y.get(r.storageZone))==null?void 0:A.id:null;if(!t||!o)throw new Error("Catégorie ou unité invalide");const{data:l,error:c}=await p.from("products").insert([{reference:r.reference,designation:r.designation,category_id:t,storage_zone_id:s,shelf:r.shelf,position:r.position,location:r.location,current_stock:r.currentStock,min_stock:r.minStock,max_stock:r.maxStock,unit_id:o,unit_price:r.unitPrice,photo:r.photo,order_link:r.orderLink,order_link_1:r.orderLink1,supplier_1:r.supplier1,order_link_2:r.orderLink2,supplier_2:r.supplier2,order_link_3:r.orderLink3,supplier_3:r.supplier3}]).select(`
        id, reference, designation, current_stock, created_at, updated_at,
        category:categories(name),
        storage_zone:storage_zones(name),
        unit:units(abbreviation)
      `).single();if(!c&&l&&a){const B=l,Ke={...r,id:B.id,category:Array.isArray(B.category)?((E=B.category[0])==null?void 0:E.name)||r.category:((J=B.category)==null?void 0:J.name)||r.category,storageZone:Array.isArray(B.storage_zone)?((I=B.storage_zone[0])==null?void 0:I.name)||r.storageZone:((O=B.storage_zone)==null?void 0:O.name)||r.storageZone,unit:Array.isArray(B.unit)?((ae=B.unit[0])==null?void 0:ae.abbreviation)||r.unit:((ee=B.unit)==null?void 0:ee.abbreviation)||r.unit,createdAt:new Date(B.created_at),updatedAt:new Date(B.updated_at)};g(Xe=>[...Xe,Ke]),G({productId:l.id,productReference:l.reference,productDesignation:l.designation,movementType:"initial",quantity:l.current_stock,previousStock:0,newStock:l.current_stock,userId:a.id,userName:a.name,reason:"Création du produit"})}else throw c},[N,Z,Y,a]),K=n.useCallback(async(r,t,o=!1)=>{var y,w,A;const s=P.get(r);if(!s){console.error("❌ updateProduct: Produit introuvable:",r);return}const l={};if(t.designation!==void 0&&(l.designation=t.designation),t.category!==void 0){const E=(y=N.get(t.category))==null?void 0:y.id;E&&(l.category_id=E)}if(t.storageZone!==void 0){const E=(w=Y.get(t.storageZone))==null?void 0:w.id;E&&(l.storage_zone_id=E)}if(t.shelf!==void 0&&(l.shelf=t.shelf),t.position!==void 0&&(l.position=t.position),t.location!==void 0&&(l.location=t.location),t.currentStock!==void 0&&(l.current_stock=t.currentStock),t.minStock!==void 0&&(l.min_stock=t.minStock),t.maxStock!==void 0&&(l.max_stock=t.maxStock),t.unit!==void 0){const E=(A=Z.get(t.unit))==null?void 0:A.id;E&&(l.unit_id=E)}t.photo!==void 0&&(l.photo=t.photo),t.orderLink!==void 0&&(l.order_link=t.orderLink),t.unitPrice!==void 0&&(l.unit_price=t.unitPrice),t.supplier1!==void 0&&(l.supplier_1=t.supplier1),t.orderLink1!==void 0&&(l.order_link_1=t.orderLink1),t.supplier2!==void 0&&(l.supplier_2=t.supplier2),t.orderLink2!==void 0&&(l.order_link_2=t.orderLink2),t.supplier3!==void 0&&(l.supplier_3=t.supplier3),t.orderLink3!==void 0&&(l.order_link_3=t.orderLink3);const{error:c}=await p.from("products").update(l).eq("id",r);if(c)throw console.error("Erreur mise à jour produit:",c),c;if(g(E=>E.map(I=>{if(I.id===r){const O=Object.fromEntries(Object.entries(t).filter(([ae,ee])=>ee!==void 0));return{...I,...O,updatedAt:new Date}}return I})),!o&&t.currentStock!==void 0&&t.currentStock!==s.currentStock&&a){const E=t.currentStock-s.currentStock;G({productId:s.id,productReference:s.reference,productDesignation:s.designation,movementType:E>0?"entry":E<0?"exit":"adjustment",quantity:Math.abs(E),previousStock:s.currentStock,newStock:t.currentStock,userId:a.id,userName:a.name,reason:"Ajustement manuel du stock"})}},[P,N,Z,Y,a]),je=n.useCallback(async r=>{const{error:t}=await p.from("products").update({deleted_at:new Date().toISOString()}).eq("id",r);if(!t)g(o=>o.filter(s=>s.id!==r));else throw t},[]),we=n.useCallback(r=>P.get(r),[P]),Se=n.useCallback(async()=>{const{data:r,error:t}=await p.from("products").select("reference");return t||!r?(console.error("Erreur lors de la récupération des références:",t),[]):r.map(o=>o.reference)},[]),Fe=n.useCallback(async()=>{const{data:r,error:t}=await p.from("exit_requests").select("*").order("requested_at",{ascending:!1}).limit(500);if(t){console.error("Erreur lors du chargement des demandes:",t);return}if(r){const o=[...new Set([...r.map(c=>c.requested_by).filter(Boolean),...r.map(c=>c.approved_by).filter(Boolean)])],{data:s}=await p.from("user_profiles").select("id, username").in("id",o),l=new Map((s==null?void 0:s.map(c=>[c.id,c.username]))||[]);_(r.map(c=>({id:c.id,productId:c.product_id,productReference:c.product_reference,productDesignation:c.product_designation,productPhoto:c.product_photo,quantity:c.quantity,requestedBy:l.get(c.requested_by)||c.requested_by,requestedAt:new Date(c.requested_at),status:c.status,approvedBy:c.approved_by?l.get(c.approved_by)||c.approved_by:void 0,approvedAt:c.approved_at?new Date(c.approved_at):void 0,receivedAt:c.received_at?new Date(c.received_at):void 0,reason:c.reason||void 0,notes:c.notes||void 0})))}},[]),Ce=n.useCallback(async r=>{if(!a)throw new Error("Utilisateur non connecté");const{data:t,error:o}=await p.from("exit_requests").insert([{product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,product_photo:r.productPhoto,quantity:r.quantity,requested_by:a.id,reason:r.reason,status:"pending"}]).select().single();if(o)throw console.error("Erreur lors de l'ajout de la demande:",o),o;const s={id:t.id,productId:t.product_id,productReference:t.product_reference,productDesignation:t.product_designation,productPhoto:t.product_photo,quantity:t.quantity,requestedBy:a.username,requestedAt:new Date(t.requested_at),status:t.status,reason:t.reason};_(l=>[s,...l])},[a]),Ee=n.useCallback(async(r,t)=>{var c;const o=R.find(y=>y.id===r);if(!o)throw new Error("Demande introuvable");const s={};t.status&&(s.status=t.status),t.approvedBy&&(s.approved_by=t.approvedBy),t.notes&&(s.notes=t.notes),t.receivedAt&&(s.received_at=t.receivedAt.toISOString()),(t.status==="awaiting_reception"||t.status==="rejected")&&(s.approved_at=new Date().toISOString());const{error:l}=await p.from("exit_requests").update(s).eq("id",r);if(l)throw l;if(_(y=>y.map(w=>w.id===r?{...w,...t}:w)),t.status==="approved"&&a){const y=P.get(o.productId);if(y){const w=(c=o.reason)==null?void 0:c.startsWith("Écart de stock signalé"),A=w?o.quantity:y.currentStock-o.quantity,E=Math.abs(A-y.currentStock);await K(y.id,{currentStock:A},!0),await G({productId:y.id,productReference:y.reference,productDesignation:y.designation,movementType:w?"adjustment":"exit",quantity:E,previousStock:y.currentStock,newStock:A,userId:a.id,userName:a.name,reason:w?o.reason||"Ajustement suite à écart de stock":`Sortie de stock - ${o.reason||"Demande approuvée"}`,notes:o.notes}),se({productReference:y.reference,productDesignation:y.designation,storageZone:y.storageZone,shelf:y.shelf,position:y.position,quantity:o.quantity,requestedBy:o.requestedBy})}}},[R,P,a,K]),Ae=n.useCallback(async r=>{const{error:t}=await p.from("exit_requests").delete().eq("id",r);if(!t)_(o=>o.filter(s=>s.id!==r));else throw t},[]),Ge=n.useCallback(async()=>{const{data:r,error:t}=await p.from("stock_movements").select("*").order("timestamp",{ascending:!1}).limit(500);!t&&r&&z(r.map(o=>({id:o.id,productId:o.product_id,productReference:o.product_reference,productDesignation:o.product_designation,movementType:o.movement_type,quantity:o.quantity,previousStock:o.previous_stock,newStock:o.new_stock,userId:o.user_id,userName:o.user_name,reason:o.reason,notes:o.notes||void 0,timestamp:new Date(o.timestamp)})))},[]),G=n.useCallback(async r=>{const{data:t,error:o}=await p.from("stock_movements").insert([{product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,movement_type:r.movementType,quantity:r.quantity,previous_stock:r.previousStock,new_stock:r.newStock,user_id:r.userId,user_name:r.userName,reason:r.reason,notes:r.notes}]).select().single();if(!o&&t){const s={id:t.id,productId:t.product_id,productReference:t.product_reference,productDesignation:t.product_designation,movementType:t.movement_type,quantity:t.quantity,previousStock:t.previous_stock,newStock:t.new_stock,userId:t.user_id,userName:t.user_name,reason:t.reason,notes:t.notes,timestamp:new Date(t.timestamp)};z(l=>[s,...l.slice(0,499)])}},[]),Je=n.useCallback(async()=>{const{data:r,error:t}=await p.from("orders").select("*").order("ordered_at",{ascending:!1}).limit(200);!t&&r&&M(r.map(o=>({id:o.id,product_id:o.product_id,product_reference:o.product_reference,product_designation:o.product_designation,quantity:o.quantity,ordered_by:o.ordered_by,ordered_by_name:o.ordered_by_name,ordered_at:new Date(o.ordered_at),received_at:o.received_at?new Date(o.received_at):void 0,status:o.status,notes:o.notes||void 0,created_at:new Date(o.created_at),updated_at:new Date(o.updated_at)})))},[]),Me=n.useCallback(async r=>{if(!a)throw new Error("Utilisateur non connecté");const{data:t,error:o}=await p.from("orders").insert([{product_id:r.product_id,product_reference:r.product_reference,product_designation:r.product_designation,quantity:r.quantity,ordered_by:a.id,ordered_by_name:a.name,status:"pending",notes:r.notes}]).select().single();if(o)throw o;if(t){const s={id:t.id,product_id:t.product_id,product_reference:t.product_reference,product_designation:t.product_designation,quantity:t.quantity,ordered_by:t.ordered_by,ordered_by_name:t.ordered_by_name,ordered_at:new Date(t.ordered_at),status:t.status,notes:t.notes,created_at:new Date(t.created_at),updated_at:new Date(t.updated_at)};M(l=>[s,...l])}},[a]),Le=n.useCallback(async(r,t)=>{const o={};t.status!==void 0&&(o.status=t.status),t.received_at!==void 0&&(o.received_at=t.received_at),t.notes!==void 0&&(o.notes=t.notes);const{error:s}=await p.from("orders").update(o).eq("id",r);if(s)throw s;M(l=>l.map(c=>c.id===r?{...c,...t,updated_at:new Date}:c))},[]),Re=n.useCallback(()=>W.filter(r=>r.status==="pending"),[W]),Te=n.useCallback(()=>{const r=W.filter(o=>o.status==="received"&&o.received_at);if(r.length===0)return 0;const t=r.reduce((o,s)=>{const l=new Date(s.ordered_at).getTime(),y=(new Date(s.received_at).getTime()-l)/(1e3*60*60*24);return o+y},0);return Math.round(t/r.length*10)/10},[W]),De=n.useCallback(()=>{const r=[];return b.forEach(t=>{if(t.currentStock<=t.minStock){const o=t.maxStock>0?t.currentStock/t.maxStock*100:0;r.push({product:t,alertType:t.currentStock===0?"critical":"low",percentage:Math.round(o)})}}),r.sort((t,o)=>t.percentage-o.percentage)},[b]),ne="gestionstock_pending_exits",X=n.useCallback(()=>{try{const r=localStorage.getItem(ne);return r?JSON.parse(r).map(t=>({...t,addedAt:new Date(t.addedAt)})):[]}catch(r){return console.error("Erreur lors de la récupération des sorties en attente:",r),[]}},[]),se=n.useCallback(r=>{try{const t=X(),o={...r,id:`exit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,addedAt:new Date};localStorage.setItem(ne,JSON.stringify([...t,o]))}catch(t){console.error("Erreur lors de l'ajout de la sortie en attente:",t)}},[X]),qe=n.useCallback(()=>{try{localStorage.removeItem(ne)}catch(r){console.error("Erreur lors de la suppression des sorties en attente:",r)}},[]),Q=n.useCallback(async(r,t)=>{try{const{data:o}=await p.from("user_profiles").select("*").eq("username",r).single();if(!o)return!1;const s=`${r}@gestionstocks.app`,{data:l,error:c}=await p.auth.signInWithPassword({email:s,password:t});return c||!l.user?!1:(d({id:o.id,username:o.username,password:"",role:o.role,name:o.name,badgeNumber:o.badge_number||void 0,alertEmail:o.alert_email||void 0,enableStockAlerts:o.enable_stock_alerts??!0,enableConsumptionAlerts:o.enable_consumption_alerts??!0}),await U(),!0)}catch(o){return console.error("Erreur de connexion:",o),!1}},[U]),Be=n.useCallback(async r=>{try{const{data:t}=await p.from("user_profiles").select("*").eq("badge_number",r).single();return t?(d({id:t.id,username:t.username,password:"",role:t.role,name:t.name,badgeNumber:t.badge_number||void 0,alertEmail:t.alert_email||void 0,enableStockAlerts:t.enable_stock_alerts??!0,enableConsumptionAlerts:t.enable_consumption_alerts??!0}),await U(),!0):!1}catch(t){return console.error("Erreur de connexion par badge:",t),!1}},[U]),ze=n.useCallback(async(r,t,o)=>{try{const{data:s}=await p.from("user_profiles").select("username").eq("username",r).maybeSingle();if(s)return console.error("Cet identifiant existe déjà"),!1;const l=`${r}@gestionstocks.app`,{data:c,error:y}=await p.auth.signUp({email:l,password:o,options:{emailRedirectTo:void 0,data:{username:r,name:t}}});if(y||!c.user)return console.error("Erreur lors de la création du compte:",y),!1;await new Promise(A=>setTimeout(A,500));const{error:w}=await p.from("user_profiles").insert([{id:c.user.id,username:r,name:t,role:"user"}]);return w?(console.error("Erreur lors de la création du profil:",w),!1):(c.session?(d({id:c.user.id,username:r,password:"",role:"user",name:t,alertEmail:void 0,enableStockAlerts:!0,enableConsumptionAlerts:!0}),await U()):await Q(r,o),!0)}catch(s){return console.error("Erreur lors de l'inscription:",s),!1}},[U,Q]),Ie=n.useCallback(async()=>{await p.auth.signOut(),d(null),g([]),_([]),z([]),M([])},[]),Ye=n.useMemo(()=>({currentUser:a,loading:m,login:Q,loginWithBadge:Be,register:ze,logout:Ie,users:h,updateUserRole:ce,createUser:de,updateUserBadge:ue,updateUserProfile:me,deleteUser:pe,products:b,addProduct:ke,updateProduct:K,deleteProduct:je,getProductById:we,getAllProductReferences:Se,reloadProducts:oe,categories:j,addCategory:ge,updateCategory:he,deleteCategory:fe,units:C,addUnit:xe,deleteUnit:be,storageZones:x,addStorageZone:ye,updateStorageZone:ve,deleteStorageZone:_e,exitRequests:R,addExitRequest:Ce,updateExitRequest:Ee,deleteExitRequest:Ae,getStockAlerts:De,stockMovements:f,addStockMovement:G,orders:W,addOrder:Me,updateOrder:Le,getPendingOrders:Re,getAverageDeliveryTime:Te,getPendingExits:X,addPendingExit:se,clearPendingExits:qe}),[a,m,Q,Be,ze,Ie,h,ce,de,ue,me,pe,b,ke,K,je,we,Se,oe,j,ge,he,fe,C,xe,be,x,ye,ve,_e,R,Ce,Ee,Ae,De,f,G,W,Me,Le,Re,Te,X,se,qe]);return m?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"var(--bg-color)",color:"var(--text-color)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"⏳"}),e.jsx("div",{children:"Chargement..."})]})}):e.jsx(Oe.Provider,{value:Ye,children:i})},Ue=n.createContext(void 0),Ht=()=>{const i=n.useContext(Ue);if(!i)throw new Error("useNotifications must be used within NotificationProvider");return i},ht=({children:i})=>{const[a,d]=n.useState([]),m=v=>{const b=Date.now().toString()+Math.random().toString(),g={...v,id:b,duration:v.duration||5e3};d(j=>[...j,g]),g.duration&&g.duration>0&&setTimeout(()=>{u(b)},g.duration)},u=v=>{d(b=>b.filter(g=>g.id!==v))},h={notifications:a,addNotification:m,removeNotification:u};return e.jsxs(Ue.Provider,{value:h,children:[i,e.jsx(ft,{notifications:a,removeNotification:u})]})},ft=({notifications:i,removeNotification:a})=>{if(i.length===0)return null;const d=m=>{switch(m){case"success":return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),e.jsx("path",{d:"M22 4L12 14.01l-3-3"})]});case"error":return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]});case"warning":return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),e.jsx("path",{d:"M12 9v4M12 17h.01"})]});case"info":default:return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4M12 8h.01"})]})}};return e.jsx("div",{className:"notification-container",children:i.map(m=>e.jsxs("div",{className:`notification ${m.type}`,children:[e.jsx("div",{className:`notification-icon ${m.type}`,children:d(m.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsx("div",{className:"notification-title",children:m.title}),e.jsx("p",{className:"notification-message",children:m.message})]}),e.jsx("button",{className:"notification-close",onClick:()=>a(m.id),children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},m.id))})};function xt(i){const a=[];return i.forEach(d=>{if(!d.deletedAt&&d.currentStock<=d.minStock){const m=d.minStock>0?d.currentStock/d.minStock*100:0;a.push({type:"low_stock",productId:d.id,productReference:d.reference,productDesignation:d.designation,currentStock:d.currentStock,minStock:d.minStock,percentage:m,severity:m<=50?"critical":"warning"})}}),a}function bt(i,a){const d=[],m=new Date,u=new Date(m.getTime()-3*24*60*60*1e3),h=new Date(m.getTime()-30*24*60*60*1e3);return i.forEach(v=>{if(v.deletedAt)return;const b=a.filter(_=>_.productId===v.id&&_.movementType==="exit");if(b.length<5)return;const g=b.filter(_=>new Date(_.timestamp)>=u),j=b.filter(_=>new Date(_.timestamp)>=h&&new Date(_.timestamp)<u);if(j.length===0)return;const S=Math.max(1,(u.getTime()-h.getTime())/(24*60*60*1e3)),k=j.reduce((_,f)=>_+f.quantity,0)/S,x=Math.max(1,(m.getTime()-u.getTime())/(24*60*60*1e3)),R=g.reduce((_,f)=>_+f.quantity,0)/x;if(k>0){const _=(R-k)/k*100;_>50&&R>0&&d.push({type:"unusual_consumption",productId:v.id,productReference:v.reference,productDesignation:v.designation,averageDaily:k,recentDaily:R,percentageIncrease:_})}}),d}async function yt(){const{data:i,error:a}=await p.from("user_profiles").select("id, username, name, role, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").not("alert_email","is",null).neq("alert_email","");return a||!i?(console.error("Erreur lors de la récupération des utilisateurs avec alertes:",a),[]):i.map(d=>({id:d.id,username:d.username,password:"",role:d.role,name:d.name,badgeNumber:d.badge_number||void 0,alertEmail:d.alert_email||void 0,enableStockAlerts:d.enable_stock_alerts??!0,enableConsumptionAlerts:d.enable_consumption_alerts??!0}))}async function vt(i,a,d){if(!i.alertEmail)return;const m=i.enableStockAlerts&&a.length>0,u=i.enableConsumptionAlerts&&d.length>0;if(!(!m&&!u))try{const{error:h}=await p.functions.invoke("send-alert-email",{body:{to:i.alertEmail,userName:i.name,stockAlerts:i.enableStockAlerts?a:[],consumptionAlerts:i.enableConsumptionAlerts?d:[]}});h?console.error("Erreur lors de l'envoi de l'email d'alerte:",h):console.log(`Email d'alerte envoyé à ${i.alertEmail}`)}catch(h){console.error("Erreur lors de l'invocation de la fonction d'envoi d'email:",h)}}async function _t(i,a){console.log("Vérification des alertes...");const d=xt(i),m=bt(i,a);if(console.log(`Détecté: ${d.length} alertes de stock, ${m.length} alertes de consommation`),d.length===0&&m.length===0){console.log("Aucune alerte à envoyer");return}const u=await yt();if(u.length===0){console.log("Aucun utilisateur avec alertes activées");return}for(const h of u)await vt(h,d,m);console.log(`Alertes envoyées à ${u.length} utilisateur(s)`)}function kt(i={}){const{currentUser:a,products:d,stockMovements:m}=$(),{enabled:u=(a==null?void 0:a.role)==="manager",intervalMinutes:h=60}=i,v=n.useRef(null),b=n.useRef(null),g=n.useCallback(async()=>{if(!u||!a||a.role!=="manager")return;const S=new Date;console.log(`[AlertMonitor] Vérification des alertes à ${S.toLocaleTimeString()}`);try{await _t(d,m),v.current=S}catch(C){console.error("[AlertMonitor] Erreur lors de la vérification des alertes:",C)}},[u,a,d,m]);n.useEffect(()=>{if(!u){b.current&&(clearInterval(b.current),b.current=null);return}const S=setTimeout(()=>{g()},3e4);return b.current=setInterval(()=>{g()},h*60*1e3),()=>{clearTimeout(S),b.current&&(clearInterval(b.current),b.current=null)}},[u,h,g]);const j=n.useCallback(()=>{g()},[g]);return{lastCheck:v.current,forceCheck:j}}const jt=()=>(kt({enabled:!0,intervalMinutes:60}),null),wt=()=>{const[i,a]=n.useState(""),[d,m]=n.useState(""),[u,h]=n.useState(!1),[v,b]=n.useState(""),[g,j]=n.useState(!1),{login:S}=$(),C=te(),k=async x=>{if(x.preventDefault(),b(""),j(!0),!i||!d){b("Veuillez remplir tous les champs"),j(!1);return}await S(i,d)||b("Identifiants incorrects"),j(!1)};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:e.jsxs("div",{style:{background:"var(--card-bg)",padding:"2.5rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"420px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1.5rem"},children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),e.jsx("h2",{style:{textAlign:"center",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Connexion"}),e.jsx("p",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"0.95rem"},children:"Gestion des Stocks"}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Nom d'utilisateur"}),e.jsx("input",{type:"text",value:i,onChange:x=>a(x.target.value),placeholder:"Entrez votre nom d'utilisateur",disabled:g,style:{width:"100%",padding:"0.875rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:x=>x.target.style.borderColor="var(--border-color)",onBlur:x=>x.target.style.borderColor="var(--border-color)"})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:u?"text":"password",value:d,onChange:x=>m(x.target.value),placeholder:"Entrez votre mot de passe",disabled:g,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:x=>x.target.style.borderColor="var(--border-color)",onBlur:x=>x.target.style.borderColor="var(--border-color)"}),e.jsx("button",{type:"button",onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1),onTouchStart:()=>h(!0),onTouchEnd:()=>h(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":u?"Masquer le mot de passe":"Afficher le mot de passe",children:u?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),v&&e.jsx("div",{style:{padding:"0.875rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.9rem"},children:v}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"submit",disabled:g,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.7:1},onMouseEnter:x=>{g||(x.currentTarget.style.background="rgba(128, 128, 128, 0.2)",x.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:x=>{x.currentTarget.style.background="transparent",x.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:g?"Connexion...":"Se connecter"}),e.jsx("button",{type:"button",onClick:()=>C("/register"),disabled:g,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.7:1},onMouseEnter:x=>{g||(x.currentTarget.style.background="rgba(128, 128, 128, 0.2)",x.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:x=>{x.currentTarget.style.background="transparent",x.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:"S'inscrire"})]})]}),e.jsx("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"1.5rem",marginTop:"1.5rem",textAlign:"center"},children:e.jsxs("button",{type:"button",onClick:()=>C("/badge-login"),disabled:g,style:{padding:"0.875rem 1.5rem",background:"transparent",color:"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",fontSize:"0.9rem",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.5:1,display:"inline-flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:x=>{g||(x.currentTarget.style.background="rgba(128, 128, 128, 0.1)")},onMouseLeave:x=>{x.currentTarget.style.background="transparent"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),"Connexion par badge"]})})]})})},St=()=>{const[i,a]=n.useState(""),[d,m]=n.useState(""),[u,h]=n.useState(!1),[v,b]=n.useState(!1),{loginWithBadge:g}=$(),j=te(),S=n.useRef(null),C=4,k=20,x=300;n.useEffect(()=>{var _;(_=S.current)==null||_.focus()},[]),n.useEffect(()=>{if(i.length>=C&&i.length<=k){const _=setTimeout(()=>{D()},x);return()=>clearTimeout(_)}},[i]);const D=async()=>{var _,f;if(!(!i.trim()||u)){m(""),h(!0),b(!0);try{await g(i.trim())||(m("Badge non reconnu"),a(""),(_=S.current)==null||_.focus())}catch{m("Erreur lors de la connexion"),a(""),(f=S.current)==null||f.focus()}finally{h(!1),setTimeout(()=>b(!1),500)}}},R=_=>{const f=_.target.value;/^[a-zA-Z0-9]*$/.test(f)&&(a(f),m(""))};return e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:[e.jsxs("div",{style:{background:"var(--card-bg)",padding:"3rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"500px",border:"1px solid var(--border-color)",textAlign:"center"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"2rem",animation:v?"pulse 1s infinite":"none"},children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:v?"#10b981":"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"}),e.jsx("line",{x1:"7",y1:"16",x2:"13",y2:"16"})]})}),e.jsx("h2",{style:{marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Scanner votre badge"}),e.jsx("p",{style:{marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"1rem"},children:"Utilisez le lecteur code-barre ou saisissez manuellement"}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx("input",{ref:S,type:"text",value:i,onChange:R,placeholder:"Numéro de badge",disabled:u,autoComplete:"off",style:{width:"100%",padding:"1.25rem",background:"var(--input-bg)",border:`2px solid ${d?"#ef4444":v?"#10b981":"var(--border-color)"}`,borderRadius:"8px",color:"var(--text-color)",fontSize:"1.5rem",textAlign:"center",fontFamily:"monospace",fontWeight:"600",letterSpacing:"0.2rem",transition:"all 0.3s",outline:"none"}})}),v&&e.jsx("div",{style:{padding:"1rem",background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"8px",color:"#10b981",marginBottom:"1.5rem",fontSize:"0.95rem",fontWeight:"500"},children:"✓ Badge détecté, connexion en cours..."}),d&&e.jsxs("div",{style:{padding:"1rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.95rem",fontWeight:"500"},children:["✕ ",d]}),e.jsx("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"1.5rem",marginTop:"1.5rem"},children:e.jsx("button",{type:"button",onClick:()=>j("/login"),disabled:u,style:{padding:"0.875rem 1.5rem",background:"transparent",color:"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",fontSize:"0.9rem",cursor:u?"not-allowed":"pointer",transition:"all 0.2s",opacity:u?.5:1},onMouseEnter:_=>{u||(_.currentTarget.style.background="rgba(128, 128, 128, 0.1)")},onMouseLeave:_=>{_.currentTarget.style.background="transparent"},children:"Connexion classique"})})]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
            opacity: 1;
          }
          50% {
            transform: scale(1.05);
            opacity: 0.8;
          }
        }
      `})]})},Ct=()=>{const[i,a]=n.useState(""),[d,m]=n.useState(""),[u,h]=n.useState(""),[v,b]=n.useState(!1),[g,j]=n.useState(!1),[S,C]=n.useState(""),[k,x]=n.useState(!1),{register:D}=$(),R=te(),_=async f=>{if(f.preventDefault(),C(""),!i||!d||!u){C("Tous les champs sont obligatoires");return}if(i.length<3){C("L'identifiant doit contenir au moins 3 caractères");return}if(d.length<6){C("Le mot de passe doit contenir au moins 6 caractères");return}if(d!==u){C("Les mots de passe ne correspondent pas");return}x(!0);try{console.log("Tentative d'inscription avec:",{username:i});const z=await D(i,i,d);console.log("Résultat inscription:",z),z?R("/catalog"):C("Échec de l'inscription. Vérifiez la console pour plus de détails.")}catch(z){console.error("Erreur d'inscription:",z),C("Une erreur est survenue lors de l'inscription. Vérifiez la console pour plus de détails.")}finally{x(!1)}};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:e.jsxs("div",{style:{background:"var(--card-bg)",padding:"2.5rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"420px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1.5rem"},children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),e.jsx("h2",{style:{textAlign:"center",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Créer un compte"}),e.jsx("p",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"0.95rem"},children:"Gestion des Stocks"}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Identifiant"}),e.jsx("input",{type:"text",value:i,onChange:f=>a(f.target.value),placeholder:"Entrez votre identifiant",disabled:k,style:{width:"100%",padding:"0.875rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:v?"text":"password",value:d,onChange:f=>m(f.target.value),placeholder:"Entrez votre mot de passe",disabled:k,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"}),e.jsx("button",{type:"button",onMouseDown:()=>b(!0),onMouseUp:()=>b(!1),onMouseLeave:()=>b(!1),onTouchStart:()=>b(!0),onTouchEnd:()=>b(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":v?"Masquer le mot de passe":"Afficher le mot de passe",children:v?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Confirmer le mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:g?"text":"password",value:u,onChange:f=>h(f.target.value),placeholder:"Confirmez votre mot de passe",disabled:k,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"}),e.jsx("button",{type:"button",onMouseDown:()=>j(!0),onMouseUp:()=>j(!1),onMouseLeave:()=>j(!1),onTouchStart:()=>j(!0),onTouchEnd:()=>j(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":g?"Masquer le mot de passe":"Afficher le mot de passe",children:g?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),S&&e.jsx("div",{style:{padding:"0.875rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.9rem"},children:S}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>R("/"),disabled:k,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:k?"not-allowed":"pointer",transition:"all 0.2s",opacity:k?.7:1},onMouseEnter:f=>{k||(f.currentTarget.style.background="rgba(128, 128, 128, 0.2)",f.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:f=>{f.currentTarget.style.background="transparent",f.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:"Se connecter"}),e.jsx("button",{type:"submit",disabled:k,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:k?"not-allowed":"pointer",transition:"all 0.2s",opacity:k?.7:1},onMouseEnter:f=>{k||(f.currentTarget.style.background="rgba(128, 128, 128, 0.2)",f.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:f=>{f.currentTarget.style.background="transparent",f.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:k?"Création...":"S'inscrire"})]})]})]})})},Et=()=>{const{currentUser:i,logout:a,exitRequests:d,getPendingExits:m,getPendingOrders:u}=$(),h=te(),v=et(),[b,g]=ie.useState(!1),j=()=>{a(),h("/")},S=()=>{g(!b)},C=()=>{g(!1)},k=(i==null?void 0:i.role)==="manager",x=ie.useMemo(()=>{const M=d.filter(N=>N.status==="pending"),P=new Set;return M.forEach(N=>{const Z=`${N.requestedBy}-${new Date(N.requestedAt).toISOString().slice(0,16)}`;P.add(Z)}),P.size},[d]),D=m().length,R=u().length,_=M=>v.pathname===M,W=k?[{path:"/dashboard",label:"Tableau de bord",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})},{path:"/products",label:"Produits",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})},{path:"/add-product",label:"Ajouter Produit",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})},{path:"/orders",label:"Réception",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),e.jsx("path",{d:"M9 12h6"}),e.jsx("path",{d:"M9 16h6"})]})},{path:"/requests",label:"Vérifications",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})},{path:"/inventory",label:"Inventaire",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("path",{d:"M9 15h6"}),e.jsx("path",{d:"M12 12v6"})]})},{path:"/statistics",label:"Statistiques",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})},{path:"/history",label:"Historique",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})},{path:"/user-management",label:"Gestion Utilisateurs",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},{path:"/label-generator",label:"Étiquettes",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),e.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]})},{path:"/settings",label:"Paramètres",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6m5.196-13.804l-4.242 4.242m-5.908 5.908l-4.242 4.242M23 12h-6m-6 0H1m18.196 5.196l-4.242-4.242m-5.908-5.908L4.804 2.804"})]})}]:[{path:"/catalog",label:"Catalogue",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]})},{path:"/my-statistics",label:"Mes Statistiques",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})}];return e.jsxs("div",{className:"layout-container",children:[e.jsx("button",{className:"mobile-menu-button",onClick:S,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),b&&e.jsx("div",{className:"mobile-menu-overlay",onClick:C}),e.jsxs("aside",{className:`sidebar ${b?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("div",{className:"sidebar-logo",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"})})}),e.jsxs("div",{className:"sidebar-title-container",children:[e.jsx("h1",{className:"sidebar-title",children:"StockPro"}),e.jsx("p",{className:"sidebar-subtitle",children:"Ajust'82"})]})]}),e.jsx("nav",{className:"sidebar-nav",children:W.map(M=>e.jsxs(tt,{to:M.path,className:`sidebar-link ${_(M.path)?"active":""}`,title:M.label,onClick:C,children:[e.jsx("span",{className:"sidebar-link-icon",children:M.icon}),e.jsx("span",{className:"sidebar-link-label",children:M.label}),M.path==="/requests"&&x>0&&e.jsx("span",{className:"sidebar-badge",children:x}),M.path==="/orders"&&R>0&&e.jsx("span",{className:"sidebar-badge",children:R}),M.path==="/exit-sheet"&&D>0&&e.jsx("span",{className:"sidebar-badge",children:D})]},M.path))}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsxs("div",{className:"sidebar-user",children:[e.jsx("div",{className:"user-avatar",children:i==null?void 0:i.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:i==null?void 0:i.name}),e.jsx("div",{className:"user-role",children:k?"Gestionnaire":"Utilisateur"})]})]}),e.jsx("div",{className:"footer-actions",children:e.jsx("button",{onClick:j,className:"btn-logout",title:"Déconnexion",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})})]})]}),e.jsx("main",{className:"main-content",children:e.jsx(rt,{})})]})},At=n.lazy(()=>q(()=>import("./Dashboard-BPFeYR1v.js"),__vite__mapDeps([0,1,2]))),Mt=n.lazy(()=>q(()=>import("./AddProduct-C3CPAFtw.js"),__vite__mapDeps([3,1,2]))),Lt=n.lazy(()=>q(()=>import("./Products-DJhQbLNY.js"),__vite__mapDeps([4,1,5,2,6,7]))),Rt=n.lazy(()=>q(()=>import("./Settings-w_GWU1dV.js"),__vite__mapDeps([8,1,2]))),Tt=n.lazy(()=>q(()=>import("./Requests-Bvy06BJw.js"),__vite__mapDeps([9,1,2]))),Dt=n.lazy(()=>q(()=>import("./Orders-Bt0LD4g-.js"),__vite__mapDeps([10,1,2]))),qt=n.lazy(()=>q(()=>import("./Statistics-BybVYTRP.js"),__vite__mapDeps([11,1,2]))),Bt=n.lazy(()=>q(()=>import("./UserCatalog-esBmd5jl.js"),__vite__mapDeps([12,1,2,13]))),zt=n.lazy(()=>q(()=>import("./UserStatistics-zVf_sB-k.js"),__vite__mapDeps([14,1,2]))),It=n.lazy(()=>q(()=>import("./History-CnSTtKnw.js"),__vite__mapDeps([15,1,5,2,6]))),Pt=n.lazy(()=>q(()=>import("./Inventory-DL1ptwOy.js"),__vite__mapDeps([16,1,2,17]))),Nt=n.lazy(()=>q(()=>import("./UserManagement-C7e8NlQL.js"),__vite__mapDeps([18,1,2,19]))),Wt=n.lazy(()=>q(()=>import("./LabelGenerator-BZat6I7V.js"),__vite__mapDeps([20,1,7,5,2,21]))),Ot=()=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]}),e.jsx("p",{style:{fontSize:"1.1rem",color:"var(--text-secondary)",fontWeight:"500"},children:"Chargement..."})]}),T=({children:i,allowedRole:a})=>{const{currentUser:d}=$();return d?a&&d.role!==a?e.jsx(H,{to:d.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(e.Fragment,{children:i}):e.jsx(H,{to:"/",replace:!0})},Ut=()=>{const{currentUser:i}=$();return e.jsxs(e.Fragment,{children:[i&&e.jsx(jt,{}),e.jsxs(nt,{children:[e.jsx(L,{path:"/",element:i?e.jsx(H,{to:i.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(wt,{})}),e.jsx(L,{path:"/register",element:i?e.jsx(H,{to:i.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(Ct,{})}),e.jsx(L,{path:"/badge-login",element:i?e.jsx(H,{to:i.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(St,{})}),e.jsxs(L,{element:e.jsx(T,{children:e.jsx(n.Suspense,{fallback:e.jsx(Ot,{}),children:e.jsx(Et,{})})}),children:[e.jsx(L,{path:"/dashboard",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(At,{})})}),e.jsx(L,{path:"/products",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Lt,{})})}),e.jsx(L,{path:"/add-product",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Mt,{})})}),e.jsx(L,{path:"/settings",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Rt,{})})}),e.jsx(L,{path:"/requests",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Tt,{})})}),e.jsx(L,{path:"/orders",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Dt,{})})}),e.jsx(L,{path:"/history",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(It,{})})}),e.jsx(L,{path:"/statistics",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(qt,{})})}),e.jsx(L,{path:"/inventory",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Pt,{})})}),e.jsx(L,{path:"/user-management",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Nt,{})})}),e.jsx(L,{path:"/label-generator",element:e.jsx(T,{allowedRole:"manager",children:e.jsx(Wt,{})})}),e.jsx(L,{path:"/catalog",element:e.jsx(T,{allowedRole:"user",children:e.jsx(Bt,{})})}),e.jsx(L,{path:"/my-statistics",element:e.jsx(T,{allowedRole:"user",children:e.jsx(zt,{})})})]}),e.jsx(L,{path:"*",element:e.jsx(H,{to:"/",replace:!0})})]})]})},Vt=()=>e.jsx(ot,{basename:"/GestionDesStocks",children:e.jsx(gt,{children:e.jsx(ht,{children:e.jsx(Ut,{})})})});le.createRoot(document.getElementById("root")).render(e.jsx(ie.StrictMode,{children:e.jsx(Vt,{})}));export{Ht as a,_t as c,e as j,$ as u};
