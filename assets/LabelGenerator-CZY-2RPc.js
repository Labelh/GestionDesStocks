import{u as ie,j as t}from"./index-QTtNBvix.js";import{r as m}from"./react-vendor-DRM3MNr6.js";import{J as ae}from"./JsBarcode-CmyaEkaf.js";import{E as re}from"./heavy-libs-Dn1T2gkY.js";import"./supabase-g_Un6fVd.js";const ue=()=>{const{products:v}=ie(),[o,j]=m.useState([]),[w,R]=m.useState(""),[u,X]=m.useState(""),[g,Z]=m.useState(""),i=m.useCallback(e=>e?e.replace(/Étagère\s*/gi,"").replace(/Position\s*/gi,"").replace(/\s*-\s*/g,"-").replace(/\.+/g,"-").replace(/-+/g,"-"):"",[]),G=m.useMemo(()=>Array.from(new Set(v.map(e=>e.location?i(e.location).split("-")[0]:"").filter(e=>e))).sort(),[v,i]),H=m.useMemo(()=>Array.from(new Set(v.map(e=>{if(!e.location)return"";const n=i(e.location).split("-");return n.length>=2?`${n[0]}-${n[1]}`:""}).filter(e=>e))).sort(),[v,i]),y=m.useMemo(()=>v.filter(e=>{const n=e.reference.toLowerCase().includes(w.toLowerCase())||e.designation.toLowerCase().includes(w.toLowerCase()),s=!u||e.location&&i(e.location).startsWith(u),d=!g||e.location&&i(e.location).startsWith(g);return n&&s&&d}),[v,w,u,g,i]),$=e=>{const n=o.find(s=>s.product.id===e.id);j(n?o.map(s=>s.product.id===e.id?{...s,quantity:s.quantity+1}:s):[...o,{product:e,quantity:1}])},B=e=>{j(o.filter(n=>n.product.id!==e))},J=(e,n)=>{n<1||j(o.map(s=>s.product.id===e?{...s,quantity:n}:s))},O=()=>{if(!u)return;const e=y.filter(s=>s.location&&i(s.location).startsWith(u)),n=[...o];e.forEach(s=>{n.find(x=>x.product.id===s.id)||n.push({product:s,quantity:1})}),j(n)},Q=()=>{if(!g)return;const e=y.filter(s=>s.location&&i(s.location).startsWith(g)),n=[...o];e.forEach(s=>{n.find(x=>x.product.id===s.id)||n.push({product:s,quantity:1})}),j(n)},U=()=>{const e=new re({orientation:"portrait",unit:"mm",format:"a4"}),n=210,s=297,d=4,x=12,V=0,_=0,b=52.5,P=24.75,N=2.5,C=2,z=()=>{e.setDrawColor(200,200,200);const f=2,F=2;for(let r=1;r<=d;r++){const p=r*b;let a=0;const c=s;for(;a<c;){const l=Math.min(a+f,c);e.line(p,a,p,l),a=l+F}}for(let r=1;r<=x;r++){const p=r*P;let a=0;const c=n;for(;a<c;){const l=Math.min(a+f,c);e.line(a,p,l,p),a=l+F}}};let S=0;z(),o.forEach(({product:f,quantity:F})=>{for(let r=0;r<F;r++){const p=S%d,a=Math.floor(S%(d*x)/d);S>0&&S%(d*x)===0&&(e.addPage(),z());const c=V+p*b,l=_+a*P,D=document.createElement("canvas");try{ae(D,f.reference,{format:"CODE128",width:1.5,height:40,displayValue:!1,margin:0});const W=D.toDataURL("image/png"),E=i(f.location)||"N/A";e.setFontSize(5.5);const K=e.getTextWidth(E),L=1,T=K+2*L,A=b-2*N-T-2;e.setTextColor(0,0,0),e.setFontSize(7),e.setFont("helvetica","normal");let h=f.designation;if(e.getTextWidth(h)>A){for(;e.getTextWidth(h+"...")>A&&h.length>0;)h=h.substring(0,h.length-1);h+="..."}const ee=l+C+2.5;e.text(h,c+N,ee),e.setTextColor(255,87,34),e.setFontSize(7),e.setFont("helvetica","bold");const te=l+C+7;e.text(f.reference,c+N,te);const M=4,Y=c+b-N-T,k=l+C;e.setFillColor(220,220,220),e.roundedRect(Y,k,T,M,.5,.5,"F"),e.setTextColor(0,0,0),e.setFontSize(5.5),e.setFont("helvetica","normal"),e.text(E,Y+L,k+M/2+1.2);const se=b-2*N,I=10,ne=c+N,oe=l+P-I-C;e.addImage(W,"PNG",ne,oe,se,I)}catch(W){console.error("Error generating barcode for PDF:",W)}S++}}),e.save(`etiquettes_${new Date().toISOString().split("T")[0]}.pdf`)},q=()=>o.reduce((e,n)=>e+n.quantity,0);return t.jsxs("div",{className:"label-generator-page",children:[t.jsx("div",{className:"page-header",children:t.jsxs("div",{className:"page-title-section",children:[t.jsx("h1",{children:"Générateur d'Étiquettes"}),t.jsx("p",{className:"page-subtitle",children:"Créez et imprimez vos étiquettes de produits"})]})}),t.jsxs("div",{className:"generator-container",children:[t.jsxs("div",{className:"products-selection",children:[t.jsx("h2",{children:"Sélectionner les Produits"}),t.jsx("input",{type:"text",placeholder:"Rechercher par référence ou désignation...",value:w,onChange:e=>R(e.target.value),className:"search-input"}),t.jsxs("div",{className:"filter-section",children:[t.jsxs("select",{value:u,onChange:e=>X(e.target.value),className:"zone-filter",children:[t.jsx("option",{value:"",children:"Toutes les zones"}),G.map(e=>t.jsx("option",{value:e,children:e},e))]}),u&&t.jsx("button",{onClick:O,className:"btn-select-zone",title:"Sélectionner tous les produits de cette zone",children:"Sélectionner toute la zone"})]}),t.jsxs("div",{className:"filter-section",children:[t.jsxs("select",{value:g,onChange:e=>Z(e.target.value),className:"zone-filter",children:[t.jsx("option",{value:"",children:"Tous les tiroirs"}),H.map(e=>t.jsx("option",{value:e,children:e},e))]}),g&&t.jsx("button",{onClick:Q,className:"btn-select-zone",title:"Sélectionner tous les produits de ce tiroir",children:"Sélectionner tout le tiroir"})]}),t.jsx("div",{className:"products-list",children:y.map(e=>t.jsxs("div",{className:"product-item",children:[t.jsxs("div",{className:"product-info",children:[t.jsx("div",{className:"product-ref",children:e.reference}),t.jsx("div",{className:"product-name",children:e.designation}),t.jsx("div",{className:"product-location",children:i(e.location)||"N/A"})]}),t.jsx("button",{onClick:()=>$(e),className:"btn-add",title:"Ajouter",children:"+"})]},e.id))})]}),t.jsxs("div",{className:"selected-products",children:[t.jsxs("h2",{children:["Produits Sélectionnés (",q()," étiquettes)"]}),o.length===0?t.jsx("p",{className:"no-selection",children:"Aucun produit sélectionné"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"selected-list",children:o.map(({product:e,quantity:n})=>t.jsxs("div",{className:"selected-item",children:[t.jsxs("div",{className:"selected-info",children:[t.jsx("div",{className:"selected-ref",children:e.reference}),t.jsx("div",{className:"selected-name",children:e.designation})]}),t.jsxs("div",{className:"selected-controls",children:[t.jsx("input",{type:"number",min:"1",value:n,onChange:s=>J(e.id,parseInt(s.target.value)||1),className:"quantity-input"}),t.jsx("button",{onClick:()=>B(e.id),className:"btn-remove",title:"Retirer",children:"×"})]})]},e.id))}),t.jsx("div",{className:"preview-actions",children:t.jsxs("button",{onClick:U,className:"btn btn-primary",disabled:o.length===0,children:["Générer le PDF (",q()," étiquettes)"]})})]})]})]})]})};export{ue as default};
