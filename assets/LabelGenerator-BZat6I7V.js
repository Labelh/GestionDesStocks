import{u as oe,j as t}from"./index-Ck31D-JO.js";import{r as m}from"./react-vendor-DRM3MNr6.js";import{J as ie}from"./JsBarcode-CmyaEkaf.js";import{E as ae}from"./heavy-libs-Dn1T2gkY.js";import"./supabase-g_Un6fVd.js";const me=()=>{const{products:v}=oe(),[o,j]=m.useState([]),[w,I]=m.useState(""),[u,R]=m.useState(""),[g,X]=m.useState(""),i=m.useCallback(e=>e?e.replace(/Étagère\s*/gi,"").replace(/Position\s*/gi,"").replace(/\s*-\s*/g,"-").replace(/\.+/g,"-").replace(/-+/g,"-"):"",[]),Z=m.useMemo(()=>Array.from(new Set(v.map(e=>e.location?i(e.location).split("-")[0]:"").filter(e=>e))).sort(),[v,i]),G=m.useMemo(()=>Array.from(new Set(v.map(e=>{if(!e.location)return"";const n=i(e.location).split("-");return n.length>=2?`${n[0]}-${n[1]}`:""}).filter(e=>e))).sort(),[v,i]),F=m.useMemo(()=>v.filter(e=>{const n=e.reference.toLowerCase().includes(w.toLowerCase())||e.designation.toLowerCase().includes(w.toLowerCase()),s=!u||e.location&&i(e.location).startsWith(u),d=!g||e.location&&i(e.location).startsWith(g);return n&&s&&d}),[v,w,u,g,i]),H=e=>{const n=o.find(s=>s.product.id===e.id);j(n?o.map(s=>s.product.id===e.id?{...s,quantity:s.quantity+1}:s):[...o,{product:e,quantity:1}])},$=e=>{j(o.filter(n=>n.product.id!==e))},B=(e,n)=>{n<1||j(o.map(s=>s.product.id===e?{...s,quantity:n}:s))},J=()=>{if(!u)return;const e=F.filter(s=>s.location&&i(s.location).startsWith(u)),n=[...o];e.forEach(s=>{n.find(x=>x.product.id===s.id)||n.push({product:s,quantity:1})}),j(n)},O=()=>{if(!g)return;const e=F.filter(s=>s.location&&i(s.location).startsWith(g)),n=[...o];e.forEach(s=>{n.find(x=>x.product.id===s.id)||n.push({product:s,quantity:1})}),j(n)},Q=()=>{const e=new ae({orientation:"portrait",unit:"mm",format:"a4"}),n=210,s=297,d=4,x=12,U=0,V=0,b=52.5,y=24.75,N=1.5,q=()=>{e.setDrawColor(200,200,200);const f=2,C=2;for(let r=1;r<=d;r++){const p=r*b;let a=0;const c=s;for(;a<c;){const l=Math.min(a+f,c);e.line(p,a,p,l),a=l+C}}for(let r=1;r<=x;r++){const p=r*y;let a=0;const c=n;for(;a<c;){const l=Math.min(a+f,c);e.line(a,p,l,p),a=l+C}}};let S=0;q(),o.forEach(({product:f,quantity:C})=>{for(let r=0;r<C;r++){const p=S%d,a=Math.floor(S%(d*x)/d);S>0&&S%(d*x)===0&&(e.addPage(),q());const c=U+p*b,l=V+a*y,z=document.createElement("canvas");try{ie(z,f.reference,{format:"CODE128",width:1.5,height:40,displayValue:!1,margin:0});const P=z.toDataURL("image/png"),D=i(f.location)||"N/A";e.setFontSize(5.5);const _=e.getTextWidth(D),E=1,W=_+2*E,L=b-2*N-W-2;e.setTextColor(0,0,0),e.setFontSize(7),e.setFont("helvetica","normal");let h=f.designation;if(e.getTextWidth(h)>L){for(;e.getTextWidth(h+"...")>L&&h.length>0;)h=h.substring(0,h.length-1);h+="..."}const K=l+4;e.text(h,c+N,K),e.setTextColor(255,87,34),e.setFontSize(7),e.setFont("helvetica","bold");const ee=l+8.5;e.text(f.reference,c+N,ee);const A=4,M=c+b-N-W,Y=l+2;e.setFillColor(220,220,220),e.roundedRect(M,Y,W,A,.5,.5,"F"),e.setTextColor(0,0,0),e.setFontSize(5.5),e.setFont("helvetica","normal"),e.text(D,M+E,Y+A/2+1.2);const te=b-2*N,k=10,se=c+N,ne=l+y-k-1;e.addImage(P,"PNG",se,ne,te,k)}catch(P){console.error("Error generating barcode for PDF:",P)}S++}}),e.save(`etiquettes_${new Date().toISOString().split("T")[0]}.pdf`)},T=()=>o.reduce((e,n)=>e+n.quantity,0);return t.jsxs("div",{className:"label-generator-page",children:[t.jsx("div",{className:"page-header",children:t.jsxs("div",{className:"page-title-section",children:[t.jsx("h1",{children:"Générateur d'Étiquettes"}),t.jsx("p",{className:"page-subtitle",children:"Créez et imprimez vos étiquettes de produits"})]})}),t.jsxs("div",{className:"generator-container",children:[t.jsxs("div",{className:"products-selection",children:[t.jsx("h2",{children:"Sélectionner les Produits"}),t.jsx("input",{type:"text",placeholder:"Rechercher par référence ou désignation...",value:w,onChange:e=>I(e.target.value),className:"search-input"}),t.jsxs("div",{className:"filter-section",children:[t.jsxs("select",{value:u,onChange:e=>R(e.target.value),className:"zone-filter",children:[t.jsx("option",{value:"",children:"Toutes les zones"}),Z.map(e=>t.jsx("option",{value:e,children:e},e))]}),u&&t.jsx("button",{onClick:J,className:"btn-select-zone",title:"Sélectionner tous les produits de cette zone",children:"Sélectionner toute la zone"})]}),t.jsxs("div",{className:"filter-section",children:[t.jsxs("select",{value:g,onChange:e=>X(e.target.value),className:"zone-filter",children:[t.jsx("option",{value:"",children:"Tous les tiroirs"}),G.map(e=>t.jsx("option",{value:e,children:e},e))]}),g&&t.jsx("button",{onClick:O,className:"btn-select-zone",title:"Sélectionner tous les produits de ce tiroir",children:"Sélectionner tout le tiroir"})]}),t.jsx("div",{className:"products-list",children:F.map(e=>t.jsxs("div",{className:"product-item",children:[t.jsxs("div",{className:"product-info",children:[t.jsx("div",{className:"product-ref",children:e.reference}),t.jsx("div",{className:"product-name",children:e.designation}),t.jsx("div",{className:"product-location",children:i(e.location)||"N/A"})]}),t.jsx("button",{onClick:()=>H(e),className:"btn-add",title:"Ajouter",children:"+"})]},e.id))})]}),t.jsxs("div",{className:"selected-products",children:[t.jsxs("h2",{children:["Produits Sélectionnés (",T()," étiquettes)"]}),o.length===0?t.jsx("p",{className:"no-selection",children:"Aucun produit sélectionné"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"selected-list",children:o.map(({product:e,quantity:n})=>t.jsxs("div",{className:"selected-item",children:[t.jsxs("div",{className:"selected-info",children:[t.jsx("div",{className:"selected-ref",children:e.reference}),t.jsx("div",{className:"selected-name",children:e.designation})]}),t.jsxs("div",{className:"selected-controls",children:[t.jsx("input",{type:"number",min:"1",value:n,onChange:s=>B(e.id,parseInt(s.target.value)||1),className:"quantity-input"}),t.jsx("button",{onClick:()=>$(e.id),className:"btn-remove",title:"Retirer",children:"×"})]})]},e.id))}),t.jsx("div",{className:"preview-actions",children:t.jsxs("button",{onClick:Q,className:"btn btn-primary",disabled:o.length===0,children:["Générer le PDF (",T()," étiquettes)"]})})]})]})]})]})};export{me as default};
