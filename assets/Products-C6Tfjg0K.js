import{u as ot,a as it,j as t}from"./index-DlynR0Vu.js";import{r as u}from"./react-vendor-D8CQoBvY.js";import{P as lt}from"./PackagingIcon-88MTl6Np.js";import{E as Le,u as ce,w as at}from"./heavy-libs-Bko_YaNF.js";import{a as ct}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{J as dt}from"./JsBarcode-DPx7lVFH.js";import{s as j}from"./pdfTextUtils-D1ThJazT.js";import"./supabase-BffQhpPo.js";const jt=()=>{const{products:P,updateProduct:X,deleteProduct:Pe,categories:J,units:Te,storageZones:Ee,stockMovements:de,addOrder:ze,getPendingOrders:he,updateOrder:De,getAverageDeliveryTime:Re,reloadProducts:Ie}=ot(),{addNotification:$}=it(),[M,Me]=u.useState(""),[_,We]=u.useState(""),[W,Ae]=u.useState(""),[l,K]=u.useState(null),[r,a]=u.useState({}),[C,ue]=u.useState(null),[ee,te]=u.useState(0),[m,me]=u.useState(null),[F,re]=u.useState(null),[U,Z]=u.useState(0),[D,xe]=u.useState(25),A=u.useRef(null),Be=u.useRef(null),[Y,ge]=u.useState(!1),pe=e=>he().filter(o=>o.product_id===e).reduce((o,s)=>o+s.quantity,0),[Oe,H]=u.useState(!1),[c,R]=u.useState({includePhotos:!0,includeBarcodes:!0,includeStock:!0,includeLocation:!0,selectedCategories:[]}),fe=e=>{if(e.minStock===0)return"normal";const n=e.currentStock/e.minStock;return n<.5?"critical":n<1?"low":"normal"},ve=e=>e?e.replace(/√âtag√®re\s*/gi,"").replace(/Position\s*/gi,"").replace(/\s*-\s*/g,"-").replace(/\.+/g,"-").replace(/-+/g,"-"):"",S=P.filter(e=>{const n=e.reference.toLowerCase().includes(M.toLowerCase())||e.designation.toLowerCase().includes(M.toLowerCase())||e.customerReference&&e.customerReference.toLowerCase().includes(M.toLowerCase()),o=!_||e.category===_;let s=!0;return W&&(W==="ordered"?s=pe(e.id)>0:s=fe(e)===W),n&&o&&s}),ne=S.slice(0,D),je=u.useMemo(()=>{const e=new Date,n=new Date(e.getTime()-30*24*60*60*1e3),o={};return ne.forEach(s=>{const i=de.filter(w=>w.productId===s.id&&w.movementType==="exit"&&w.timestamp>=n).reduce((w,N)=>w+N.quantity,0);o[s.id]=i/30}),o},[ne,de]);u.useEffect(()=>{xe(25)},[M,_,W]),u.useEffect(()=>{const e=new IntersectionObserver(n=>{n[0].isIntersecting&&D<S.length&&xe(o=>Math.min(o+25,S.length))},{threshold:.1});return A.current&&e.observe(A.current),()=>{A.current&&e.unobserve(A.current)}},[D,S.length]);const $e=e=>{K(e),a({designation:e.designation,customerReference:e.customerReference||"",category:e.category,storageZone:e.storageZone,shelf:e.shelf,position:e.position,currentStock:e.currentStock,minStock:e.minStock,unit:e.unit,unitPrice:e.unitPrice,supplier1:e.supplier1||"",orderLink1:e.orderLink1||e.orderLink||"",supplier2:e.supplier2||"",orderLink2:e.orderLink2||"",supplier3:e.supplier3||"",orderLink3:e.orderLink3||"",photo:e.photo||""})},_e=e=>{var o;const n=(o=e.target.files)==null?void 0:o[0];if(n){const s=new FileReader;s.onloadend=()=>{a({...r,photo:s.result})},s.readAsDataURL(n)}},Ue=async()=>{if(l)try{const e={};if(r.designation!==void 0&&r.designation!==l.designation&&(e.designation=r.designation),r.category!==void 0&&r.category!==l.category&&(e.category=r.category),r.packagingType!==void 0&&r.packagingType!==l.packagingType&&(e.packagingType=r.packagingType),r.storageZone!==void 0&&r.storageZone!==l.storageZone&&(e.storageZone=r.storageZone),r.shelf!==void 0&&r.shelf!==l.shelf&&(e.shelf=r.shelf),r.position!==void 0&&r.position!==l.position&&(e.position=r.position),r.currentStock!==void 0&&r.currentStock!==l.currentStock&&(e.currentStock=r.currentStock),r.minStock!==void 0&&r.minStock!==l.minStock&&(e.minStock=r.minStock),r.unit!==void 0&&r.unit!==l.unit&&(e.unit=r.unit),r.unitPrice!==void 0&&r.unitPrice!==l.unitPrice&&(e.unitPrice=r.unitPrice),r.supplier1!==void 0&&r.supplier1!==l.supplier1&&(e.supplier1=r.supplier1),r.orderLink1!==void 0&&r.orderLink1!==l.orderLink1&&(e.orderLink1=r.orderLink1),r.supplier2!==void 0&&r.supplier2!==l.supplier2&&(e.supplier2=r.supplier2),r.orderLink2!==void 0&&r.orderLink2!==l.orderLink2&&(e.orderLink2=r.orderLink2),r.supplier3!==void 0&&r.supplier3!==l.supplier3&&(e.supplier3=r.supplier3),r.orderLink3!==void 0&&r.orderLink3!==l.orderLink3&&(e.orderLink3=r.orderLink3),r.photo!==void 0&&r.photo!==l.photo&&(e.photo=r.photo),e.storageZone!==void 0||e.shelf!==void 0||e.position!==void 0){const n=e.storageZone!==void 0?e.storageZone:l.storageZone,o=e.shelf!==void 0?e.shelf:l.shelf,s=e.position!==void 0?e.position:l.position;if(n){const B=o??"",i=s??"";e.location=`${n}.${B}.${i}`}else e.location=""}Object.keys(e).length>0&&await X(l.id,e),K(null),a({})}catch(e){console.error("Erreur lors de la sauvegarde:",e),alert("Erreur lors de la sauvegarde du produit")}},ye=()=>{K(null),a({})},Ze=async e=>{if(window.confirm("√ätes-vous s√ªr de vouloir supprimer ce produit ?"))try{await Pe(e)}catch(n){console.error("Erreur lors de la suppression:",n),alert("Erreur lors de la suppression du produit")}},Ye=async()=>{if(!C||ee<=0){alert("Veuillez saisir une quantit√© valide");return}try{const e=C.currentStock+ee;await X(C.id,{currentStock:e}),ue(null),te(0)}catch(e){console.error("Erreur lors de la r√©ception:",e),alert("Erreur lors de la r√©ception du produit")}},se=()=>{ue(null),te(0)},He=e=>{me(e)},be=()=>{me(null)},Qe=e=>{re(e),Z(0)},Ve=async()=>{if(!F||U<=0){alert("Veuillez saisir une quantit√© valide");return}try{await ze({product_id:F.id,product_reference:F.reference,product_designation:F.designation,quantity:U}),$({type:"success",title:"Commande enregistr√©e",message:`${U} ${F.unit} de ${F.designation} command√©(s)`,duration:5e3}),re(null),Z(0)}catch(e){console.error("Erreur lors de la commande:",e),$({type:"error",title:"Erreur",message:"Erreur lors de l'enregistrement de la commande",duration:5e3})}},ke=()=>{re(null),Z(0)},Ge=()=>{const e=new Le;e.setFontSize(20),e.text("Liste des Produits",14,22),e.setFontSize(10),e.text(`G√©n√©r√© le ${new Date().toLocaleDateString("fr-FR")} √† ${new Date().toLocaleTimeString("fr-FR")}`,14,30);const n=P.map(o=>[j(o.reference),j(o.designation),j(o.category),j(o.location),o.currentStock.toString(),o.minStock.toString(),j(o.unit)]);ct(e,{startY:36,head:[["R√©f√©rence","D√©signation","Cat√©gorie","Emplacement","Stock actuel","Min","Unit√©"]],body:n,styles:{fontSize:9},headStyles:{fillColor:[197,90,58]}}),e.save(`liste_produits_${new Date().toISOString().split("T")[0]}.pdf`)},qe=()=>{const e=P.map(s=>({R√©f√©rence:s.reference,D√©signation:s.designation,Cat√©gorie:s.category,"Zone de stockage":s.storageZone||"",√âtag√®re:s.shelf||"",Position:s.position||"",Emplacement:s.location,"Stock actuel":s.currentStock,"Stock minimum":s.minStock,Unit√©:s.unit,"Cr√©√© le":new Date(s.createdAt).toLocaleString("fr-FR"),"Modifi√© le":new Date(s.updatedAt).toLocaleString("fr-FR")})),n=ce.json_to_sheet(e),o=ce.book_new();ce.book_append_sheet(o,n,"Produits"),n["!cols"]=[{wch:12},{wch:30},{wch:15},{wch:15},{wch:10},{wch:10},{wch:35},{wch:12},{wch:12},{wch:12},{wch:8},{wch:18},{wch:18}],at(o,`liste_produits_${new Date().toISOString().split("T")[0]}.xlsx`)},Xe=async()=>{ge(!0);try{await Ie(!0),$({type:"success",title:"Produits mis √† jour",message:"La liste des produits a √©t√© recharg√©e depuis la base de donn√©es",duration:3e3})}catch(e){console.error("Erreur lors du rafra√Æchissement:",e),$({type:"error",title:"Erreur",message:"Erreur lors du rafra√Æchissement des produits",duration:5e3})}finally{ge(!1)}},Je=()=>{const e=new Le({orientation:"portrait",unit:"mm",format:"a4"}),n=210,o=297,s=15,B=n-2*s,i=[255,87,34];let w=P;c.selectedCategories.length>0&&(w=P.filter(d=>c.selectedCategories.includes(d.category)));const N={};w.forEach(d=>{N[d.category]||(N[d.category]=[]),N[d.category].push(d)});const Ce=Object.keys(N).sort();let f=0;const oe={};e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",n/2,8,{align:"center"}),e.setTextColor(0,0,0),e.setFontSize(10),e.setFont("helvetica","normal");let x=25,y=s;const Q=(n-2*s-10)/2;Ce.forEach((d,g)=>{oe[d]=f+1+g,x>o-40&&y===s&&(y=s+Q+10,x=25),x>o-40&&y!==s&&(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",n/2,8,{align:"center"}),y=s,x=25),e.setFillColor(240,240,240),e.roundedRect(y-2,x-5,Q+4,7,1,1,"F"),e.setTextColor(i[0],i[1],i[2]),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(d,y,x),x+=8,N[d].forEach(p=>{x>o-40&&(y===s?(y=s+Q+10,x=25):(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",n/2,8,{align:"center"}),y=s,x=25)),e.setTextColor(0,0,0),e.setFontSize(9),e.setFont("helvetica","normal");const V=p.designation.length>35?p.designation.substring(0,32)+"...":p.designation;e.text(V,y+2,x),e.text(`${oe[d]}`,y+Q-5,x,{align:"right"}),x+=5}),x+=3}),Ce.forEach(d=>{e.addPage(),f++,oe[d]=f,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("CATALOGUE PRODUITS",n/2,8,{align:"center"}),e.setTextColor(i[0],i[1],i[2]),e.setFontSize(28),e.setFont("helvetica","bold"),e.text(d,s,35),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,n-s,o-10,{align:"right"});const g=N[d],p=(B-10)/2,V=102;let E=s,G=50,O=0;g.forEach(b=>{O%6===0&&O>0&&(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text(d.toUpperCase(),n/2,8,{align:"center"}),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,n-s,o-10,{align:"right"}),G=20,E=s);const et=O%2,tt=Math.floor(O%6/2);E=s+et*(p+10),G=50+tt*(V+10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.roundedRect(E,G,p,V,3,3);const z=5;let le=G+z;if(c.includePhotos){const h=p-2*z,v=E+z,k=le;if(b.photo)try{e.addImage(b.photo,"JPEG",v,k,h,h),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.rect(v,k,h,h)}catch{e.setFillColor(245,245,245),e.rect(v,k,h,h,"F"),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.rect(v,k,h,h),e.setTextColor(200,200,200),e.setFontSize(32),e.text("üì¶",v+h/2,k+h/2+6,{align:"center"})}else e.setFillColor(245,245,245),e.rect(v,k,h,h,"F"),e.setDrawColor(220,220,220),e.setLineWidth(.3),e.rect(v,k,h,h),e.setTextColor(200,200,200),e.setFontSize(32),e.text("üì¶",v+h/2,k+h/2+6,{align:"center"});le+=h+5}const q=E+z;let L=le;e.setTextColor(i[0],i[1],i[2]),e.setFontSize(9),e.setFont("helvetica","bold"),e.text(j(b.reference),q,L);const Se=j(b.category);e.setFontSize(7),e.setFont("helvetica","bold");const Fe=e.getTextWidth(Se)+4,we=E+p-Fe-z,ae=L-3;e.setFillColor(240,240,240),e.roundedRect(we,ae,Fe,5,1,1,"F"),e.setTextColor(100,100,100),e.text(Se,we+2,ae+3.5);let rt=ae+7;if(c.includeBarcodes){const h=document.createElement("canvas");try{dt(h,b.reference,{format:"CODE128",width:1,height:20,displayValue:!1,margin:0});const v=h.toDataURL("image/png"),k=35;e.addImage(v,"PNG",E+p-k-z,rt,k,7)}catch(v){console.error("Error generating barcode:",v)}}L+=3.5,e.setTextColor(0,0,0),e.setFontSize(8),e.setFont("helvetica","normal");const nt=p-2*z,Ne=e.splitTextToSize(j(b.designation),nt);e.text(Ne.slice(0,2),q,L),L+=3*Math.min(Ne.length,2)+1,c.includeLocation&&b.location&&(e.setFontSize(7),e.setTextColor(80,80,80),e.text(`Emplacement: ${j(ve(b.location))}`,q,L),L+=3),c.includeStock&&(e.setFontSize(7),e.setTextColor(80,80,80),e.text(`Stock: ${b.currentStock} ${j(b.unit)} | Min: ${b.minStock}`,q,L)),O++})}),e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("INDEX ALPHAB√âTIQUE",n/2,8,{align:"center"});const Ke=[...w].sort((d,g)=>d.designation.localeCompare(g.designation,"fr",{sensitivity:"base"}));e.setTextColor(0,0,0),e.setFontSize(8),e.setFont("helvetica","normal");let T=25,I=s;const ie=(n-2*s-10)/2;Ke.forEach(d=>{T>o-30&&I===s&&(I=s+ie+10,T=25),T>o-30&&I!==s&&(e.addPage(),f++,e.setFillColor(i[0],i[1],i[2]),e.rect(0,0,n,12,"F"),e.setTextColor(255,255,255),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("INDEX ALPHAB√âTIQUE",n/2,8,{align:"center"}),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,n-s,o-10,{align:"right"}),I=s,T=25),e.setTextColor(0,0,0),e.setFontSize(8),e.setFont("helvetica","normal");let g=j(d.designation);const p=ie-20;if(e.getTextWidth(g)>p){for(;e.getTextWidth(g+"...")>p&&g.length>0;)g=g.substring(0,g.length-1);g+="..."}e.text(g,I,T),e.setTextColor(i[0],i[1],i[2]),e.setFont("helvetica","bold"),e.text(j(d.reference),I+ie-5,T,{align:"right"}),T+=5}),e.setFontSize(9),e.setTextColor(100,100,100),e.setFont("helvetica","normal"),e.text(`${f}`,n-s,o-10,{align:"right"}),e.save(`catalogue_produits_${new Date().toISOString().split("T")[0]}.pdf`),H(!1)};return t.jsxs("div",{className:"products-page",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h1",{style:{margin:0},children:"Gestion des Produits"}),(()=>{const e=Re();return e>0&&t.jsxs("div",{style:{padding:"0.5rem 1rem",background:"var(--card-bg)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[t.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:"Temps moyen de livraison: "}),t.jsxs("span",{style:{fontSize:"1rem",fontWeight:"600",color:"var(--accent-color)"},children:[e," jours"]})]})})()]}),t.jsxs("div",{className:"filters",children:[t.jsx("input",{type:"text",placeholder:"Rechercher par r√©f√©rence ou d√©signation...",value:M,onChange:e=>Me(e.target.value),className:"search-input"}),t.jsxs("select",{value:_,onChange:e=>We(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Toutes les cat√©gories"}),J.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]}),t.jsxs("select",{value:W,onChange:e=>Ae(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"",children:"Tous les statuts"}),t.jsx("option",{value:"critical",children:"Critique"}),t.jsx("option",{value:"low",children:"Faible"}),t.jsx("option",{value:"medium",children:"Moyen"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"ordered",children:"En commande"})]}),t.jsxs("button",{onClick:Xe,className:"btn btn-secondary",disabled:Y,style:{display:"flex",alignItems:"center",gap:"0.5rem",opacity:Y?.7:1},children:[t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:Y?"spin 1s linear infinite":"none"},children:t.jsx("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0118.8-4.3M22 12.5a10 10 0 01-18.8 4.2"})}),Y?"Actualisation...":"Actualiser"]}),t.jsx("button",{onClick:Ge,className:"btn btn-secondary",children:"Export PDF"}),t.jsx("button",{onClick:qe,className:"btn btn-secondary",children:"Export Excel"}),t.jsx("button",{onClick:()=>H(!0),className:"btn btn-primary",children:"G√©n√©rer Catalogue PDF"})]}),S.length===0?t.jsx("p",{className:"no-data",children:"Aucun produit trouv√©"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:Be,className:"products-table-container",children:t.jsxs("table",{className:"products-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Photo"}),t.jsx("th",{children:"R√©f√©rence"}),t.jsx("th",{children:"D√©signation"}),t.jsx("th",{children:"Cat√©gorie"}),t.jsx("th",{children:"Emplacement"}),t.jsx("th",{children:"Stock Actuel"}),t.jsx("th",{children:"Conso. Moy/j"}),t.jsx("th",{children:"Jours avant rupture"}),t.jsx("th",{children:"Prix Unitaire"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:ne.map(e=>{var n;return t.jsxs("tr",{children:[t.jsx("td",{children:e.photo?t.jsx("img",{src:e.photo,alt:e.designation,className:"product-thumb"}):t.jsx("div",{className:"product-thumb-placeholder",children:"?"})}),t.jsx("td",{children:e.reference}),t.jsx("td",{children:(()=>{const o=pe(e.id);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",alignItems:"flex-start"},children:[t.jsx("div",{children:e.designation}),o>0&&t.jsxs("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",fontSize:"0.7rem",fontWeight:"600",color:"#fff",background:"#10b981",borderRadius:"4px",width:"fit-content"},children:["En commande x",o]})]})})()}),t.jsx("td",{children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(lt,{type:e.packagingType,mode:"icon",size:"small"}),t.jsx("span",{children:e.category})]})}),t.jsxs("td",{title:`Raw: ${e.location} | Zone: ${e.storageZone} | Shelf: ${e.shelf} | Position: ${e.position}`,children:["[",ve(e.location),"]"]}),t.jsx("td",{children:t.jsx("span",{className:`stock-value stock-${fe(e)}`,children:e.currentStock})}),t.jsx("td",{children:((n=je[e.id])==null?void 0:n.toFixed(1))||"0.0"}),t.jsx("td",{children:(()=>{const o=je[e.id]||0;if(o===0)return"‚àû";const s=Math.floor(e.currentStock/o);return s>999?"‚àû":s})()}),t.jsx("td",{children:e.unitPrice?`${e.unitPrice.toFixed(2)} ‚Ç¨`:"-"}),t.jsx("td",{children:t.jsxs("div",{className:"actions",children:[t.jsx("button",{onClick:()=>$e(e),className:"btn-icon btn-edit",title:"Modifier",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(e.orderLink1||e.orderLink2||e.orderLink3||e.orderLink)&&t.jsx("button",{onClick:()=>He(e),className:"btn-icon btn-gray",title:"Fournisseur",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),t.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}),t.jsx("button",{onClick:()=>Qe(e),className:"btn-icon btn-order",title:"Commander",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"9",cy:"21",r:"1"}),t.jsx("circle",{cx:"20",cy:"21",r:"1"}),t.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]})}),t.jsx("button",{onClick:()=>Ze(e.id),className:"btn-icon btn-delete-red",title:"Supprimer",children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})})})]})})]},e.id)})})]})}),t.jsxs("div",{ref:A,style:{height:"20px",margin:"20px 0"},children:[D<S.length&&t.jsxs("div",{style:{textAlign:"center",color:"#666"},children:["Chargement de plus de produits... (",D," / ",S.length,")"]}),D>=S.length&&S.length>25&&t.jsxs("div",{style:{textAlign:"center",color:"#666"},children:["Tous les produits sont affich√©s (",S.length,")"]})]})]}),l&&t.jsx("div",{className:"modal-overlay",onClick:ye,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:"Modifier le Produit"}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Informations g√©n√©rales"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"D√©signation"}),t.jsx("input",{type:"text",value:r.designation||"",onChange:e=>a({...r,designation:e.target.value})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"R√©f√©rence Client"}),t.jsx("input",{type:"text",value:r.customerReference||"",onChange:e=>a({...r,customerReference:e.target.value}),placeholder:"R√©f√©rence du client (optionnel)"})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Cat√©gorie"}),t.jsx("select",{value:r.category||"",onChange:e=>a({...r,category:e.target.value}),children:J.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Type de conditionnement"}),t.jsxs("select",{value:r.packagingType||"unit",onChange:e=>a({...r,packagingType:e.target.value}),children:[t.jsx("option",{value:"unit",children:"üîß Unit√© - D√©clarer √† chaque sortie"}),t.jsx("option",{value:"lot",children:"üì¶ Lot/Bo√Æte - D√©clarer √† l'ouverture"})]})]})]})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Localisation"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Zone de stockage"}),t.jsx("select",{value:r.storageZone||"",onChange:e=>a({...r,storageZone:e.target.value}),children:Ee.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"N¬∞ √âtag√®re"}),t.jsx("input",{type:"number",value:r.shelf!==void 0?r.shelf:"",min:"1",onChange:e=>a({...r,shelf:parseInt(e.target.value)||1})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"N¬∞ Position"}),t.jsx("input",{type:"number",value:r.position!==void 0?r.position:"",min:"1",onChange:e=>a({...r,position:parseInt(e.target.value)||1})})]})]})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Gestion du stock"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Stock Actuel"}),t.jsx("input",{type:"number",value:r.currentStock!==void 0?r.currentStock:"",step:"1",min:"0",onChange:e=>a({...r,currentStock:parseInt(e.target.value)||0})})]}),t.jsx("div",{className:"form-group"})]}),t.jsx("div",{className:"form-row",children:t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Stock Minimum"}),t.jsx("input",{type:"number",value:r.minStock!==void 0?r.minStock:"",step:"1",min:"0",onChange:e=>a({...r,minStock:parseInt(e.target.value)||0})})]})}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Unit√©"}),t.jsx("select",{value:r.unit||"",onChange:e=>a({...r,unit:e.target.value}),children:Te.map(e=>t.jsxs("option",{value:e.abbreviation,children:[e.name," (",e.abbreviation,")"]},e.id))})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Prix Unitaire (‚Ç¨)"}),t.jsx("input",{type:"number",value:r.unitPrice!==void 0?r.unitPrice:"",step:"0.01",min:"0",placeholder:"0.00",onChange:e=>a({...r,unitPrice:parseFloat(e.target.value)||void 0})})]})]})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("h2",{className:"form-section-title",children:"Fournisseurs et commandes"}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"supplier1",children:"Fournisseur 1"}),t.jsx("input",{type:"text",id:"supplier1",value:r.supplier1||"",onChange:e=>a({...r,supplier1:e.target.value}),placeholder:"Nom du fournisseur"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderLink1",children:"Lien de Commande 1"}),t.jsx("input",{type:"url",id:"orderLink1",value:r.orderLink1||"",onChange:e=>a({...r,orderLink1:e.target.value}),placeholder:"https://exemple.com/produit"})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"supplier2",children:"Fournisseur 2"}),t.jsx("input",{type:"text",id:"supplier2",value:r.supplier2||"",onChange:e=>a({...r,supplier2:e.target.value}),placeholder:"Nom du fournisseur"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderLink2",children:"Lien de Commande 2"}),t.jsx("input",{type:"url",id:"orderLink2",value:r.orderLink2||"",onChange:e=>a({...r,orderLink2:e.target.value}),placeholder:"https://exemple.com/produit"})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"supplier3",children:"Fournisseur 3"}),t.jsx("input",{type:"text",id:"supplier3",value:r.supplier3||"",onChange:e=>a({...r,supplier3:e.target.value}),placeholder:"Nom du fournisseur"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderLink3",children:"Lien de Commande 3"}),t.jsx("input",{type:"url",id:"orderLink3",value:r.orderLink3||"",onChange:e=>a({...r,orderLink3:e.target.value}),placeholder:"https://exemple.com/produit"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"photo",children:"Photo du Produit"}),t.jsx("input",{type:"file",id:"photo",accept:"image/*",onChange:_e}),r.photo&&t.jsx("div",{className:"photo-preview",children:t.jsx("img",{src:r.photo,alt:"Aper√ßu"})})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:ye,className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Ue,className:"btn btn-primary",children:"Enregistrer"})]})]})}),C&&t.jsx("div",{className:"modal-overlay",onClick:se,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),style:{maxWidth:"700px"},children:[t.jsx("h2",{children:"R√©ception de Stock"}),t.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:[C.reference," - ",C.designation]}),(()=>{const e=he().filter(n=>n.product_id===C.id);return e.length>0&&t.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1.25rem",background:"var(--card-bg)",borderRadius:"8px",border:"2px solid var(--accent-color)"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1.1rem",fontWeight:"600",color:"var(--accent-color)"},children:"üì¶ Commandes en attente"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:e.map(n=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",background:"var(--bg-color)",borderRadius:"6px",border:"1px solid var(--border-color)"},children:[t.jsxs("div",{children:[t.jsxs("span",{style:{fontWeight:"700",fontSize:"1.1rem",color:"var(--text-primary)"},children:[n.quantity," ",C.unit]}),t.jsxs("span",{style:{color:"var(--text-secondary)",marginLeft:"0.75rem",fontSize:"0.9rem"},children:["Command√© le ",new Date(n.ordered_at).toLocaleDateString("fr-FR")]})]}),t.jsx("button",{onClick:async()=>{try{const o=C.currentStock+n.quantity;await X(C.id,{currentStock:o}),await De(n.id,{status:"received",received_at:new Date}),se()}catch(o){console.error("Erreur lors de la r√©ception:",o),alert("Erreur lors de la r√©ception")}},className:"btn btn-success",style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},children:"‚úì R√©ceptionner"})]},n.id))})]})})(),t.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1.25rem",background:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1.1rem",fontWeight:"600"},children:"‚úèÔ∏è R√©ception manuelle"}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Quantit√© Re√ßue *"}),t.jsx("input",{type:"number",value:ee||"",step:"1",min:"1",onChange:e=>te(parseInt(e.target.value)||0),placeholder:"Quantit√© re√ßue",autoFocus:!0})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:se,className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Ye,className:"btn btn-primary",children:"Valider la R√©ception"})]})]})}),m&&t.jsx("div",{className:"modal-overlay",onClick:be,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:"Liens de Commande"}),t.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:[m.reference," - ",m.designation]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[(m.orderLink1||m.orderLink)&&t.jsxs("a",{href:m.orderLink1||m.orderLink,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",padding:"1.5rem",borderRadius:"8px",background:"var(--card-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:"0.75rem",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",children:[t.jsx("path",{d:"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:m.supplier1||"Fournisseur 1"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary-color)",fontSize:"0.9rem",fontWeight:"500"},children:[t.jsx("span",{children:"Ouvrir le lien"}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15 3 21 3 21 9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]}),m.orderLink2&&t.jsxs("a",{href:m.orderLink2,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",padding:"1.5rem",borderRadius:"8px",background:"var(--card-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:"0.75rem",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",children:[t.jsx("path",{d:"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:m.supplier2||"Fournisseur 2"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary-color)",fontSize:"0.9rem",fontWeight:"500"},children:[t.jsx("span",{children:"Ouvrir le lien"}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15 3 21 3 21 9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]}),m.orderLink3&&t.jsxs("a",{href:m.orderLink3,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",padding:"1.5rem",borderRadius:"8px",background:"var(--card-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:"0.75rem",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",children:[t.jsx("path",{d:"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"}),t.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),t.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:m.supplier3||"Fournisseur 3"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary-color)",fontSize:"0.9rem",fontWeight:"500"},children:[t.jsx("span",{children:"Ouvrir le lien"}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15 3 21 3 21 9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]})]}),t.jsx("div",{className:"modal-actions",style:{marginTop:"1.5rem"},children:t.jsx("button",{onClick:be,className:"btn btn-secondary",children:"Fermer"})})]})}),F&&t.jsx("div",{className:"modal-overlay",onClick:ke,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:"Commander un Produit"}),t.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:[F.reference," - ",F.designation]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"orderQuantity",children:"Quantit√© command√©e *"}),t.jsx("input",{type:"number",id:"orderQuantity",value:U,onChange:e=>Z(parseInt(e.target.value)||0),min:"1",placeholder:"0",autoFocus:!0})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:ke,className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Ve,className:"btn btn-primary",children:"Enregistrer la Commande"})]})]})}),Oe&&t.jsx("div",{className:"modal-overlay",onClick:()=>H(!1),children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),style:{maxWidth:"600px"},children:[t.jsx("h2",{children:"Configuration du Catalogue PDF"}),t.jsx("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:"Personnalisez les informations √† inclure dans votre catalogue"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem"},children:[t.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Options d'affichage"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includePhotos,onChange:e=>R({...c,includePhotos:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les photos des produits"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includeBarcodes,onChange:e=>R({...c,includeBarcodes:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les codes-barres"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includeStock,onChange:e=>R({...c,includeStock:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les niveaux de stock"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.includeLocation,onChange:e=>R({...c,includeLocation:e.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:"Inclure les emplacements"})]})]}),t.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Filtrer par cat√©gories"}),t.jsx("p",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:"Laissez vide pour inclure toutes les cat√©gories"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",maxHeight:"200px",overflowY:"auto"},children:J.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:c.selectedCategories.includes(e.name),onChange:n=>{n.target.checked?R({...c,selectedCategories:[...c.selectedCategories,e.name]}):R({...c,selectedCategories:c.selectedCategories.filter(o=>o!==e.name)})},style:{width:"18px",height:"18px",cursor:"pointer"}}),t.jsx("span",{children:e.name}),t.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.875rem",color:"var(--text-secondary)"},children:["(",P.filter(n=>n.category===e.name).length," produits)"]})]},e.id))})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:()=>H(!1),className:"btn btn-secondary",children:"Annuler"}),t.jsx("button",{onClick:Je,className:"btn btn-primary",disabled:c.selectedCategories.length>0&&P.filter(e=>c.selectedCategories.includes(e.category)).length===0,children:"G√©n√©rer le Catalogue PDF"})]})]})})]})};export{jt as default};
