import{u as X,a as Y,j as e,c as _}from"./index-QTtNBvix.js";import{r}from"./react-vendor-DRM3MNr6.js";import"./supabase-g_Un6fVd.js";const se=()=>{const{categories:j,addCategory:D,updateCategory:M,deleteCategory:T,units:g,addUnit:W,deleteUnit:Z,storageZones:v,addStorageZone:z,updateStorageZone:B,deleteStorageZone:L,currentUser:s,updateUserProfile:V,products:F,stockMovements:U}=X(),{addNotification:h}=Y(),[o,x]=r.useState({name:"",description:""}),[l,u]=r.useState({name:"",abbreviation:"",isDefault:!1}),[c,p]=r.useState({name:"",description:""}),[n,d]=r.useState(null),[i,m]=r.useState(null),[b,f]=r.useState(""),[y,N]=r.useState(!0),[k,C]=r.useState(!0),[A,w]=r.useState(!1),[S,E]=r.useState(!1);r.useEffect(()=>{s!=null&&s.alertEmail&&f(s.alertEmail),(s==null?void 0:s.enableStockAlerts)!==void 0&&N(s.enableStockAlerts),(s==null?void 0:s.enableConsumptionAlerts)!==void 0&&C(s.enableConsumptionAlerts)},[s]);const q=t=>{t.preventDefault(),o.name.trim()&&(D(o),x({name:"",description:""}))},P=t=>{t.preventDefault(),n&&n.name.trim()&&(M(n.id,{name:n.name,description:n.description}),d(null))},H=t=>{t.preventDefault(),l.name.trim()&&l.abbreviation.trim()&&(W(l),u({name:"",abbreviation:"",isDefault:!1}))},I=t=>{window.confirm("√ätes-vous s√ªr de vouloir supprimer cette cat√©gorie ?")&&T(t)},R=t=>{window.confirm("√ätes-vous s√ªr de vouloir supprimer cette unit√© ?")&&Z(t)},G=t=>{t.preventDefault(),c.name.trim()&&(z(c),p({name:"",description:""}))},K=t=>{t.preventDefault(),i&&i.name.trim()&&(B(i.id,{name:i.name,description:i.description}),m(null))},J=t=>{window.confirm("√ätes-vous s√ªr de vouloir supprimer cette zone ?")&&L(t)},O=async t=>{t.preventDefault(),w(!0);try{await V({alertEmail:b.trim()||void 0,enableStockAlerts:y,enableConsumptionAlerts:k}),h({type:"success",title:"Succ√®s",message:"Param√®tres des alertes enregistr√©s avec succ√®s"})}catch(a){console.error("Erreur lors de la sauvegarde des alertes:",a),h({type:"error",title:"Erreur",message:"Erreur lors de la sauvegarde des param√®tres"})}finally{w(!1)}},Q=async()=>{E(!0);try{console.log("üîî Test manuel des alertes..."),await _(F,U),h({type:"success",title:"Test effectu√©",message:"V√©rification des alertes termin√©e. Consultez la console (F12) pour les d√©tails."})}catch(t){console.error("Erreur lors du test des alertes:",t),h({type:"error",title:"Erreur",message:"Erreur lors du test des alertes"})}finally{E(!1)}};return e.jsxs("div",{className:"settings-page",children:[e.jsx("h1",{children:"Param√®tres"}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Gestion des Cat√©gories"}),e.jsx("form",{onSubmit:q,className:"add-form",children:e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Nom de la cat√©gorie",value:o.name,onChange:t=>x({...o,name:t.target.value}),className:"form-input"}),e.jsx("input",{type:"text",placeholder:"Description (optionnel)",value:o.description,onChange:t=>x({...o,description:t.target.value}),className:"form-input"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Ajouter"})]})}),e.jsx("div",{className:"items-list",children:j.length===0?e.jsx("p",{className:"no-data",children:"Aucune cat√©gorie"}):e.jsxs("table",{className:"settings-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:j.map(t=>e.jsx("tr",{children:(n==null?void 0:n.id)===t.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:n.name,onChange:a=>d({...n,name:a.target.value}),className:"form-input"})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:n.description||"",onChange:a=>d({...n,description:a.target.value}),className:"form-input"})}),e.jsxs("td",{children:[e.jsx("button",{onClick:P,className:"btn-icon btn-edit",title:"Enregistrer",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{onClick:()=>d(null),className:"btn-icon btn-gray",title:"Annuler",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("strong",{children:t.name})}),e.jsx("td",{children:t.description||"-"}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>d(t),className:"btn-icon btn-edit",title:"Modifier",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"})]})}),e.jsx("button",{onClick:()=>I(t.id),className:"btn-icon btn-delete",title:"Supprimer",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})})})]})]})},t.id))})]})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Gestion des Unit√©s"}),e.jsx("p",{className:"section-description",children:"Les unit√©s permettent de d√©finir comment mesurer vos stocks (pi√®ces, kg, L, etc.)"}),e.jsx("form",{onSubmit:H,className:"add-form",children:e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Nom de l'unit√© (ex: Kilogramme)",value:l.name,onChange:t=>u({...l,name:t.target.value}),className:"form-input"}),e.jsx("input",{type:"text",placeholder:"Abr√©viation (ex: kg)",value:l.abbreviation,onChange:t=>u({...l,abbreviation:t.target.value}),className:"form-input",style:{maxWidth:"150px"}}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:l.isDefault,onChange:t=>u({...l,isDefault:t.target.checked})}),"Par d√©faut"]}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Ajouter"})]})}),e.jsx("div",{className:"items-list",children:g.length===0?e.jsx("p",{className:"no-data",children:"Aucune unit√©"}):e.jsxs("table",{className:"settings-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Abr√©viation"}),e.jsx("th",{children:"Par d√©faut"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:t.name})}),e.jsx("td",{children:t.abbreviation}),e.jsx("td",{children:t.isDefault?"‚úì":"-"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>R(t.id),className:"btn-icon btn-delete",title:"Supprimer",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})})})})]},t.id))})]})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Gestion des Zones de Stockage"}),e.jsx("p",{className:"section-description",children:"Les zones de stockage permettent d'organiser vos produits par emplacement physique"}),e.jsx("form",{onSubmit:G,className:"add-form",children:e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Nom de la zone (ex: Zone A)",value:c.name,onChange:t=>p({...c,name:t.target.value}),className:"form-input"}),e.jsx("input",{type:"text",placeholder:"Description (optionnel)",value:c.description,onChange:t=>p({...c,description:t.target.value}),className:"form-input"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Ajouter"})]})}),e.jsx("div",{className:"items-list",children:v.length===0?e.jsx("p",{className:"no-data",children:"Aucune zone de stockage"}):e.jsxs("table",{className:"settings-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:v.map(t=>e.jsx("tr",{children:(i==null?void 0:i.id)===t.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:i.name,onChange:a=>m({...i,name:a.target.value}),className:"form-input"})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:i.description||"",onChange:a=>m({...i,description:a.target.value}),className:"form-input"})}),e.jsxs("td",{children:[e.jsx("button",{onClick:K,className:"btn-icon btn-edit",title:"Enregistrer",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{onClick:()=>m(null),className:"btn-icon btn-gray",title:"Annuler",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("strong",{children:t.name})}),e.jsx("td",{children:t.description||"-"}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>m(t),className:"btn-icon btn-edit",title:"Modifier",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"})]})}),e.jsx("button",{onClick:()=>J(t.id),className:"btn-icon btn-delete",title:"Supprimer",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})})})]})]})},t.id))})]})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Alertes Intelligentes"}),e.jsx("p",{className:"section-description",children:"Configurez les notifications par email pour √™tre alert√© des stocks faibles et des consommations inhabituelles"}),e.jsx("form",{onSubmit:O,className:"add-form",children:e.jsxs("div",{className:"form-row",style:{flexDirection:"column",gap:"1rem",alignItems:"flex-start"},children:[e.jsxs("div",{style:{width:"100%",maxWidth:"500px"},children:[e.jsx("label",{htmlFor:"alertEmail",style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Adresse email pour les alertes"}),e.jsx("input",{id:"alertEmail",type:"email",placeholder:"exemple@domaine.com",value:b,onChange:t=>f(t.target.value),className:"form-input",style:{width:"100%"}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsxs("label",{className:"checkbox-label",style:{fontSize:"0.95rem"},children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>N(t.target.checked)}),e.jsxs("div",{children:[e.jsx("strong",{children:"Alertes de stock"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Recevoir une notification lorsqu'un produit atteint son seuil minimum"})]})]}),e.jsxs("label",{className:"checkbox-label",style:{fontSize:"0.95rem"},children:[e.jsx("input",{type:"checkbox",checked:k,onChange:t=>C(t.target.checked)}),e.jsxs("div",{children:[e.jsx("strong",{children:"Alertes de consommation"}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Recevoir une notification en cas de consommation inhabituelle d'un produit"})]})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:A,style:{marginTop:"0.5rem"},children:A?"Enregistrement...":"Enregistrer les param√®tres"}),e.jsx("button",{type:"button",onClick:Q,className:"btn",disabled:S,style:{marginTop:"0.5rem",marginLeft:"1rem",background:"rgba(59, 130, 246, 0.1)",color:"#3b82f6",border:"1px solid rgba(59, 130, 246, 0.3)"},children:S?"Test en cours...":"üîî Tester les alertes maintenant"})]})}),e.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"rgba(59, 130, 246, 0.05)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"8px"},children:e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{style:{color:"var(--text-color)"},children:"üí° Comment fonctionne le syst√®me :"}),e.jsxs("ul",{style:{marginTop:"0.5rem",marginLeft:"1.5rem",lineHeight:"1.6"},children:[e.jsx("li",{children:"V√©rification automatique toutes les heures (managers uniquement)"}),e.jsx("li",{children:"D√©tection des stocks faibles (stock actuel ‚â§ stock minimum)"}),e.jsx("li",{children:"Analyse des consommations inhabituelles (+50% sur 3 derniers jours)"}),e.jsx("li",{children:"Emails envoy√©s uniquement si alertes activ√©es et email configur√©"})]}),e.jsx("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem"},children:'‚ÑπÔ∏è Utilisez le bouton "Tester" pour v√©rifier imm√©diatement sans attendre.'})]})})]})]})};export{se as default};
