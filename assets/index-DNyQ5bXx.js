const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-CCp3KGXW.js","assets/react-vendor-DRM3MNr6.js","assets/supabase-g_Un6fVd.js","assets/AddProduct-Cqj6ERS1.js","assets/Products-DLYsDtSB.js","assets/heavy-libs-Dn1T2gkY.js","assets/jspdf.plugin.autotable-CtA5BUKo.js","assets/JsBarcode-CmyaEkaf.js","assets/Settings-OiWBiNMe.js","assets/Requests-myLtbAFX.js","assets/Orders-CbVhhH73.js","assets/Statistics-Dw4qGC30.js","assets/UserCatalog-DTYwWK2O.js","assets/UserCatalog-9hwq_QUF.css","assets/UserStatistics-D7MUZwCq.js","assets/History-BjuQmF08.js","assets/Inventory-iTictVNs.js","assets/Inventory-CqlswDvP.css","assets/UserManagement-CaatopVq.js","assets/UserManagement-BTHCkYSO.css","assets/LabelGenerator-BmQLENOJ.js","assets/LabelGenerator-BCXE6jyD.css"])))=>i.map(i=>d[i]);
import{r as s,a as tt,u as te,b as rt,R as ae,L as ot,O as nt,B as st,d as at,e as q,N as H}from"./react-vendor-DRM3MNr6.js";import{c as it,_ as z}from"./supabase-g_Un6fVd.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))p(u);new MutationObserver(u=>{for(const h of u)if(h.type==="childList")for(const v of h.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&p(v)}).observe(document,{childList:!0,subtree:!0});function d(u){const h={};return u.integrity&&(h.integrity=u.integrity),u.referrerPolicy&&(h.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?h.credentials="include":u.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function p(u){if(u.ep)return;u.ep=!0;const h=d(u);fetch(u.href,h)}})();var We={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lt=s,ct=Symbol.for("react.element"),dt=Symbol.for("react.fragment"),ut=Object.prototype.hasOwnProperty,mt=lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pt={key:!0,ref:!0,__self:!0,__source:!0};function Oe(c,a,d){var p,u={},h=null,v=null;d!==void 0&&(h=""+d),a.key!==void 0&&(h=""+a.key),a.ref!==void 0&&(v=a.ref);for(p in a)ut.call(a,p)&&!pt.hasOwnProperty(p)&&(u[p]=a[p]);if(c&&c.defaultProps)for(p in a=c.defaultProps,a)u[p]===void 0&&(u[p]=a[p]);return{$$typeof:ct,type:c,key:h,ref:v,props:u,_owner:mt.current}}re.Fragment=dt;re.jsx=Oe;re.jsxs=Oe;We.exports=re;var e=We.exports,ie={},Ne=tt;ie.createRoot=Ne.createRoot,ie.hydrateRoot=Ne.hydrateRoot;const gt="https://jxymbulpvnzzysfcsxvw.supabase.co",ht="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4eW1idWxwdm56enlzZmNzeHZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNjc0OTAsImV4cCI6MjA3NTk0MzQ5MH0.J2EFM3FgswrWw1KGRmA-3t9fon0a_nff_0bcqEaeJCc",m=it(gt,ht,{auth:{persistSession:!0,autoRefreshToken:!0}}),Ue=s.createContext(void 0),$=()=>{const c=s.useContext(Ue);if(!c)throw new Error("useApp must be used within an AppProvider");return c},ft=({children:c})=>{const[a,d]=s.useState(null),[p,u]=s.useState(!0),[h,v]=s.useState([]),[y,g]=s.useState([]),[w,C]=s.useState([]),[E,j]=s.useState([]),[b,T]=s.useState([]),[L,_]=s.useState([]),[f,P]=s.useState([]),[N,M]=s.useState([]),[U,R]=s.useState([]),W=s.useMemo(()=>{const r=new Map;return y.forEach(t=>r.set(t.id,t)),r},[y]),J=s.useMemo(()=>{const r=new Map;return w.forEach(t=>r.set(t.name,t)),r},[w]),Y=s.useMemo(()=>{const r=new Map;return E.forEach(t=>r.set(t.abbreviation,t)),r},[E]),K=s.useMemo(()=>{const r=new Map;return b.forEach(t=>r.set(t.name,t)),r},[b]);s.useEffect(()=>{(async()=>{await Ze(),await V()})()},[]);const Ze=s.useCallback(async()=>{try{const{data:{session:r}}=await m.auth.getSession();if(r!=null&&r.user){const{data:t}=await m.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",r.user.id).single();t&&d({id:t.id,username:t.username,password:"",role:t.role,name:t.name,badgeNumber:t.badge_number||void 0,alertEmail:t.alert_email||void 0,enableStockAlerts:t.enable_stock_alerts??!0,enableConsumptionAlerts:t.enable_consumption_alerts??!0})}}catch(r){console.error("Erreur lors de la vérification de l'utilisateur:",r)}finally{u(!1)}},[]),V=s.useCallback(async()=>{try{await Promise.all([Z(),$e(),He(),Fe()]),await Promise.all([oe(),Ge(),Je(),Ye(),Ke()])}catch(r){console.error("Erreur lors du chargement des données:",r)}},[]),Z=s.useCallback(async()=>{const{data:r,error:t}=await m.from("user_profiles").select("id, username, name, role, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").order("name");!t&&r&&v(r.map(o=>({id:o.id,username:o.username,password:"",role:o.role,name:o.name,badgeNumber:o.badge_number||void 0,alertEmail:o.alert_email||void 0,enableStockAlerts:o.enable_stock_alerts??!0,enableConsumptionAlerts:o.enable_consumption_alerts??!0})))},[]),le=s.useCallback(async(r,t)=>{const{error:o}=await m.from("user_profiles").update({role:t}).eq("id",r);if(o)throw o;v(n=>n.map(l=>l.id===r?{...l,role:t}:l)),(a==null?void 0:a.id)===r&&d(n=>n?{...n,role:t}:null)},[a]),ce=s.useCallback(async(r,t,o,n,l)=>{try{const{data:i}=await m.from("user_profiles").select("username").eq("username",r).maybeSingle();if(i)throw new Error("Cet identifiant existe déjà");if(l){const{data:O}=await m.from("user_profiles").select("badge_number").eq("badge_number",l).maybeSingle();if(O)throw new Error("Ce numéro de badge est déjà utilisé")}const x=`${r}@gestionstocks.app`,{data:S,error:A}=await m.auth.signUp({email:x,password:o,options:{emailRedirectTo:void 0,data:{username:r,name:t}}});if(A||!S.user)throw console.error("Erreur Auth Supabase:",A),new Error((A==null?void 0:A.message)||"Erreur lors de la création du compte");await new Promise(O=>setTimeout(O,500));const k={id:S.user.id,username:r,name:t,role:n,badge_number:l||null};console.log("Création du profil utilisateur:",k);const{data:G,error:I}=await m.from("user_profiles").insert([k]).select();if(I)throw console.error("Erreur lors de la création du profil:",I),new Error("Erreur lors de la création du profil: "+I.message);console.log("Profil créé avec succès:",G),await Z()}catch(i){throw console.error("Erreur lors de la création de l'utilisateur:",i),i}},[Z]),de=s.useCallback(async(r,t)=>{if(t){const{data:n}=await m.from("user_profiles").select("id").eq("badge_number",t).neq("id",r).maybeSingle();if(n)throw new Error("Ce numéro de badge est déjà utilisé")}console.log("Mise à jour du badge:",{userId:r,badgeNumber:t});const{error:o}=await m.from("user_profiles").update({badge_number:t}).eq("id",r);if(o)throw console.error("Erreur lors de la mise à jour du badge:",o),o;if(console.log("Badge mis à jour avec succès"),await new Promise(n=>setTimeout(n,100)),await Z(),(a==null?void 0:a.id)===r){const n=await m.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",r).single();n.data&&d({id:n.data.id,username:n.data.username,password:"",role:n.data.role,name:n.data.name,badgeNumber:n.data.badge_number||void 0,alertEmail:n.data.alert_email||void 0,enableStockAlerts:n.data.enable_stock_alerts??!0,enableConsumptionAlerts:n.data.enable_consumption_alerts??!0})}},[a,Z]),ue=s.useCallback(async r=>{if(!a)throw new Error("Aucun utilisateur connecté");console.log("Mise à jour du profil utilisateur:",{userId:a.id,updates:r});const t={};r.alertEmail!==void 0&&(t.alert_email=r.alertEmail),r.enableStockAlerts!==void 0&&(t.enable_stock_alerts=r.enableStockAlerts),r.enableConsumptionAlerts!==void 0&&(t.enable_consumption_alerts=r.enableConsumptionAlerts);const{error:o}=await m.from("user_profiles").update(t).eq("id",a.id);if(o)throw console.error("Erreur lors de la mise à jour du profil:",o),o;console.log("Profil mis à jour avec succès"),await Z();const n=await m.from("user_profiles").select("id, username, role, name, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").eq("id",a.id).single();n.data&&d({id:n.data.id,username:n.data.username,password:"",role:n.data.role,name:n.data.name,badgeNumber:n.data.badge_number||void 0,alertEmail:n.data.alert_email||void 0,enableStockAlerts:n.data.enable_stock_alerts??!0,enableConsumptionAlerts:n.data.enable_consumption_alerts??!0})},[a,Z]),me=s.useCallback(async r=>{try{if((a==null?void 0:a.id)===r)throw new Error("Vous ne pouvez pas supprimer votre propre compte");const{error:t}=await m.from("user_profiles").delete().eq("id",r);if(t)throw t;v(o=>o.filter(n=>n.id!==r))}catch(t){throw console.error("Erreur lors de la suppression de l'utilisateur:",t),t}},[a]),$e=s.useCallback(async()=>{const{data:r,error:t}=await m.from("categories").select("id, name, description").order("name");!t&&r&&C(r.map(o=>({id:o.id,name:o.name,description:o.description||void 0})))},[]),pe=s.useCallback(async r=>{const{data:t,error:o}=await m.from("categories").insert([r]).select("id, name, description").single();if(!o&&t){const n={id:t.id,name:t.name,description:t.description||void 0};C(l=>[...l,n])}else throw o},[]),ge=s.useCallback(async(r,t)=>{const{error:o}=await m.from("categories").update(t).eq("id",r);if(o)throw o;{C(l=>l.map(i=>i.id===r?{...i,...t}:i));const n=w.find(l=>l.id===r);n&&n.name!==t.name&&(await m.from("products").update({category:t.name}).eq("category",n.name),g(l=>l.map(i=>i.category===n.name?{...i,category:t.name}:i)))}},[w,y]),he=s.useCallback(async r=>{const{error:t}=await m.from("categories").delete().eq("id",r);if(!t)C(o=>o.filter(n=>n.id!==r));else throw t},[]),He=s.useCallback(async()=>{const{data:r,error:t}=await m.from("units").select("id, name, abbreviation, is_default").order("name");!t&&r&&j(r.map(o=>({id:o.id,name:o.name,abbreviation:o.abbreviation,isDefault:o.is_default})))},[]),fe=s.useCallback(async r=>{const{data:t,error:o}=await m.from("units").insert([{...r,is_default:r.isDefault}]).select("id, name, abbreviation, is_default").single();if(!o&&t){const n={id:t.id,name:t.name,abbreviation:t.abbreviation,isDefault:t.is_default};j(l=>[...l,n])}else throw o},[]),xe=s.useCallback(async r=>{const{error:t}=await m.from("units").delete().eq("id",r);if(!t)j(o=>o.filter(n=>n.id!==r));else throw t},[]),Fe=s.useCallback(async()=>{const{data:r,error:t}=await m.from("storage_zones").select("id, name, description").order("name");!t&&r&&T(r.map(o=>({id:o.id,name:o.name,description:o.description||void 0})))},[]),be=s.useCallback(async r=>{const{data:t,error:o}=await m.from("storage_zones").insert([r]).select("id, name, description").single();if(!o&&t){const n={id:t.id,name:t.name,description:t.description||void 0};T(l=>[...l,n])}else throw o},[]),ye=s.useCallback(async(r,t)=>{const{data:o}=await m.from("storage_zones").select("*").eq("id",r).single(),{error:n}=await m.from("storage_zones").update(t).eq("id",r);if(n)throw n;if(T(l=>l.map(i=>i.id===r?{...i,...t}:i)),o&&o.name!==t.name){const{data:l}=await m.from("products").select("id, shelf, position").eq("storage_zone",o.name);if(l&&l.length>0)for(const i of l){const x=`${t.name}.${i.shelf||""}.${i.position||""}`;await m.from("products").update({storage_zone:t.name,location:x}).eq("id",i.id)}g(i=>i.map(x=>{if(x.storageZone===o.name){const S=`${t.name}.${x.shelf||""}.${x.position||""}`;return{...x,storageZone:t.name,location:S}}return x}))}},[]),ve=s.useCallback(async r=>{const{error:t}=await m.from("storage_zones").delete().eq("id",r);if(!t)T(o=>o.filter(n=>n.id!==r));else throw t},[]),oe=s.useCallback(async()=>{const{data:r,error:t}=await m.from("products").select(`
        id, reference, designation, category_id, storage_zone_id, shelf, position, location,
        current_stock, min_stock, max_stock, unit_id, unit_price, photo,
        order_link, order_link_1, supplier_1, order_link_2, supplier_2, order_link_3, supplier_3,
        deleted_at, created_at, updated_at,
        category:categories(name),
        storage_zone:storage_zones(name),
        unit:units(abbreviation)
      `).is("deleted_at",null).order("reference");!t&&r&&g(r.map(o=>{var n,l,i,x,S,A;return{id:o.id,reference:o.reference,designation:o.designation,category:Array.isArray(o.category)?((n=o.category[0])==null?void 0:n.name)||"":((l=o.category)==null?void 0:l.name)||"",storageZone:Array.isArray(o.storage_zone)?((i=o.storage_zone[0])==null?void 0:i.name)||void 0:((x=o.storage_zone)==null?void 0:x.name)||void 0,shelf:o.shelf||void 0,position:o.position||void 0,location:o.location,currentStock:o.current_stock,minStock:o.min_stock,maxStock:o.max_stock,unit:Array.isArray(o.unit)?((S=o.unit[0])==null?void 0:S.abbreviation)||"":((A=o.unit)==null?void 0:A.abbreviation)||"",unitPrice:o.unit_price||void 0,photo:o.photo||void 0,orderLink:o.order_link||void 0,orderLink1:o.order_link_1||void 0,supplier1:o.supplier_1||void 0,orderLink2:o.order_link_2||void 0,supplier2:o.supplier_2||void 0,orderLink3:o.order_link_3||void 0,supplier3:o.supplier_3||void 0,deletedAt:o.deleted_at?new Date(o.deleted_at):void 0,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)}}))},[]),_e=s.useCallback(async r=>{var x,S,A,k,G,I,O,se,ee;const t=(x=J.get(r.category))==null?void 0:x.id,o=(S=Y.get(r.unit))==null?void 0:S.id,n=r.storageZone?(A=K.get(r.storageZone))==null?void 0:A.id:null;if(!t||!o)throw new Error("Catégorie ou unité invalide");const{data:l,error:i}=await m.from("products").insert([{reference:r.reference,designation:r.designation,category_id:t,storage_zone_id:n,shelf:r.shelf,position:r.position,location:r.location,current_stock:r.currentStock,min_stock:r.minStock,max_stock:r.maxStock,unit_id:o,unit_price:r.unitPrice,photo:r.photo,order_link:r.orderLink,order_link_1:r.orderLink1,supplier_1:r.supplier1,order_link_2:r.orderLink2,supplier_2:r.supplier2,order_link_3:r.orderLink3,supplier_3:r.supplier3}]).select(`
        id, reference, designation, current_stock, created_at, updated_at,
        category:categories(name),
        storage_zone:storage_zones(name),
        unit:units(abbreviation)
      `).single();if(!i&&l&&a){const B=l,Qe={...r,id:B.id,category:Array.isArray(B.category)?((k=B.category[0])==null?void 0:k.name)||r.category:((G=B.category)==null?void 0:G.name)||r.category,storageZone:Array.isArray(B.storage_zone)?((I=B.storage_zone[0])==null?void 0:I.name)||r.storageZone:((O=B.storage_zone)==null?void 0:O.name)||r.storageZone,unit:Array.isArray(B.unit)?((se=B.unit[0])==null?void 0:se.abbreviation)||r.unit:((ee=B.unit)==null?void 0:ee.abbreviation)||r.unit,createdAt:new Date(B.created_at),updatedAt:new Date(B.updated_at)};g(et=>[...et,Qe]),F({productId:l.id,productReference:l.reference,productDesignation:l.designation,movementType:"initial",quantity:l.current_stock,previousStock:0,newStock:l.current_stock,userId:a.id,userName:a.name,reason:"Création du produit"})}else throw i},[J,Y,K,a]),X=s.useCallback(async(r,t,o=!1)=>{var x,S,A;const n=W.get(r);if(!n){console.error("❌ updateProduct: Produit introuvable:",r);return}const l={};if(t.designation!==void 0&&(l.designation=t.designation),t.category!==void 0){const k=(x=J.get(t.category))==null?void 0:x.id;k&&(l.category_id=k)}if(t.storageZone!==void 0){const k=(S=K.get(t.storageZone))==null?void 0:S.id;k&&(l.storage_zone_id=k)}if(t.shelf!==void 0&&(l.shelf=t.shelf),t.position!==void 0&&(l.position=t.position),t.location!==void 0&&(l.location=t.location),t.currentStock!==void 0&&(l.current_stock=t.currentStock),t.minStock!==void 0&&(l.min_stock=t.minStock),t.maxStock!==void 0&&(l.max_stock=t.maxStock),t.unit!==void 0){const k=(A=Y.get(t.unit))==null?void 0:A.id;k&&(l.unit_id=k)}t.photo!==void 0&&(l.photo=t.photo),t.orderLink!==void 0&&(l.order_link=t.orderLink),t.unitPrice!==void 0&&(l.unit_price=t.unitPrice),t.supplier1!==void 0&&(l.supplier_1=t.supplier1),t.orderLink1!==void 0&&(l.order_link_1=t.orderLink1),t.supplier2!==void 0&&(l.supplier_2=t.supplier2),t.orderLink2!==void 0&&(l.order_link_2=t.orderLink2),t.supplier3!==void 0&&(l.supplier_3=t.supplier3),t.orderLink3!==void 0&&(l.order_link_3=t.orderLink3);const{error:i}=await m.from("products").update(l).eq("id",r);if(i)throw console.error("Erreur mise à jour produit:",i),i;if(g(k=>k.map(I=>{if(I.id===r){const O=Object.fromEntries(Object.entries(t).filter(([se,ee])=>ee!==void 0));return{...I,...O,updatedAt:new Date}}return I})),!o&&t.currentStock!==void 0&&t.currentStock!==n.currentStock&&a){const k=t.currentStock-n.currentStock;F({productId:n.id,productReference:n.reference,productDesignation:n.designation,movementType:k>0?"entry":k<0?"exit":"adjustment",quantity:Math.abs(k),previousStock:n.currentStock,newStock:t.currentStock,userId:a.id,userName:a.name,reason:"Ajustement manuel du stock"})}},[W,J,Y,K,a]),ke=s.useCallback(async r=>{const{error:t}=await m.from("products").update({deleted_at:new Date().toISOString()}).eq("id",r);if(!t)g(o=>o.filter(n=>n.id!==r));else throw t},[]),je=s.useCallback(r=>W.get(r),[W]),we=s.useCallback(async()=>{const{data:r,error:t}=await m.from("products").select("reference");return t||!r?(console.error("Erreur lors de la récupération des références:",t),[]):r.map(o=>o.reference)},[]),Ge=s.useCallback(async()=>{const{data:r,error:t}=await m.from("exit_requests").select("*").order("requested_at",{ascending:!1}).limit(500);if(t){console.error("Erreur lors du chargement des demandes:",t);return}if(r){const o=[...new Set([...r.map(i=>i.requested_by).filter(Boolean),...r.map(i=>i.approved_by).filter(Boolean)])],{data:n}=await m.from("user_profiles").select("id, username").in("id",o),l=new Map((n==null?void 0:n.map(i=>[i.id,i.username]))||[]);_(r.map(i=>({id:i.id,productId:i.product_id,productReference:i.product_reference,productDesignation:i.product_designation,productPhoto:i.product_photo,quantity:i.quantity,requestedBy:l.get(i.requested_by)||i.requested_by,requestedAt:new Date(i.requested_at),status:i.status,approvedBy:i.approved_by?l.get(i.approved_by)||i.approved_by:void 0,approvedAt:i.approved_at?new Date(i.approved_at):void 0,receivedAt:i.received_at?new Date(i.received_at):void 0,reason:i.reason||void 0,notes:i.notes||void 0})))}},[]),Se=s.useCallback(async r=>{if(!a)throw new Error("Utilisateur non connecté");const{data:t,error:o}=await m.from("exit_requests").insert([{product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,product_photo:r.productPhoto,quantity:r.quantity,requested_by:a.id,reason:r.reason,status:"pending"}]).select().single();if(o)throw console.error("Erreur lors de l'ajout de la demande:",o),o;const n={id:t.id,productId:t.product_id,productReference:t.product_reference,productDesignation:t.product_designation,productPhoto:t.product_photo,quantity:t.quantity,requestedBy:a.username,requestedAt:new Date(t.requested_at),status:t.status,reason:t.reason};_(l=>[n,...l])},[a]),Ce=s.useCallback(async(r,t)=>{var i;const o=L.find(x=>x.id===r);if(!o)throw new Error("Demande introuvable");const n={};t.status&&(n.status=t.status),t.approvedBy&&(n.approved_by=t.approvedBy),t.notes&&(n.notes=t.notes),t.receivedAt&&(n.received_at=t.receivedAt.toISOString()),(t.status==="awaiting_reception"||t.status==="rejected")&&(n.approved_at=new Date().toISOString());const{error:l}=await m.from("exit_requests").update(n).eq("id",r);if(l)throw l;if(_(x=>x.map(S=>S.id===r?{...S,...t}:S)),t.status==="approved"&&a){const x=W.get(o.productId);if(x){const S=(i=o.reason)==null?void 0:i.startsWith("Écart de stock signalé"),A=S?o.quantity:x.currentStock-o.quantity,k=Math.abs(A-x.currentStock);await X(x.id,{currentStock:A},!0),await F({productId:x.id,productReference:x.reference,productDesignation:x.designation,movementType:S?"adjustment":"exit",quantity:k,previousStock:x.currentStock,newStock:A,userId:a.id,userName:a.name,reason:S?o.reason||"Ajustement suite à écart de stock":`Sortie de stock - ${o.reason||"Demande approuvée"}`,notes:o.notes}),ne({productReference:x.reference,productDesignation:x.designation,storageZone:x.storageZone,shelf:x.shelf,position:x.position,quantity:o.quantity,requestedBy:o.requestedBy})}}},[L,W,a,X]),Ee=s.useCallback(async r=>{const{error:t}=await m.from("exit_requests").delete().eq("id",r);if(!t)_(o=>o.filter(n=>n.id!==r));else throw t},[]),Je=s.useCallback(async()=>{const{data:r,error:t}=await m.from("stock_movements").select("*").order("timestamp",{ascending:!1}).limit(500);!t&&r&&P(r.map(o=>({id:o.id,productId:o.product_id,productReference:o.product_reference,productDesignation:o.product_designation,movementType:o.movement_type,quantity:o.quantity,previousStock:o.previous_stock,newStock:o.new_stock,userId:o.user_id,userName:o.user_name,reason:o.reason,notes:o.notes||void 0,timestamp:new Date(o.timestamp)})))},[]),F=s.useCallback(async r=>{const{data:t,error:o}=await m.from("stock_movements").insert([{product_id:r.productId,product_reference:r.productReference,product_designation:r.productDesignation,movement_type:r.movementType,quantity:r.quantity,previous_stock:r.previousStock,new_stock:r.newStock,user_id:r.userId,user_name:r.userName,reason:r.reason,notes:r.notes}]).select().single();if(!o&&t){const n={id:t.id,productId:t.product_id,productReference:t.product_reference,productDesignation:t.product_designation,movementType:t.movement_type,quantity:t.quantity,previousStock:t.previous_stock,newStock:t.new_stock,userId:t.user_id,userName:t.user_name,reason:t.reason,notes:t.notes,timestamp:new Date(t.timestamp)};P(l=>[n,...l.slice(0,499)])}},[]),Ye=s.useCallback(async()=>{const{data:r,error:t}=await m.from("orders").select("*").order("ordered_at",{ascending:!1}).limit(200);!t&&r&&M(r.map(o=>({id:o.id,product_id:o.product_id,product_reference:o.product_reference,product_designation:o.product_designation,quantity:o.quantity,ordered_by:o.ordered_by,ordered_by_name:o.ordered_by_name,ordered_at:new Date(o.ordered_at),received_at:o.received_at?new Date(o.received_at):void 0,status:o.status,notes:o.notes||void 0,created_at:new Date(o.created_at),updated_at:new Date(o.updated_at)})))},[]),Ae=s.useCallback(async r=>{if(!a)throw new Error("Utilisateur non connecté");const{data:t,error:o}=await m.from("orders").insert([{product_id:r.product_id,product_reference:r.product_reference,product_designation:r.product_designation,quantity:r.quantity,ordered_by:a.id,ordered_by_name:a.name,status:"pending",notes:r.notes}]).select().single();if(o)throw o;if(t){const n={id:t.id,product_id:t.product_id,product_reference:t.product_reference,product_designation:t.product_designation,quantity:t.quantity,ordered_by:t.ordered_by,ordered_by_name:t.ordered_by_name,ordered_at:new Date(t.ordered_at),status:t.status,notes:t.notes,created_at:new Date(t.created_at),updated_at:new Date(t.updated_at)};M(l=>[n,...l])}},[a]),Me=s.useCallback(async(r,t)=>{const o={};t.status!==void 0&&(o.status=t.status),t.received_at!==void 0&&(o.received_at=t.received_at),t.notes!==void 0&&(o.notes=t.notes);const{error:n}=await m.from("orders").update(o).eq("id",r);if(n)throw n;M(l=>l.map(i=>i.id===r?{...i,...t,updated_at:new Date}:i))},[]),qe=s.useCallback(()=>N.filter(r=>r.status==="pending"),[N]),Le=s.useCallback(()=>{const r=N.filter(o=>o.status==="received"&&o.received_at);if(r.length===0)return 0;const t=r.reduce((o,n)=>{const l=new Date(n.ordered_at).getTime(),x=(new Date(n.received_at).getTime()-l)/(1e3*60*60*24);return o+x},0);return Math.round(t/r.length*10)/10},[N]),Re=s.useCallback(()=>{const r=[];return y.forEach(t=>{if(t.currentStock<=t.minStock){const o=t.maxStock>0?t.currentStock/t.maxStock*100:0;r.push({product:t,alertType:t.currentStock===0?"critical":"low",percentage:Math.round(o)})}}),r.sort((t,o)=>t.percentage-o.percentage)},[y]),Ke=s.useCallback(async()=>{if(a)try{const{data:r,error:t}=await m.from("pending_exits").select("*").eq("user_id",a.id).order("added_at",{ascending:!0});if(t)throw t;const o=(r||[]).map(n=>({id:n.id,productReference:n.product_reference,productDesignation:n.product_designation,storageZone:n.storage_zone,shelf:n.shelf,position:n.position,quantity:n.quantity,requestedBy:n.requested_by,addedAt:new Date(n.added_at)}));R(o)}catch(r){console.error("Erreur lors du chargement des sorties en attente:",r),R([])}},[a]),De=s.useCallback(()=>U,[U]),ne=s.useCallback(async r=>{if(!a){console.error("Utilisateur non connecté");return}try{const{data:t,error:o}=await m.from("pending_exits").insert({user_id:a.id,product_reference:r.productReference,product_designation:r.productDesignation,storage_zone:r.storageZone,shelf:r.shelf,position:r.position,quantity:r.quantity,requested_by:r.requestedBy}).select().single();if(o)throw o;const n={id:t.id,productReference:t.product_reference,productDesignation:t.product_designation,storageZone:t.storage_zone,shelf:t.shelf,position:t.position,quantity:t.quantity,requestedBy:t.requested_by,addedAt:new Date(t.added_at)};R(l=>[...l,n])}catch(t){throw console.error("Erreur lors de l'ajout de la sortie en attente:",t),t}},[a]),Te=s.useCallback(async r=>{try{const{error:t}=await m.from("pending_exits").delete().eq("id",r);if(t)throw t;R(o=>o.filter(n=>n.id!==r))}catch(t){throw console.error("Erreur lors de la suppression de la sortie en attente:",t),t}},[]),ze=s.useCallback(async()=>{if(a)try{const{error:r}=await m.from("pending_exits").delete().eq("user_id",a.id);if(r)throw r;R([])}catch(r){throw console.error("Erreur lors de la suppression des sorties en attente:",r),r}},[a]),Q=s.useCallback(async(r,t)=>{try{const{data:o}=await m.from("user_profiles").select("*").eq("username",r).single();if(!o)return!1;const n=`${r}@gestionstocks.app`,{data:l,error:i}=await m.auth.signInWithPassword({email:n,password:t});if(i||!l.user)return!1;d({id:o.id,username:o.username,password:"",role:o.role,name:o.name,badgeNumber:o.badge_number||void 0,alertEmail:o.alert_email||void 0,enableStockAlerts:o.enable_stock_alerts??!0,enableConsumptionAlerts:o.enable_consumption_alerts??!0}),await V();try{const{data:x,error:S}=await m.from("pending_exits").select("*").eq("user_id",o.id).order("added_at",{ascending:!0});if(S)throw S;const A=(x||[]).map(k=>({id:k.id,productReference:k.product_reference,productDesignation:k.product_designation,storageZone:k.storage_zone,shelf:k.shelf,position:k.position,quantity:k.quantity,requestedBy:k.requested_by,addedAt:new Date(k.added_at)}));R(A)}catch(x){console.error("Erreur lors du chargement des sorties en attente:",x),R([])}return!0}catch(o){return console.error("Erreur de connexion:",o),!1}},[V]),Be=s.useCallback(async r=>{try{const{data:t}=await m.from("user_profiles").select("*").eq("badge_number",r).single();if(!t)return!1;d({id:t.id,username:t.username,password:"",role:t.role,name:t.name,badgeNumber:t.badge_number||void 0,alertEmail:t.alert_email||void 0,enableStockAlerts:t.enable_stock_alerts??!0,enableConsumptionAlerts:t.enable_consumption_alerts??!0}),await V();try{const{data:o,error:n}=await m.from("pending_exits").select("*").eq("user_id",t.id).order("added_at",{ascending:!0});if(n)throw n;const l=(o||[]).map(i=>({id:i.id,productReference:i.product_reference,productDesignation:i.product_designation,storageZone:i.storage_zone,shelf:i.shelf,position:i.position,quantity:i.quantity,requestedBy:i.requested_by,addedAt:new Date(i.added_at)}));R(l)}catch(o){console.error("Erreur lors du chargement des sorties en attente:",o),R([])}return!0}catch(t){return console.error("Erreur de connexion par badge:",t),!1}},[V]),Pe=s.useCallback(async(r,t,o)=>{try{const{data:n}=await m.from("user_profiles").select("username").eq("username",r).maybeSingle();if(n)return console.error("Cet identifiant existe déjà"),!1;const l=`${r}@gestionstocks.app`,{data:i,error:x}=await m.auth.signUp({email:l,password:o,options:{emailRedirectTo:void 0,data:{username:r,name:t}}});if(x||!i.user)return console.error("Erreur lors de la création du compte:",x),!1;await new Promise(A=>setTimeout(A,500));const{error:S}=await m.from("user_profiles").insert([{id:i.user.id,username:r,name:t,role:"user"}]);return S?(console.error("Erreur lors de la création du profil:",S),!1):(i.session?(d({id:i.user.id,username:r,password:"",role:"user",name:t,alertEmail:void 0,enableStockAlerts:!0,enableConsumptionAlerts:!0}),await V()):await Q(r,o),!0)}catch(n){return console.error("Erreur lors de l'inscription:",n),!1}},[V,Q]),Ie=s.useCallback(async()=>{await m.auth.signOut(),d(null),g([]),_([]),P([]),M([]),R([])},[]),Xe=s.useMemo(()=>({currentUser:a,loading:p,login:Q,loginWithBadge:Be,register:Pe,logout:Ie,users:h,updateUserRole:le,createUser:ce,updateUserBadge:de,updateUserProfile:ue,deleteUser:me,products:y,addProduct:_e,updateProduct:X,deleteProduct:ke,getProductById:je,getAllProductReferences:we,reloadProducts:oe,categories:w,addCategory:pe,updateCategory:ge,deleteCategory:he,units:E,addUnit:fe,deleteUnit:xe,storageZones:b,addStorageZone:be,updateStorageZone:ye,deleteStorageZone:ve,exitRequests:L,addExitRequest:Se,updateExitRequest:Ce,deleteExitRequest:Ee,getStockAlerts:Re,stockMovements:f,addStockMovement:F,orders:N,addOrder:Ae,updateOrder:Me,getPendingOrders:qe,getAverageDeliveryTime:Le,pendingExits:U,getPendingExits:De,addPendingExit:ne,removePendingExit:Te,clearPendingExits:ze}),[a,p,Q,Be,Pe,Ie,h,le,ce,de,ue,me,y,_e,X,ke,je,we,oe,w,pe,ge,he,E,fe,xe,b,be,ye,ve,L,Se,Ce,Ee,Re,f,F,N,Ae,Me,qe,Le,U,De,ne,Te,ze]);return p?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"var(--bg-color)",color:"var(--text-color)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"⏳"}),e.jsx("div",{children:"Chargement..."})]})}):e.jsx(Ue.Provider,{value:Xe,children:c})},Ve=s.createContext(void 0),Gt=()=>{const c=s.useContext(Ve);if(!c)throw new Error("useNotifications must be used within NotificationProvider");return c},xt=({children:c})=>{const[a,d]=s.useState([]),p=v=>{const y=Date.now().toString()+Math.random().toString(),g={...v,id:y,duration:v.duration||5e3};d(w=>[...w,g]),g.duration&&g.duration>0&&setTimeout(()=>{u(y)},g.duration)},u=v=>{d(y=>y.filter(g=>g.id!==v))},h={notifications:a,addNotification:p,removeNotification:u};return e.jsxs(Ve.Provider,{value:h,children:[c,e.jsx(bt,{notifications:a,removeNotification:u})]})},bt=({notifications:c,removeNotification:a})=>{if(c.length===0)return null;const d=p=>{switch(p){case"success":return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),e.jsx("path",{d:"M22 4L12 14.01l-3-3"})]});case"error":return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]});case"warning":return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),e.jsx("path",{d:"M12 9v4M12 17h.01"})]});case"info":default:return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4M12 8h.01"})]})}};return e.jsx("div",{className:"notification-container",children:c.map(p=>e.jsxs("div",{className:`notification ${p.type}`,children:[e.jsx("div",{className:`notification-icon ${p.type}`,children:d(p.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsx("div",{className:"notification-title",children:p.title}),e.jsx("p",{className:"notification-message",children:p.message})]}),e.jsx("button",{className:"notification-close",onClick:()=>a(p.id),children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},p.id))})};function yt(c){const a=[];return c.forEach(d=>{if(!d.deletedAt&&d.currentStock<=d.minStock){const p=d.minStock>0?d.currentStock/d.minStock*100:0;a.push({type:"low_stock",productId:d.id,productReference:d.reference,productDesignation:d.designation,currentStock:d.currentStock,minStock:d.minStock,percentage:p,severity:p<=50?"critical":"warning"})}}),a}function vt(c,a){const d=[],p=new Date,u=new Date(p.getTime()-3*24*60*60*1e3),h=new Date(p.getTime()-30*24*60*60*1e3);return c.forEach(v=>{if(v.deletedAt)return;const y=a.filter(_=>_.productId===v.id&&_.movementType==="exit");if(y.length<5)return;const g=y.filter(_=>new Date(_.timestamp)>=u),w=y.filter(_=>new Date(_.timestamp)>=h&&new Date(_.timestamp)<u);if(w.length===0)return;const C=Math.max(1,(u.getTime()-h.getTime())/(24*60*60*1e3)),j=w.reduce((_,f)=>_+f.quantity,0)/C,b=Math.max(1,(p.getTime()-u.getTime())/(24*60*60*1e3)),L=g.reduce((_,f)=>_+f.quantity,0)/b;if(j>0){const _=(L-j)/j*100;_>50&&L>0&&d.push({type:"unusual_consumption",productId:v.id,productReference:v.reference,productDesignation:v.designation,averageDaily:j,recentDaily:L,percentageIncrease:_})}}),d}async function _t(){const{data:c,error:a}=await m.from("user_profiles").select("id, username, name, role, badge_number, alert_email, enable_stock_alerts, enable_consumption_alerts").not("alert_email","is",null).neq("alert_email","");return a||!c?(console.error("Erreur lors de la récupération des utilisateurs avec alertes:",a),[]):c.map(d=>({id:d.id,username:d.username,password:"",role:d.role,name:d.name,badgeNumber:d.badge_number||void 0,alertEmail:d.alert_email||void 0,enableStockAlerts:d.enable_stock_alerts??!0,enableConsumptionAlerts:d.enable_consumption_alerts??!0}))}async function kt(c,a,d){if(!c.alertEmail)return;const p=c.enableStockAlerts&&a.length>0,u=c.enableConsumptionAlerts&&d.length>0;if(!(!p&&!u))try{const{error:h}=await m.functions.invoke("send-alert-email",{body:{to:c.alertEmail,userName:c.name,stockAlerts:c.enableStockAlerts?a:[],consumptionAlerts:c.enableConsumptionAlerts?d:[]}});h?console.error("Erreur lors de l'envoi de l'email d'alerte:",h):console.log(`Email d'alerte envoyé à ${c.alertEmail}`)}catch(h){console.error("Erreur lors de l'invocation de la fonction d'envoi d'email:",h)}}async function jt(c,a){console.log("Vérification des alertes...");const d=yt(c),p=vt(c,a);if(console.log(`Détecté: ${d.length} alertes de stock, ${p.length} alertes de consommation`),d.length===0&&p.length===0){console.log("Aucune alerte à envoyer");return}const u=await _t();if(u.length===0){console.log("Aucun utilisateur avec alertes activées");return}for(const h of u)await kt(h,d,p);console.log(`Alertes envoyées à ${u.length} utilisateur(s)`)}function wt(c={}){const{currentUser:a,products:d,stockMovements:p}=$(),{enabled:u=(a==null?void 0:a.role)==="manager",intervalMinutes:h=60}=c,v=s.useRef(null),y=s.useRef(null),g=s.useCallback(async()=>{if(!u||!a||a.role!=="manager")return;const C=new Date;console.log(`[AlertMonitor] Vérification des alertes à ${C.toLocaleTimeString()}`);try{await jt(d,p),v.current=C}catch(E){console.error("[AlertMonitor] Erreur lors de la vérification des alertes:",E)}},[u,a,d,p]);s.useEffect(()=>{if(!u){y.current&&(clearInterval(y.current),y.current=null);return}const C=setTimeout(()=>{g()},3e4);return y.current=setInterval(()=>{g()},h*60*1e3),()=>{clearTimeout(C),y.current&&(clearInterval(y.current),y.current=null)}},[u,h,g]);const w=s.useCallback(()=>{g()},[g]);return{lastCheck:v.current,forceCheck:w}}const St=()=>(wt({enabled:!0,intervalMinutes:60}),null),Ct=()=>{const[c,a]=s.useState(""),[d,p]=s.useState(""),[u,h]=s.useState(!1),[v,y]=s.useState(""),[g,w]=s.useState(!1),{login:C}=$(),E=te(),j=async b=>{if(b.preventDefault(),y(""),w(!0),!c||!d){y("Veuillez remplir tous les champs"),w(!1);return}await C(c,d)||y("Identifiants incorrects"),w(!1)};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:e.jsxs("div",{style:{background:"var(--card-bg)",padding:"2.5rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"420px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1.5rem"},children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),e.jsx("h2",{style:{textAlign:"center",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Connexion"}),e.jsx("p",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"0.95rem"},children:"Gestion des Stocks"}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Nom d'utilisateur"}),e.jsx("input",{type:"text",value:c,onChange:b=>a(b.target.value),placeholder:"Entrez votre nom d'utilisateur",disabled:g,style:{width:"100%",padding:"0.875rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:b=>b.target.style.borderColor="var(--border-color)",onBlur:b=>b.target.style.borderColor="var(--border-color)"})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:u?"text":"password",value:d,onChange:b=>p(b.target.value),placeholder:"Entrez votre mot de passe",disabled:g,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:b=>b.target.style.borderColor="var(--border-color)",onBlur:b=>b.target.style.borderColor="var(--border-color)"}),e.jsx("button",{type:"button",onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1),onTouchStart:()=>h(!0),onTouchEnd:()=>h(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":u?"Masquer le mot de passe":"Afficher le mot de passe",children:u?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),v&&e.jsx("div",{style:{padding:"0.875rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.9rem"},children:v}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"submit",disabled:g,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.7:1},onMouseEnter:b=>{g||(b.currentTarget.style.background="rgba(128, 128, 128, 0.2)",b.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:b=>{b.currentTarget.style.background="transparent",b.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:g?"Connexion...":"Se connecter"}),e.jsx("button",{type:"button",onClick:()=>E("/register"),disabled:g,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.7:1},onMouseEnter:b=>{g||(b.currentTarget.style.background="rgba(128, 128, 128, 0.2)",b.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:b=>{b.currentTarget.style.background="transparent",b.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:"S'inscrire"})]})]}),e.jsx("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"1.5rem",marginTop:"1.5rem",textAlign:"center"},children:e.jsxs("button",{type:"button",onClick:()=>E("/badge-login"),disabled:g,style:{padding:"0.875rem 1.5rem",background:"transparent",color:"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",fontSize:"0.9rem",cursor:g?"not-allowed":"pointer",transition:"all 0.2s",opacity:g?.5:1,display:"inline-flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:b=>{g||(b.currentTarget.style.background="rgba(128, 128, 128, 0.1)")},onMouseLeave:b=>{b.currentTarget.style.background="transparent"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),"Connexion par badge"]})})]})})},Et=()=>{const[c,a]=s.useState(""),[d,p]=s.useState(""),[u,h]=s.useState(!1),[v,y]=s.useState(!1),{loginWithBadge:g}=$(),w=te(),C=s.useRef(null),E=4,j=20,b=300;s.useEffect(()=>{var _;(_=C.current)==null||_.focus()},[]),s.useEffect(()=>{if(c.length>=E&&c.length<=j){const _=setTimeout(()=>{T()},b);return()=>clearTimeout(_)}},[c]);const T=async()=>{var _,f;if(!(!c.trim()||u)){p(""),h(!0),y(!0);try{await g(c.trim())||(p("Badge non reconnu"),a(""),(_=C.current)==null||_.focus())}catch{p("Erreur lors de la connexion"),a(""),(f=C.current)==null||f.focus()}finally{h(!1),setTimeout(()=>y(!1),500)}}},L=_=>{const f=_.target.value;/^[a-zA-Z0-9]*$/.test(f)&&(a(f),p(""))};return e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:[e.jsxs("div",{style:{background:"var(--card-bg)",padding:"3rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"500px",border:"1px solid var(--border-color)",textAlign:"center"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"2rem",animation:v?"pulse 1s infinite":"none"},children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:v?"#10b981":"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),e.jsx("line",{x1:"7",y1:"8",x2:"17",y2:"8"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"}),e.jsx("line",{x1:"7",y1:"16",x2:"13",y2:"16"})]})}),e.jsx("h2",{style:{marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Scanner votre badge"}),e.jsx("p",{style:{marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"1rem"},children:"Utilisez le lecteur code-barre ou saisissez manuellement"}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx("input",{ref:C,type:"text",value:c,onChange:L,placeholder:"Numéro de badge",disabled:u,autoComplete:"off",style:{width:"100%",padding:"1.25rem",background:"var(--input-bg)",border:`2px solid ${d?"#ef4444":v?"#10b981":"var(--border-color)"}`,borderRadius:"8px",color:"var(--text-color)",fontSize:"1.5rem",textAlign:"center",fontFamily:"monospace",fontWeight:"600",letterSpacing:"0.2rem",transition:"all 0.3s",outline:"none"}})}),v&&e.jsx("div",{style:{padding:"1rem",background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"8px",color:"#10b981",marginBottom:"1.5rem",fontSize:"0.95rem",fontWeight:"500"},children:"✓ Badge détecté, connexion en cours..."}),d&&e.jsxs("div",{style:{padding:"1rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.95rem",fontWeight:"500"},children:["✕ ",d]}),e.jsx("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"1.5rem",marginTop:"1.5rem"},children:e.jsx("button",{type:"button",onClick:()=>w("/login"),disabled:u,style:{padding:"0.875rem 1.5rem",background:"transparent",color:"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",fontSize:"0.9rem",cursor:u?"not-allowed":"pointer",transition:"all 0.2s",opacity:u?.5:1},onMouseEnter:_=>{u||(_.currentTarget.style.background="rgba(128, 128, 128, 0.1)")},onMouseLeave:_=>{_.currentTarget.style.background="transparent"},children:"Connexion classique"})})]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
            opacity: 1;
          }
          50% {
            transform: scale(1.05);
            opacity: 0.8;
          }
        }
      `})]})},At=()=>{const[c,a]=s.useState(""),[d,p]=s.useState(""),[u,h]=s.useState(""),[v,y]=s.useState(!1),[g,w]=s.useState(!1),[C,E]=s.useState(""),[j,b]=s.useState(!1),{register:T}=$(),L=te(),_=async f=>{if(f.preventDefault(),E(""),!c||!d||!u){E("Tous les champs sont obligatoires");return}if(c.length<3){E("L'identifiant doit contenir au moins 3 caractères");return}if(d.length<6){E("Le mot de passe doit contenir au moins 6 caractères");return}if(d!==u){E("Les mots de passe ne correspondent pas");return}b(!0);try{console.log("Tentative d'inscription avec:",{username:c});const P=await T(c,c,d);console.log("Résultat inscription:",P),P?L("/catalog"):E("Échec de l'inscription. Vérifiez la console pour plus de détails.")}catch(P){console.error("Erreur d'inscription:",P),E("Une erreur est survenue lors de l'inscription. Vérifiez la console pour plus de détails.")}finally{b(!1)}};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-color)",padding:"1rem"},children:e.jsxs("div",{style:{background:"var(--card-bg)",padding:"2.5rem",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"100%",maxWidth:"420px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1.5rem"},children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),e.jsx("h2",{style:{textAlign:"center",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"2rem",fontWeight:"700"},children:"Créer un compte"}),e.jsx("p",{style:{textAlign:"center",marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"0.95rem"},children:"Gestion des Stocks"}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Identifiant"}),e.jsx("input",{type:"text",value:c,onChange:f=>a(f.target.value),placeholder:"Entrez votre identifiant",disabled:j,style:{width:"100%",padding:"0.875rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:v?"text":"password",value:d,onChange:f=>p(f.target.value),placeholder:"Entrez votre mot de passe",disabled:j,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"}),e.jsx("button",{type:"button",onMouseDown:()=>y(!0),onMouseUp:()=>y(!1),onMouseLeave:()=>y(!1),onTouchStart:()=>y(!0),onTouchEnd:()=>y(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":v?"Masquer le mot de passe":"Afficher le mot de passe",children:v?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"500"},children:"Confirmer le mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:g?"text":"password",value:u,onChange:f=>h(f.target.value),placeholder:"Confirmez votre mot de passe",disabled:j,style:{width:"100%",padding:"0.875rem",paddingRight:"2.5rem",background:"var(--input-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",transition:"all 0.2s",outline:"none"},onFocus:f=>f.target.style.borderColor="var(--border-color)",onBlur:f=>f.target.style.borderColor="var(--border-color)"}),e.jsx("button",{type:"button",onMouseDown:()=>w(!0),onMouseUp:()=>w(!1),onMouseLeave:()=>w(!1),onTouchStart:()=>w(!0),onTouchEnd:()=>w(!1),style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"1.2rem"},"aria-label":g?"Masquer le mot de passe":"Afficher le mot de passe",children:g?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})]})]}),C&&e.jsx("div",{style:{padding:"0.875rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#ef4444",marginBottom:"1.5rem",fontSize:"0.9rem"},children:C}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>L("/"),disabled:j,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:j?"not-allowed":"pointer",transition:"all 0.2s",opacity:j?.7:1},onMouseEnter:f=>{j||(f.currentTarget.style.background="rgba(128, 128, 128, 0.2)",f.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:f=>{f.currentTarget.style.background="transparent",f.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:"Se connecter"}),e.jsx("button",{type:"submit",disabled:j,style:{flex:1,padding:"1rem",background:"transparent",color:"var(--text-color)",border:"1px solid rgba(128, 128, 128, 0.4)",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:j?"not-allowed":"pointer",transition:"all 0.2s",opacity:j?.7:1},onMouseEnter:f=>{j||(f.currentTarget.style.background="rgba(128, 128, 128, 0.2)",f.currentTarget.style.borderColor="var(--accent-color)")},onMouseLeave:f=>{f.currentTarget.style.background="transparent",f.currentTarget.style.borderColor="rgba(128, 128, 128, 0.4)"},children:j?"Création...":"S'inscrire"})]})]})]})})},Mt=()=>{const{currentUser:c,logout:a,exitRequests:d,getPendingExits:p,getPendingOrders:u}=$(),h=te(),v=rt(),[y,g]=ae.useState(!1),w=()=>{a(),h("/")},C=()=>{g(!y)},E=()=>{g(!1)},j=(c==null?void 0:c.role)==="manager",b=ae.useMemo(()=>{const M=d.filter(R=>R.status==="pending"),U=new Set;return M.forEach(R=>{const W=`${R.requestedBy}-${new Date(R.requestedAt).toISOString().slice(0,16)}`;U.add(W)}),U.size},[d]),T=p().length,L=u().length,_=M=>v.pathname===M,N=j?[{path:"/dashboard",label:"Tableau de bord",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})},{path:"/products",label:"Produits",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})},{path:"/add-product",label:"Ajouter Produit",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})},{path:"/orders",label:"Réception",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),e.jsx("path",{d:"M9 12h6"}),e.jsx("path",{d:"M9 16h6"})]})},{path:"/requests",label:"Vérifications",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})},{path:"/inventory",label:"Inventaire",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("path",{d:"M9 15h6"}),e.jsx("path",{d:"M12 12v6"})]})},{path:"/statistics",label:"Statistiques",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})},{path:"/history",label:"Historique",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})},{path:"/user-management",label:"Gestion Utilisateurs",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},{path:"/label-generator",label:"Étiquettes",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),e.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]})},{path:"/settings",label:"Paramètres",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6m5.196-13.804l-4.242 4.242m-5.908 5.908l-4.242 4.242M23 12h-6m-6 0H1m18.196 5.196l-4.242-4.242m-5.908-5.908L4.804 2.804"})]})}]:[{path:"/catalog",label:"Catalogue",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]})},{path:"/my-statistics",label:"Mes Statistiques",icon:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})}];return e.jsxs("div",{className:"layout-container",children:[e.jsx("button",{className:"mobile-menu-button",onClick:C,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),y&&e.jsx("div",{className:"mobile-menu-overlay",onClick:E}),e.jsxs("aside",{className:`sidebar ${y?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("div",{className:"sidebar-logo",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"})})}),e.jsxs("div",{className:"sidebar-title-container",children:[e.jsx("h1",{className:"sidebar-title",children:"StockPro"}),e.jsx("p",{className:"sidebar-subtitle",children:"Ajust'82"})]})]}),e.jsx("nav",{className:"sidebar-nav",children:N.map(M=>e.jsxs(ot,{to:M.path,className:`sidebar-link ${_(M.path)?"active":""}`,title:M.label,onClick:E,children:[e.jsx("span",{className:"sidebar-link-icon",children:M.icon}),e.jsx("span",{className:"sidebar-link-label",children:M.label}),M.path==="/requests"&&b>0&&e.jsx("span",{className:"sidebar-badge",children:b}),M.path==="/orders"&&L>0&&e.jsx("span",{className:"sidebar-badge",children:L}),M.path==="/exit-sheet"&&T>0&&e.jsx("span",{className:"sidebar-badge",children:T})]},M.path))}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsxs("div",{className:"sidebar-user",children:[e.jsx("div",{className:"user-avatar",children:c==null?void 0:c.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:c==null?void 0:c.name}),e.jsx("div",{className:"user-role",children:j?"Gestionnaire":"Utilisateur"})]})]}),e.jsx("div",{className:"footer-actions",children:e.jsx("button",{onClick:w,className:"btn-logout",title:"Déconnexion",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})})]})]}),e.jsx("main",{className:"main-content",children:e.jsx(nt,{})})]})},qt=s.lazy(()=>z(()=>import("./Dashboard-CCp3KGXW.js"),__vite__mapDeps([0,1,2]))),Lt=s.lazy(()=>z(()=>import("./AddProduct-Cqj6ERS1.js"),__vite__mapDeps([3,1,2]))),Rt=s.lazy(()=>z(()=>import("./Products-DLYsDtSB.js"),__vite__mapDeps([4,1,5,2,6,7]))),Dt=s.lazy(()=>z(()=>import("./Settings-OiWBiNMe.js"),__vite__mapDeps([8,1,2]))),Tt=s.lazy(()=>z(()=>import("./Requests-myLtbAFX.js"),__vite__mapDeps([9,1,2]))),zt=s.lazy(()=>z(()=>import("./Orders-CbVhhH73.js"),__vite__mapDeps([10,1,2]))),Bt=s.lazy(()=>z(()=>import("./Statistics-Dw4qGC30.js"),__vite__mapDeps([11,1,2]))),Pt=s.lazy(()=>z(()=>import("./UserCatalog-DTYwWK2O.js"),__vite__mapDeps([12,1,2,13]))),It=s.lazy(()=>z(()=>import("./UserStatistics-D7MUZwCq.js"),__vite__mapDeps([14,1,2]))),Nt=s.lazy(()=>z(()=>import("./History-BjuQmF08.js"),__vite__mapDeps([15,1,5,2,6]))),Wt=s.lazy(()=>z(()=>import("./Inventory-iTictVNs.js"),__vite__mapDeps([16,1,2,17]))),Ot=s.lazy(()=>z(()=>import("./UserManagement-CaatopVq.js"),__vite__mapDeps([18,1,2,19]))),Ut=s.lazy(()=>z(()=>import("./LabelGenerator-BmQLENOJ.js"),__vite__mapDeps([20,1,7,5,2,21]))),Vt=()=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]}),e.jsx("p",{style:{fontSize:"1.1rem",color:"var(--text-secondary)",fontWeight:"500"},children:"Chargement..."})]}),D=({children:c,allowedRole:a})=>{const{currentUser:d}=$();return d?a&&d.role!==a?e.jsx(H,{to:d.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(e.Fragment,{children:c}):e.jsx(H,{to:"/",replace:!0})},Zt=()=>{const{currentUser:c}=$();return e.jsxs(e.Fragment,{children:[c&&e.jsx(St,{}),e.jsxs(at,{children:[e.jsx(q,{path:"/",element:c?e.jsx(H,{to:c.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(Ct,{})}),e.jsx(q,{path:"/register",element:c?e.jsx(H,{to:c.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(At,{})}),e.jsx(q,{path:"/badge-login",element:c?e.jsx(H,{to:c.role==="manager"?"/dashboard":"/catalog",replace:!0}):e.jsx(Et,{})}),e.jsxs(q,{element:e.jsx(D,{children:e.jsx(s.Suspense,{fallback:e.jsx(Vt,{}),children:e.jsx(Mt,{})})}),children:[e.jsx(q,{path:"/dashboard",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(qt,{})})}),e.jsx(q,{path:"/products",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Rt,{})})}),e.jsx(q,{path:"/add-product",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Lt,{})})}),e.jsx(q,{path:"/settings",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Dt,{})})}),e.jsx(q,{path:"/requests",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Tt,{})})}),e.jsx(q,{path:"/orders",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(zt,{})})}),e.jsx(q,{path:"/history",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Nt,{})})}),e.jsx(q,{path:"/statistics",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Bt,{})})}),e.jsx(q,{path:"/inventory",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Wt,{})})}),e.jsx(q,{path:"/user-management",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Ot,{})})}),e.jsx(q,{path:"/label-generator",element:e.jsx(D,{allowedRole:"manager",children:e.jsx(Ut,{})})}),e.jsx(q,{path:"/catalog",element:e.jsx(D,{allowedRole:"user",children:e.jsx(Pt,{})})}),e.jsx(q,{path:"/my-statistics",element:e.jsx(D,{allowedRole:"user",children:e.jsx(It,{})})})]}),e.jsx(q,{path:"*",element:e.jsx(H,{to:"/",replace:!0})})]})]})},$t=()=>e.jsx(st,{basename:"/GestionDesStocks",children:e.jsx(ft,{children:e.jsx(xt,{children:e.jsx(Zt,{})})})});ie.createRoot(document.getElementById("root")).render(e.jsx(ae.StrictMode,{children:e.jsx($t,{})}));export{Gt as a,jt as c,e as j,$ as u};
