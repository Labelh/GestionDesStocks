import{u as _,a as K,j as e}from"./index-D5p1RnQU.js";import{u as se,r as i}from"./react-vendor-D8CQoBvY.js";import{P as ne}from"./PackagingIcon-wRFS1AAW.js";import"./supabase-BffQhpPo.js";const ie=({cartItems:y,onComplete:M,onCancel:D})=>{var $;const L=se(),{currentUser:v,updateProduct:j,addStockMovement:H,getProductById:q,logout:O,addExitRequest:V}=_(),{addNotification:b}=K(),[o,R]=i.useState(0),[a,k]=i.useState((($=y[0])==null?void 0:$.quantity)||1),[g,S]=i.useState(!1),[W,E]=i.useState(!1),[P,A]=i.useState("left"),[B,p]=i.useState(!1),[x,I]=i.useState(0),[w,Q]=i.useState([]),h=y[o],C=y.length,f=o===C-1,l=h?q(h.productId):null,s=l?l.currentStock:0,U=()=>{if(!h)return"Non spÃ©cifiÃ©";const u=h.storageZone||"",d=h.shelf||"",N=h.position||"";return`${u}.${d}.${N}`},F=async()=>{if(!(!v||!l||a<=0||a>s)){S(!0);try{const u=l.currentStock-a;await j(l.id,{currentStock:u},!0),await H({productId:l.id,productReference:l.reference,productDesignation:l.designation,movementType:"exit",quantity:a,previousStock:l.currentStock,newStock:u,userId:v.id,userName:v.name,reason:"Sortie directe depuis le catalogue"}),Q(d=>[...d,l.id]),f?E(!0):(A("left"),setTimeout(()=>{var d;R(o+1),k(((d=y[o+1])==null?void 0:d.quantity)||1)},300))}catch(u){console.error("Erreur lors de la validation:",u),b({type:"error",title:"Erreur",message:"Impossible de valider la sortie",duration:5e3})}finally{S(!1)}}},z=()=>{E(!1),M()},T=async()=>{try{await O(),L("/badge-login")}catch(u){console.error("Erreur lors de la dÃ©connexion:",u),L("/badge-login")}},Z=async()=>{if(!v||!l||x<=0){b({type:"error",title:"Erreur",message:"Veuillez renseigner une quantitÃ© valide",duration:5e3});return}S(!0);try{await V({productId:l.id,productReference:l.reference,productDesignation:l.designation,productPhoto:l.photo,quantity:x,reason:`Ã‰cart de stock signalÃ© - QuantitÃ© constatÃ©e: ${x}, Stock systÃ¨me: ${s}`,notes:"Ã‰cart signalÃ© lors d'une sortie"}),b({type:"info",title:"Ã‰cart signalÃ©",message:"Une demande de vÃ©rification a Ã©tÃ© envoyÃ©e au gestionnaire",duration:5e3}),p(!1),I(0)}catch(u){console.error("Erreur lors du signalement:",u),b({type:"error",title:"Erreur",message:"Impossible de signaler l'Ã©cart",duration:5e3})}finally{S(!1)}};return i.useEffect(()=>{const u=d=>{if(!(B||g)){if(W){d.key==="Enter"&&(d.preventDefault(),T());return}switch(d.key){case"ArrowRight":d.preventDefault(),a<s&&k(N=>Math.min(s,N+1));break;case"ArrowLeft":d.preventDefault(),a>1&&k(N=>Math.max(1,N-1));break;case"Enter":d.preventDefault(),!g&&a>0&&a<=s&&F();break}}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[a,s,g,W,B]),W?e.jsx("div",{className:"exit-flow-overlay",children:e.jsxs("div",{className:"exit-flow-container completion-screen",children:[e.jsx("div",{className:"completion-icon",children:e.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 24 24",fill:"none",stroke:"#10b981",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.2",fill:"#10b981"}),e.jsx("path",{d:"M7 13l3 3 7-7",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("h1",{className:"completion-title",children:"Sortie terminÃ©e !"}),e.jsxs("p",{className:"completion-message",children:[C," article",C>1?"s":""," sorti",C>1?"s":""," avec succÃ¨s par ",v==null?void 0:v.name]}),e.jsxs("div",{className:"completion-actions",children:[e.jsxs("button",{onClick:z,className:"btn-completion btn-new-exit",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 8v8m-4-4h8"})]}),"Nouvelle sortie"]}),e.jsxs("button",{onClick:T,className:"btn-completion btn-logout",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),"Se dÃ©connecter"]})]})]})}):h?e.jsxs("div",{className:"exit-flow-overlay",children:[e.jsxs("div",{className:`exit-flow-container ${P==="left"?"slide-left":"slide-right"}`,children:[e.jsxs("div",{className:"exit-flow-header",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("span",{className:"progress-text",children:["Article ",o+1," sur ",C]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:y.map((u,d)=>e.jsx("div",{style:{flex:1,height:"8px",borderRadius:"4px",background:d<o+1?"var(--success-color)":"transparent",border:`2px solid ${d<o+1?"var(--success-color)":"var(--border-color)"}`,transition:"all 0.3s ease"}},d))})]}),e.jsx("button",{onClick:()=>D(w),className:"btn-close",title:"Annuler",children:"âœ•"})]}),e.jsx("h1",{style:{fontSize:"1.25rem",fontWeight:"700",color:"var(--text-color)",marginBottom:"1rem",textAlign:"center"},children:"Sortie d'article"}),e.jsxs("div",{className:"product-card-large",children:[e.jsx("div",{className:"product-image-large",children:h.photo?e.jsx("img",{src:h.photo,alt:h.productDesignation}):e.jsx("div",{className:"product-image-placeholder-large",children:e.jsx("svg",{width:"120",height:"120",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"})})})}),e.jsxs("div",{className:"product-info-large",children:[e.jsx("div",{style:{fontSize:"1rem",fontWeight:"600",color:"#ff5722",marginBottom:"0.5rem"},children:h.productReference}),e.jsx("h2",{className:"product-designation-large",children:h.productDesignation}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1rem"},children:[(l==null?void 0:l.packagingType)&&e.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",color:"#e5e7eb",padding:"0.9rem 1rem",borderRadius:"8px",fontSize:"0.8rem",fontWeight:"600",border:"1px solid var(--border-color)",flexShrink:0,height:"100%"},children:l.packagingType==="lot"?"lot":"unitÃ©"}),e.jsxs("div",{className:"product-location-large",style:{marginBottom:0,flex:1},children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#9ca3af",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{children:U()})]})]}),e.jsxs("div",{className:"stock-info-large",children:[e.jsx("span",{className:"stock-label",style:{color:"#9ca3af"},children:"Stock disponible:"}),e.jsx("span",{className:"stock-value-large",style:{color:"#9ca3af"},children:s})]}),e.jsx("button",{onClick:()=>p(!0),style:{background:"transparent",border:"none",color:"#6b7280",fontSize:"0.9rem",cursor:"pointer",textDecoration:"underline",marginTop:"0.5rem",padding:"0.25rem"},children:"un Ã©cart ?"})]})]}),e.jsxs("div",{style:{marginTop:"1rem",marginBottom:"1rem"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",display:"block",marginBottom:"0.5rem"},children:"QuantitÃ© Ã  sortir"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{onClick:()=>k(Math.max(1,a-1)),disabled:a<=1||g,style:{width:"32px",height:"32px",borderRadius:"6px",border:"1px solid var(--border-color)",background:"var(--input-bg)",color:"var(--text-color)",cursor:"pointer",fontSize:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center"},children:"âˆ’"}),e.jsx("input",{type:"number",value:a,onChange:u=>{const d=parseInt(u.target.value)||1;k(Math.max(1,Math.min(d,s)))},min:"1",max:s,disabled:g,style:{flex:1,height:"32px",textAlign:"center",fontSize:"1rem",fontWeight:"600",border:"1px solid var(--border-color)",borderRadius:"6px",background:"var(--input-bg)",color:"var(--text-color)"}}),e.jsx("button",{onClick:()=>k(Math.min(s,a+1)),disabled:a>=s||g,style:{width:"32px",height:"32px",borderRadius:"6px",border:"1px solid var(--border-color)",background:"var(--input-bg)",color:"var(--text-color)",cursor:"pointer",fontSize:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]}),e.jsx("button",{className:"btn-validate-large",onClick:F,disabled:g||a<=0||a>s,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Traitement en cours..."]}):f?e.jsx(e.Fragment,{children:"âœ“ Valider et terminer"}):e.jsx(e.Fragment,{children:"âœ“ Valider cet article"})})]}),B&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"1rem"},children:e.jsxs("div",{style:{background:"var(--card-bg)",borderRadius:"12px",padding:"1.5rem",maxWidth:"400px",width:"100%",border:"1px solid var(--border-color)"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--text-color)"},children:"Signaler un Ã©cart de stock"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-color)",fontSize:"0.9rem",fontWeight:"600"},children:"QuantitÃ© rÃ©ellement disponible *"}),e.jsx("input",{type:"number",value:x||"",onChange:u=>I(parseInt(u.target.value)||0),placeholder:"Ex: 10",min:"0",style:{width:"100%",padding:"0.75rem",background:"var(--input-bg)",border:"2px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",outline:"none"}}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["Stock systÃ¨me: ",s]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("button",{onClick:()=>{p(!1),I(0)},style:{flex:1,padding:"0.75rem",background:"var(--bg-secondary)",color:"var(--text-color)",border:"1px solid var(--border-color)",borderRadius:"8px",cursor:"pointer",fontSize:"0.95rem",fontWeight:"600"},children:"Annuler"}),e.jsx("button",{onClick:Z,disabled:g,style:{flex:1,padding:"0.75rem",background:"#f59e0b",color:"white",border:"none",borderRadius:"8px",cursor:g?"not-allowed":"pointer",fontSize:"0.95rem",fontWeight:"600",opacity:g?.6:1},children:g?"Envoi...":"Signaler"})]})]})})]}):null},ue=()=>{const{products:y,currentUser:M,stockMovements:D,loading:L,getPendingOrders:v,userCart:j,addToUserCart:H,removeFromUserCart:q,clearUserCart:O,reloadProducts:V}=_(),{addNotification:b}=K(),[o,R]=i.useState("all"),[a,k]=i.useState(""),[g,S]=i.useState({}),[W,E]=i.useState(!1),[P,A]=i.useState({}),[B,p]=i.useState(!1),[x,I]=i.useState(!1),[w,Q]=i.useState(20),h=i.useRef(null),C=r=>v().filter(c=>c.product_id===r).reduce((c,n)=>c+n.quantity,0),f=y,l=i.useMemo(()=>{if(!M)return[];const r=D.filter(n=>n.movementType==="exit"&&n.userId===M.id),t={};r.forEach(n=>{t[n.productId]=(t[n.productId]||0)+n.quantity});const c=Object.entries(t).sort(([,n],[,m])=>m-n).slice(0,10).map(([n])=>n);return f.filter(n=>c.includes(n.id))},[f,D,M]),s=i.useMemo(()=>{let r=f;if(o==="top-ordered"?r=l:o!=="all"&&(r=f.filter(t=>t.category===o)),a.trim()){const t=a.toLowerCase();r=r.filter(c=>c.reference.toLowerCase().includes(t)||c.designation.toLowerCase().includes(t))}return r},[f,o,l,a]),U=s.slice(0,w);i.useEffect(()=>{Q(20)},[o,a]),i.useEffect(()=>{const r=new IntersectionObserver(t=>{t[0].isIntersecting&&w<s.length&&Q(c=>Math.min(c+20,s.length))},{threshold:.1});return h.current&&r.observe(h.current),()=>{h.current&&r.unobserve(h.current)}},[w,s.length]);const F=i.useMemo(()=>["all","top-ordered",...new Set(f.map(t=>t.category))],[f]),z=r=>g[r]||1,T=(r,t)=>{const c=y.find(oe=>oe.id===r);if(!c)return;const n=c.currentStock,m=Math.max(1,Math.min(t,n));S({...g,[r]:m})},Z=r=>{T(r,z(r)+1)},$=r=>{T(r,z(r)-1)},u=r=>{const t=j.find(c=>c.productId===r);return t?t.quantity:0},d=async r=>{const t=y.find(m=>m.id===r);if(!t)return;const c=z(r),n=u(r);if(n+c>t.currentStock){alert(`Stock insuffisant ! Disponible: ${t.currentStock}, DÃ©jÃ  dans le panier: ${n}`);return}A(m=>({...m,[r]:!0}));try{await H({productId:t.id,productReference:t.reference,productDesignation:t.designation,quantity:c,photo:t.photo,storageZone:t.storageZone,shelf:t.shelf,position:t.position,unit:t.unit}),S({...g,[r]:1})}catch(m){console.error("Erreur lors de l'ajout au panier:",m),alert("Erreur lors de l'ajout au panier")}A(m=>({...m,[r]:!1}))},N=async r=>{try{await q(r)}catch(t){console.error("Erreur lors de la suppression du panier:",t),alert("Erreur lors de la suppression de l'article")}},Y=async()=>{try{await O()}catch(r){console.error("Erreur lors du vidage du panier:",r),alert("Erreur lors du vidage du panier")}},G=()=>{!M||j.length===0||E(!0)},J=()=>{E(!1),Y(),b({type:"success",title:"Sortie terminÃ©e !",message:"Tous les articles ont Ã©tÃ© sortis avec succÃ¨s",duration:5e3})},X=async r=>{if(E(!1),r.length>0)try{for(const t of r)await q(t);b({type:"info",title:"Sortie annulÃ©e",message:`${r.length} article(s) ont Ã©tÃ© sortis avant l'annulation`,duration:5e3})}catch(t){console.error("Erreur lors de la mise Ã  jour du panier:",t)}},ee=()=>j.reduce((r,t)=>r+t.quantity,0),re=r=>r.currentStock===0?"critical":"default",te=async()=>{I(!0);try{await V(!0),b({type:"success",title:"Catalogue mis Ã  jour",message:"Les produits ont Ã©tÃ© rechargÃ©s depuis la base de donnÃ©es",duration:3e3})}catch(r){console.error("Erreur lors du rafraÃ®chissement:",r),b({type:"error",title:"Erreur",message:"Erreur lors du rafraÃ®chissement des produits",duration:5e3})}finally{I(!1)}};return L?e.jsxs("div",{className:"catalog-container",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:"1.5rem"},children:[e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]}),e.jsx("p",{style:{fontSize:"1.25rem",color:"var(--text-secondary)",fontWeight:"500"},children:"Chargement du catalogue..."})]}):e.jsxs("div",{className:"catalog-container",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h1",{style:{margin:0},children:"Catalogue des Produits"}),e.jsxs("button",{onClick:te,disabled:x,style:{padding:"0.625rem 1.25rem",background:x?"var(--border-color)":"var(--accent-color)",border:"none",borderRadius:"8px",color:"white",fontSize:"0.9rem",fontWeight:"600",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.2s",opacity:x?.7:1},onMouseEnter:r=>{x||(r.currentTarget.style.transform="scale(1.02)")},onMouseLeave:r=>{r.currentTarget.style.transform="scale(1)"},children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:x?"spin 1s linear infinite":"none"},children:e.jsx("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0118.8-4.3M22 12.5a10 10 0 01-18.8 4.2"})}),x?"Actualisation...":"Actualiser"]})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("input",{type:"text",placeholder:"Rechercher par rÃ©fÃ©rence ou dÃ©signation...",value:a,onChange:r=>k(r.target.value),style:{width:"100%",padding:"0.875rem 1rem",fontSize:"1rem",border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--input-bg)",color:"var(--text-color)",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:r=>r.currentTarget.style.borderColor="var(--accent-color)",onBlur:r=>r.currentTarget.style.borderColor="var(--border-color)"})}),e.jsxs("button",{onClick:()=>p(!0),style:{width:"100%",padding:"1rem",marginBottom:"1.5rem",background:"var(--card-bg)",border:"2px solid var(--border-color)",borderRadius:"8px",color:"var(--text-color)",fontSize:"1rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.borderColor="var(--accent-color)"},onMouseLeave:r=>{r.currentTarget.style.borderColor="var(--border-color)"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("i",{className:"bx bx-category",style:{fontSize:"1.25rem"}}),o==="all"&&"Toutes les catÃ©gories",o==="top-ordered"&&"Les plus utilisÃ©es",o!=="all"&&o!=="top-ordered"&&o]}),e.jsx("i",{className:"bx bx-chevron-down",style:{fontSize:"1.25rem"}})]}),B&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"1rem"},onClick:()=>p(!1),children:e.jsxs("div",{style:{background:"var(--card-bg)",borderRadius:"12px",padding:"1.5rem",maxWidth:"500px",width:"100%",maxHeight:"80vh",overflowY:"auto",border:"1px solid var(--border-color)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{color:"var(--text-color)",margin:0,fontSize:"1.25rem",fontWeight:"700"},children:"SÃ©lectionner une catÃ©gorie"}),e.jsx("button",{onClick:()=>p(!1),style:{background:"transparent",border:"none",color:"var(--text-secondary)",fontSize:"1.5rem",cursor:"pointer",padding:"0.25rem",lineHeight:1,width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.background="var(--hover-bg)",r.currentTarget.style.color="var(--text-color)"},onMouseLeave:r=>{r.currentTarget.style.background="transparent",r.currentTarget.style.color="var(--text-secondary)"},children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("button",{onClick:()=>{R("all"),p(!1)},style:{padding:"1rem",background:o==="all"?"var(--accent-color)":"var(--hover-bg)",border:o==="all"?"none":"1px solid var(--border-color)",borderRadius:"8px",color:o==="all"?"white":"var(--text-color)",fontSize:"1rem",fontWeight:"600",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"0.75rem",transition:"all 0.2s"},onMouseEnter:r=>{o!=="all"&&(r.currentTarget.style.background="var(--border-color)")},onMouseLeave:r=>{o!=="all"&&(r.currentTarget.style.background="var(--hover-bg)")},children:[e.jsx("i",{className:"bx bx-grid-alt",style:{fontSize:"1.25rem"}}),"Toutes les catÃ©gories"]}),e.jsxs("button",{onClick:()=>{R("top-ordered"),p(!1)},style:{padding:"1rem",background:o==="top-ordered"?"var(--accent-color)":"var(--hover-bg)",border:o==="top-ordered"?"none":"1px solid var(--border-color)",borderRadius:"8px",color:o==="top-ordered"?"white":"var(--text-color)",fontSize:"1rem",fontWeight:"600",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"0.75rem",transition:"all 0.2s"},onMouseEnter:r=>{o!=="top-ordered"&&(r.currentTarget.style.background="var(--border-color)")},onMouseLeave:r=>{o!=="top-ordered"&&(r.currentTarget.style.background="var(--hover-bg)")},children:[e.jsx("i",{className:"bx bx-star",style:{fontSize:"1.25rem"}}),"Les plus utilisÃ©es"]}),F.filter(r=>r!=="all"&&r!=="top-ordered").map(r=>e.jsxs("button",{onClick:()=>{R(r),p(!1)},style:{padding:"1rem",background:o===r?"var(--accent-color)":"var(--hover-bg)",border:o===r?"none":"1px solid var(--border-color)",borderRadius:"8px",color:o===r?"white":"var(--text-color)",fontSize:"1rem",fontWeight:"600",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"0.75rem",transition:"all 0.2s"},onMouseEnter:t=>{o!==r&&(t.currentTarget.style.background="var(--border-color)")},onMouseLeave:t=>{o!==r&&(t.currentTarget.style.background="var(--hover-bg)")},children:[e.jsx("i",{className:"bx bx-category",style:{fontSize:"1.25rem"}}),r]},r))]})]})}),s.length===0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"40vh",gap:"1rem"},children:[e.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent-color)",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]}),e.jsx("p",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"500"},children:"Aucun produit dans cette catÃ©gorie"})]}):e.jsx("div",{className:"products-grid",children:U.map(r=>{const t=re(r),c=z(r.id);return e.jsxs("div",{className:"product-card",children:[e.jsxs("div",{className:"product-image-wrapper",children:[e.jsx("div",{className:"product-category-badge",children:r.category}),r.photo?e.jsx("img",{src:r.photo,alt:r.designation,className:"product-image"}):e.jsx("div",{className:"product-image-placeholder",children:"ðŸ“¦"})]}),e.jsxs("div",{className:"product-details",children:[e.jsxs("div",{className:"product-ref-container",children:[e.jsx(ne,{type:r.packagingType,mode:"icon",size:"small"}),e.jsx("span",{className:"product-ref",children:r.reference})]}),e.jsx("h3",{className:"product-name",children:r.designation}),e.jsxs("div",{className:"product-stock-inline",children:["QuantitÃ© : ",e.jsx("span",{className:t,children:r.currentStock})]}),(()=>{const n=C(r.id);return n>0?e.jsxs("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",fontSize:"0.7rem",fontWeight:"600",color:"#fff",background:"#10b981",borderRadius:"4px",width:"fit-content"},children:["En commande x",n]}):null})(),e.jsxs("div",{className:"product-actions",children:[e.jsxs("div",{className:"quantity-selector",children:[e.jsx("button",{className:"quantity-btn",onClick:()=>$(r.id),disabled:c<=1,children:"âˆ’"}),e.jsx("input",{type:"number",className:"quantity-input",value:c,onChange:n=>T(r.id,parseInt(n.target.value)||1),min:"1",max:r.currentStock}),e.jsx("button",{className:"quantity-btn",onClick:()=>Z(r.id),disabled:c>=r.currentStock,children:"+"})]}),r.currentStock>0?e.jsx("button",{className:"add-to-cart-btn-icon",onClick:()=>d(r.id),title:"Ajouter au panier",disabled:P[r.id],children:P[r.id]?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 0.8s linear infinite"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"9",cy:"21",r:"1"}),e.jsx("circle",{cx:"20",cy:"21",r:"1"}),e.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]})}):e.jsx("button",{className:"add-to-cart-btn-icon",disabled:!0,title:"Stock Ã©puisÃ©",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"9",cy:"21",r:"1"}),e.jsx("circle",{cx:"20",cy:"21",r:"1"}),e.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]})})]})]})]},r.id)})}),s.length>0&&e.jsxs("div",{ref:h,style:{height:"20px",margin:"20px 0",textAlign:"center"},children:[w<s.length&&e.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:["Chargement de plus de produits... (",w," / ",s.length,")"]}),w>=s.length&&s.length>20&&e.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:["Tous les produits sont affichÃ©s (",s.length,")"]})]}),j.length>0&&e.jsxs("div",{className:"fixed-cart",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h2",{children:"Mon Panier"}),e.jsxs("span",{className:"cart-count",children:[ee()," articles"]})]}),e.jsx("div",{className:"cart-items",children:j.map(r=>e.jsxs("div",{className:"cart-item",children:[r.photo?e.jsx("img",{src:r.photo,alt:r.productDesignation,className:"cart-item-image"}):e.jsx("div",{className:"cart-item-image",children:"ðŸ“¦"}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("div",{className:"cart-item-ref product-reference-highlight",children:r.productReference}),e.jsx("div",{className:"cart-item-name",children:r.productDesignation}),e.jsxs("div",{className:"cart-item-quantity",children:[e.jsx("span",{children:"QuantitÃ©:"}),e.jsx("strong",{children:r.quantity})]})]}),e.jsx("button",{className:"remove-item-btn",onClick:()=>N(r.productId),title:"Retirer du panier",children:"Ã—"})]},r.productId))}),e.jsx("div",{className:"cart-footer",children:e.jsx("button",{className:"submit-cart-btn",onClick:G,children:"Effectuer la sortie"})})]}),W&&e.jsx(ie,{cartItems:j,onComplete:J,onCancel:X})]})};export{ue as default};
