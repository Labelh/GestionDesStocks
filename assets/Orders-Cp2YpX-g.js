import{u as v,a as f,j as e}from"./index-DlynR0Vu.js";import{r as a}from"./react-vendor-D8CQoBvY.js";import"./supabase-BffQhpPo.js";const k=()=>{const{orders:i,updateOrder:d,updateProduct:u,getProductById:l}=v(),{addNotification:s}=f(),[o,m]=a.useState("pending"),h=a.useMemo(()=>[...o?i.filter(n=>n.status===o):i].sort((n,r)=>new Date(r.ordered_at).getTime()-new Date(n.ordered_at).getTime()),[i,o]),x=a.useCallback(async t=>{const n=i.find(c=>c.id===t);if(!n)return;const r=l(n.product_id);if(!r){alert("Produit introuvable");return}try{const c=r.currentStock+n.quantity;await u(r.id,{currentStock:c}),await d(t,{status:"received",received_at:new Date}),s({type:"success",title:"Commande rÃ©ceptionnÃ©e",message:`${n.quantity} ${r.unit} de ${r.designation} ajoutÃ©(s) au stock`,duration:5e3})}catch(c){console.error("Erreur lors de la rÃ©ception:",c),s({type:"error",title:"Erreur",message:"Erreur lors de la rÃ©ception de la commande",duration:5e3})}},[i,l,u,d,s]),p=a.useCallback(async t=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir annuler cette commande ?"))try{await d(t,{status:"cancelled"}),s({type:"success",title:"Commande annulÃ©e",message:"La commande a Ã©tÃ© annulÃ©e",duration:3e3})}catch(n){console.error("Erreur lors de l'annulation:",n),s({type:"error",title:"Erreur",message:"Erreur lors de l'annulation de la commande",duration:5e3})}},[d,s]),j=a.useCallback(t=>{switch(t){case"pending":return"status-badge medium";case"received":return"status-badge normal";case"cancelled":return"status-badge critical";default:return"status-badge"}},[]),g=a.useCallback(t=>{switch(t){case"pending":return"En attente";case"received":return"ReÃ§ue";case"cancelled":return"AnnulÃ©e";default:return t}},[]);return e.jsxs("div",{className:"orders-page",children:[e.jsx("h1",{children:"Commandes"}),e.jsx("div",{className:"filters",children:e.jsxs("select",{value:o,onChange:t=>m(t.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"received",children:"ReÃ§ues"}),e.jsx("option",{value:"cancelled",children:"AnnulÃ©es"})]})}),h.length===0?e.jsx("p",{className:"no-data",children:"Aucune commande trouvÃ©e"}):e.jsx("div",{className:"products-table-container",children:e.jsxs("table",{className:"products-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Image"}),e.jsx("th",{children:"RÃ©fÃ©rence"}),e.jsx("th",{children:"DÃ©signation"}),e.jsx("th",{children:"QuantitÃ©"}),e.jsx("th",{children:"CommandÃ© par"}),e.jsx("th",{children:"Date de commande"}),e.jsx("th",{children:"Statut"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:h.map(t=>{const n=l(t.product_id);return e.jsxs("tr",{children:[e.jsx("td",{children:n&&n.photo?e.jsx("img",{src:n.photo,alt:t.product_designation,style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px"}}):e.jsx("div",{style:{width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-secondary)",borderRadius:"4px",fontSize:"1.5rem"},children:"ðŸ“¦"})}),e.jsx("td",{style:{color:"var(--primary-color)",fontWeight:"bold"},children:t.product_reference}),e.jsx("td",{children:t.product_designation}),e.jsxs("td",{children:[t.quantity," ",n==null?void 0:n.unit]}),e.jsx("td",{children:t.ordered_by_name}),e.jsxs("td",{children:[new Date(t.ordered_at).toLocaleDateString("fr-FR")," Ã "," ",new Date(t.ordered_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),t.status==="received"&&t.received_at&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["ReÃ§ue: ",new Date(t.received_at).toLocaleDateString("fr-FR")," Ã "," ",new Date(t.received_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("td",{children:e.jsx("span",{className:j(t.status),children:g(t.status)})}),e.jsx("td",{children:t.status==="pending"&&e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:()=>x(t.id),className:"btn-icon btn-approve",title:"RÃ©ceptionner",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{onClick:()=>p(t.id),className:"btn-icon btn-reject",title:"Annuler",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})})]},t.id)})})]})})]})};export{k as default};
