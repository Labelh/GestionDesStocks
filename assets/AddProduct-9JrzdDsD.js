import{u as y,j as e}from"./index-2vrD73m2.js";import{u as L,r as c}from"./react-vendor-DRM3MNr6.js";import"./supabase-g_Un6fVd.js";const R=()=>{const{addProduct:g,categories:f,units:j,storageZones:N,getAllProductReferences:u}=y(),m=L(),[p,v]=c.useState("");c.useEffect(()=>{(async()=>{const i=await u();if(i.length===0)return"RF00001";const a=i.filter(l=>l.startsWith("RF")).map(l=>parseInt(l.substring(2))).filter(l=>!isNaN(l)),d=(a.length>0?Math.max(...a):0)+1;return`RF${String(d).padStart(5,"0")}`})().then(i=>v(i))},[u]);const[r,h]=c.useState({designation:"",customerReference:"",category:"",storageZone:"",shelf:"",position:"",location:"",currentStock:"",minStock:"",unit:"",unitPrice:"",photo:"",supplier1:"",orderLink1:"",supplier2:"",orderLink2:"",supplier3:"",orderLink3:""}),[o,x]=c.useState({}),n=s=>{const{name:i,value:a}=s.target;h(t=>({...t,[i]:a})),o[i]&&x(t=>({...t,[i]:""}))},k=s=>{var a;const i=(a=s.target.files)==null?void 0:a[0];if(i){const t=new FileReader;t.onloadend=()=>{h(d=>({...d,photo:t.result}))},t.readAsDataURL(i)}},b=()=>{const s={};r.designation.trim()||(s.designation="La désignation est requise"),r.category||(s.category="La catégorie est requise"),r.storageZone||(s.storageZone="La zone de stockage est requise"),(!r.shelf||isNaN(parseInt(r.shelf))||parseInt(r.shelf)<1)&&(s.shelf="L'étagère doit être un nombre supérieur à 0"),(!r.position||isNaN(parseInt(r.position))||parseInt(r.position)<1)&&(s.position="La position doit être un nombre supérieur à 0"),r.unit||(s.unit="L'unité est requise");const i=parseFloat(r.currentStock);return(isNaN(i)||i<0)&&(s.currentStock="Le stock actuel doit être un nombre positif"),r.unitPrice&&(isNaN(parseFloat(r.unitPrice))||parseFloat(r.unitPrice)<0)&&(s.unitPrice="Le prix unitaire doit être un nombre positif"),x(s),Object.keys(s).length===0},S=s=>{if(s.preventDefault(),!b())return;const i=`${r.storageZone}.${r.shelf}.${r.position}`;g({reference:p,customerReference:r.customerReference||void 0,designation:r.designation,category:r.category,storageZone:r.storageZone,shelf:parseInt(r.shelf),position:parseInt(r.position),location:i,currentStock:parseFloat(r.currentStock),minStock:r.minStock?parseFloat(r.minStock):0,maxStock:0,unit:r.unit,unitPrice:r.unitPrice?parseFloat(r.unitPrice):void 0,photo:r.photo||void 0,supplier1:r.supplier1||void 0,orderLink1:r.orderLink1||void 0,supplier2:r.supplier2||void 0,orderLink2:r.orderLink2||void 0,supplier3:r.supplier3||void 0,orderLink3:r.orderLink3||void 0}),m("/products")};return e.jsxs("div",{className:"add-product-page",children:[e.jsx("h1",{children:"Ajouter un Produit"}),e.jsxs("form",{onSubmit:S,className:"product-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Informations générales"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Référence (auto-générée)"}),e.jsx("input",{type:"text",value:p,disabled:!0,style:{background:"var(--hover-bg)",color:"var(--text-secondary)",cursor:"not-allowed"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"designation",children:"Désignation *"}),e.jsx("input",{type:"text",id:"designation",name:"designation",value:r.designation,onChange:n,className:o.designation?"error":""}),o.designation&&e.jsx("span",{className:"error-text",children:o.designation})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"customerReference",children:"Référence Client"}),e.jsx("input",{type:"text",id:"customerReference",name:"customerReference",value:r.customerReference,onChange:n,placeholder:"Référence du client (optionnel)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Catégorie *"}),e.jsxs("select",{id:"category",name:"category",value:r.category,onChange:n,className:o.category?"error":"",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),f.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),o.category&&e.jsx("span",{className:"error-text",children:o.category})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unit",children:"Unité *"}),e.jsxs("select",{id:"unit",name:"unit",value:r.unit,onChange:n,className:o.unit?"error":"",children:[e.jsx("option",{value:"",children:"Sélectionner une unité"}),j.map(s=>e.jsxs("option",{value:s.abbreviation,children:[s.name," (",s.abbreviation,")"]},s.id))]}),o.unit&&e.jsx("span",{className:"error-text",children:o.unit})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unitPrice",children:"Prix Unitaire (€)"}),e.jsx("input",{type:"number",id:"unitPrice",name:"unitPrice",value:r.unitPrice,onChange:n,step:"0.01",min:"0",placeholder:"0.00",className:o.unitPrice?"error":""}),o.unitPrice&&e.jsx("span",{className:"error-text",children:o.unitPrice})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"photo",children:"Photo du Produit"}),e.jsx("input",{type:"file",id:"photo",accept:"image/*",onChange:k})]})]}),r.photo&&e.jsx("div",{className:"photo-preview",children:e.jsx("img",{src:r.photo,alt:"Aperçu"})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Localisation"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"storageZone",children:"Zone de stockage *"}),e.jsxs("select",{id:"storageZone",name:"storageZone",value:r.storageZone,onChange:n,className:o.storageZone?"error":"",children:[e.jsx("option",{value:"",children:"Sélectionner une zone"}),N.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),o.storageZone&&e.jsx("span",{className:"error-text",children:o.storageZone})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"shelf",children:"Étagère *"}),e.jsx("input",{type:"number",id:"shelf",name:"shelf",value:r.shelf,onChange:n,min:"1",placeholder:"Numéro de l'étagère",className:o.shelf?"error":""}),o.shelf&&e.jsx("span",{className:"error-text",children:o.shelf})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"position",children:"Position *"}),e.jsx("input",{type:"number",id:"position",name:"position",value:r.position,onChange:n,min:"1",placeholder:"Position sur l'étagère",className:o.position?"error":""}),o.position&&e.jsx("span",{className:"error-text",children:o.position})]}),e.jsx("div",{className:"form-group"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Gestion du stock"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentStock",children:"Stock Actuel *"}),e.jsx("input",{type:"number",id:"currentStock",name:"currentStock",value:r.currentStock,onChange:n,step:"1",min:"0",className:o.currentStock?"error":""}),o.currentStock&&e.jsx("span",{className:"error-text",children:o.currentStock})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"minStock",children:"Stock Minimum"}),e.jsx("input",{type:"number",id:"minStock",name:"minStock",value:r.minStock,onChange:n,step:"1",min:"0",placeholder:"Seuil d'alerte (optionnel)"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Fournisseurs et commandes"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"supplier1",children:"Fournisseur 1"}),e.jsx("input",{type:"text",id:"supplier1",name:"supplier1",value:r.supplier1,onChange:n,placeholder:"Nom du fournisseur"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orderLink1",children:"Lien de Commande 1"}),e.jsx("input",{type:"url",id:"orderLink1",name:"orderLink1",value:r.orderLink1,onChange:n,placeholder:"https://exemple.com/produit"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"supplier2",children:"Fournisseur 2"}),e.jsx("input",{type:"text",id:"supplier2",name:"supplier2",value:r.supplier2,onChange:n,placeholder:"Nom du fournisseur"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orderLink2",children:"Lien de Commande 2"}),e.jsx("input",{type:"url",id:"orderLink2",name:"orderLink2",value:r.orderLink2,onChange:n,placeholder:"https://exemple.com/produit"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"supplier3",children:"Fournisseur 3"}),e.jsx("input",{type:"text",id:"supplier3",name:"supplier3",value:r.supplier3,onChange:n,placeholder:"Nom du fournisseur"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orderLink3",children:"Lien de Commande 3"}),e.jsx("input",{type:"url",id:"orderLink3",name:"orderLink3",value:r.orderLink3,onChange:n,placeholder:"https://exemple.com/produit"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:()=>m("/products"),className:"btn btn-secondary",children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Ajouter le Produit"})]})]})]})};export{R as default};
